{"version":3,"sources":["classes/Player.ts","classes/DebugLogger.ts","classes/TownsServiceClient.ts","classes/Video/Video.ts","contexts/CoveyAppContext.tsx","hooks/useCoveyAppState.ts","components/world/WorldMap.tsx","components/VideoCall/VideoFrontend/hooks/useIsTrackEnabled/useIsTrackEnabled.tsx","components/VideoCall/VideoFrontend/hooks/useMediaStreamTrack/useMediaStreamTrack.ts","components/VideoCall/VideoFrontend/components/AudioLevelIndicator/AudioLevelIndicator.tsx","components/VideoCall/VideoFrontend/icons/AvatarIcon.tsx","components/VideoCall/VideoFrontend/components/NetworkQualityLevel/NetworkQualityLevel.tsx","components/VideoCall/VideoFrontend/hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel.tsx","components/VideoCall/VideoFrontend/components/ParticipantInfo/PinIcon/PinIcon.tsx","components/VideoCall/VideoFrontend/icons/ScreenShareIcon.tsx","components/VideoCall/VideoFrontend/hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff.tsx","components/VideoCall/VideoFrontend/hooks/usePublications/usePublications.tsx","components/VideoCall/VideoFrontend/hooks/useTrack/useTrack.tsx","components/VideoCall/VideoFrontend/hooks/useParticipantIsReconnecting/useParticipantIsReconnecting.ts","components/VideoCall/VideoFrontend/components/ParticipantInfo/ParticipantInfo.tsx","components/VideoCall/VideoFrontend/utils/index.ts","components/VideoCall/VideoFrontend/state/settings/settingsReducer.ts","components/VideoCall/VideoFrontend/state/index.tsx","components/VideoCall/VideoFrontend/components/AudioTrack/AudioTrack.tsx","components/VideoCall/VideoFrontend/components/VideoTrack/VideoTrack.tsx","components/VideoCall/VideoFrontend/hooks/useVideoTrackDimensions/useVideoTrackDimensions.tsx","components/VideoCall/VideoFrontend/components/Publication/Publication.tsx","components/VideoCall/VideoFrontend/components/ParticipantTracks/ParticipantTracks.tsx","components/VideoCall/VideoFrontend/components/Participant/Participant.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/useSelectedParticipant/useSelectedParticipant.tsx","classes/LocalStorage/TwilioVideo.ts","components/VideoCall/VideoFrontend/hooks/useLocalVideoToggle/useLocalVideoToggle.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/AttachVisibilityHandler/AttachVisibilityHandler.tsx","components/VideoCall/VideoFrontend/hooks/deviceHooks/deviceHooks.tsx","components/VideoCall/VideoFrontend/constants.ts","components/VideoCall/VideoFrontend/hooks/useScreenShareParticipant/useScreenShareParticipant.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/useRoom/useRoom.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/usePresenting/usePresenting.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/index.tsx","components/VideoCall/VideoFrontend/components/VideoProvider/useLocalTracks/useLocalTracks.ts","components/VideoCall/VideoFrontend/components/VideoProvider/useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors.ts","components/VideoCall/VideoFrontend/components/VideoProvider/useHandleTrackPublicationFailed/useHandleTrackPublicationFailed.ts","components/VideoCall/VideoFrontend/components/VideoProvider/useHandleOnDisconnect/useHandleOnDisconnect.ts","components/VideoCall/VideoFrontend/components/VideoProvider/useScreenShareToggle/useScreenShareToggle.tsx","components/VideoCall/VideoFrontend/hooks/useVideoContext/useVideoContext.ts","components/VideoCall/VideoFrontend/hooks/useMainParticipant/useMainParticipant.tsx","contexts/NearbyPlayersContext.tsx","components/VideoCall/VideoFrontend/components/ParticipantList/ParticipantList.tsx","components/VideoCall/VideoFrontend/hooks/useParticipants/useParticipants.tsx","hooks/useNearbyPlayers.tsx","components/VideoCall/VideoFrontend/components/MainParticipantInfo/MainParticipantInfo.tsx","components/VideoCall/VideoFrontend/components/MainParticipant/MainParticipant.tsx","components/VideoCall/VideoFrontend/components/Room/Room.tsx","components/VideoCall/VideoFrontend/components/Buttons/EndCallButton/EndCallButton.tsx","components/VideoCall/VideoFrontend/components/MenuBar/FlipCameraButton/FlipCameraIcon.tsx","components/VideoCall/VideoFrontend/components/MenuBar/FlipCameraButton/FlipCameraButton.tsx","components/VideoCall/VideoFrontend/components/DeviceSelectionDialog/AudioInputList/AudioInputList.tsx","components/VideoCall/VideoFrontend/components/DeviceSelectionDialog/AudioOutputList/AudioOutputList.tsx","components/VideoCall/VideoFrontend/components/DeviceSelectionDialog/VideoInputList/VideoInputList.tsx","components/VideoCall/VideoFrontend/components/DeviceSelectionDialog/DeviceSelectionDialog.tsx","components/VideoCall/VideoFrontend/components/MenuBar/Menu/Menu.tsx","components/VideoCall/VideoFrontend/hooks/useRoomState/useRoomState.tsx","components/VideoCall/VideoFrontend/icons/MicIcon.tsx","components/VideoCall/VideoFrontend/icons/MicOffIcon.tsx","components/VideoCall/VideoFrontend/hooks/useLocalAudioToggle/useLocalAudioToggle.tsx","components/VideoCall/VideoFrontend/components/Buttons/ToggleAudioButton/ToggleAudioButton.tsx","components/VideoCall/VideoFrontend/icons/VideoOffIcon.tsx","components/VideoCall/VideoFrontend/icons/VideoOnIcon.tsx","components/VideoCall/VideoFrontend/components/Buttons/ToggleVideoButton/ToggleVideoButton.tsx","components/VideoCall/VideoFrontend/components/Buttons/ToogleScreenShareButton/ToggleScreenShareButton.tsx","contexts/VideoContext.tsx","hooks/useMaybeVideo.ts","components/Login/TownSettings.tsx","components/VideoCall/VideoFrontend/components/MenuBar/MenuBar.tsx","components/VideoCall/VideoFrontend/components/MobileTopMenuBar/MobileTopMenuBar.tsx","components/VideoCall/VideoFrontend/icons/ErrorIcon.tsx","components/VideoCall/VideoFrontend/icons/WarningIcon.tsx","components/VideoCall/VideoFrontend/components/Snackbar/Snackbar.tsx","components/VideoCall/VideoFrontend/components/ReconnectingNotification/ReconnectingNotification.tsx","components/VideoCall/VideoFrontend/components/PreJoinScreens/MediaErrorSnackbar/MediaErrorSnackbar.tsx","components/VideoCall/VideoOverlay/VideoOverlay.tsx","components/VideoCall/VideoFrontend/components/LocalAudioLevelIndicator/LocalAudioLevelIndicator.tsx","components/VideoCall/VideoFrontend/components/PreJoinScreens/DeviceSelectionScreen/LocalVideoPreview/LocalVideoPreview.tsx","components/VideoCall/VideoFrontend/state/settings/renderDimensions.ts","components/VideoCall/VideoFrontend/components/ConnectionOptionsDialog/ConnectionOptionsDialog.tsx","components/VideoCall/VideoFrontend/icons/SettingsIcon.tsx","components/VideoCall/VideoFrontend/components/PreJoinScreens/DeviceSelectionScreen/SettingsMenu/SettingsMenu.tsx","components/VideoCall/VideoFrontend/components/PreJoinScreens/DeviceSelectionScreen/DeviceSelectionScreen.tsx","components/VideoCall/VideoFrontend/components/IntroContainer/IntroContainer.tsx","components/Login/TownSelection.tsx","components/VideoCall/VideoFrontend/components/PreJoinScreens/PreJoinScreens.tsx","components/Login/Login.tsx","components/VideoCall/VideoFrontend/utils/useConnectionOptions/useConnectionOptions.ts","components/VideoCall/VideoFrontend/components/UnsupportedBrowserWarning/UnsupportedBrowserWarning.tsx","components/VideoCall/VideoFrontend/components/ErrorDialog/ErrorDialog.tsx","components/VideoCall/VideoFrontend/components/ErrorDialog/enhanceMessage.ts","components/VideoCall/VideoFrontend/theme.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Player","id","userName","location","_id","_userName","sprite","label","this","playerFromServer","DebugLogger","prefix","enabled","msg","getTimeString","Date","params","console","info","prefixMessage","warn","error","time","hours","getHours","toString","padStart","minutes","getMinutes","seconds","getSeconds","milliseconds","getMilliseconds","TownsServiceClient","serviceURL","_axios","baseURL","process","REACT_APP_TOWNS_SERVICE_URL","assert","axios","create","requestData","post","responseWrapper","unwrapOrThrowError","patch","coveyTownID","delete","coveyTownPassword","get","response","ignoreResponse","data","isOK","Error","message","Video","logger","initialisePromise","teardownPromise","sessionToken","videoToken","townsServiceClient","_coveyTownID","_townFriendlyName","_isPubliclyListed","pauseGame","unPauseGame","Promise","resolve","reject","joinTown","then","result","coveySessionToken","providerVideoToken","friendlyName","isPubliclyListed","catch","err","doTeardown","a","username","video","setup","window","clowdr","teardown","Context","React","createContext","useCoveyAppState","ctx","useContext","CoveyAppContext","CoveyGameScene","emitMovement","player","players","cursors","previouslyCapturedKeys","lastLocation","ready","paused","load","image","tilemapTiledJSON","atlas","forEach","p","updatePlayerLocation","disconnectedPlayers","filter","find","disconnectedPlayer","destroy","length","myPlayer","rotation","moving","x","y","push","physics","add","setSize","setOffset","text","font","color","backgroundColor","anims","setX","setY","play","stop","setTexture","keySet","left","isDown","right","down","up","speed","prevVelocity","body","velocity","clone","setVelocity","primaryDirection","getNewMovementDirection","setVelocityX","setVelocityY","normalize","scale","isMoving","undefined","map","make","tilemap","key","tileset","addTilesetImage","worldLayer","createLayer","setCollisionByProperty","collides","setDepth","spawnPoint","findObject","obj","name","transporters","createFromObjects","world","enable","transporter","height","setVisible","filterObjects","cursorKeys","input","keyboard","createCursorKeys","addKeys","Phaser","Input","Keyboard","KeyCodes","W","S","A","D","H","J","K","L","overlap","overlappingObject","space","transportTargetID","getData","target","collider","frames","generateFrameNames","start","end","zeroPad","frameRate","repeat","camera","cameras","main","startFollow","setBounds","widthInPixels","heightInPixels","townFriendlyName","padding","setScrollFactor","getCaptures","clearCaptures","addCapture","Scene","WorldMap","instance","useState","gameScene","setGameScene","useEffect","config","type","AUTO","parent","minWidth","minHeight","default","arcade","gravity","game","Game","newGameScene","scene","pause","resume","deepPlayers","JSON","stringify","updatePlayersLocations","useIsTrackEnabled","track","isEnabled","setIsEnabled","setEnabled","setDisabled","on","off","useMediaStreamTrack","mediaStreamTrack","setMediaStreamTrack","handleStarted","audioContext","clipId","AudioContext","webkitAudioContext","initializeAnalyser","stream","audioSource","createMediaStreamSource","analyser","createAnalyser","smoothingTimeConstant","fftSize","connect","AudioLevelIndicator","audioTrack","SVGRectRef","useRef","setAnalyser","isTrackEnabled","newMediaStream","MediaStream","stopAllMediaStreamTracks","getTracks","reinitializeAnalyser","addEventListener","removeEventListener","SVGClipElement","current","sampleArray","Uint8Array","frequencyBinCount","timer","interval","getByteFrequencyData","values","i","volume","Math","min","max","log10","setAttribute","String","clipPathId","xmlns","width","viewBox","data-test-audio-indicator","ref","fill","fillRule","transform","clipPath","rx","ry","strokeWidth","d","data-test-audio-mute-icon","memo","AvatarIcon","cx","cy","r","strokeLinejoin","Container","styled","display","alignItems","marginRight","borderRight","BARS_ARRAY","NetworkQualityLevel","networkQualityLevel","participant","setNetworkQualityLevel","handleNewtorkQualityLevelChange","newNetworkQualityLevel","useParticipantNetworkQualityLevel","level","style","background","PinIcon","Tooltip","title","placement","SvgIcon","float","boxSizing","ScreenShareIcon","useIsTrackSwitchedOff","isSwitchedOff","setIsSwitchedOff","handleSwitchedOff","handleSwitchedOn","usePublications","publications","setPublications","Array","from","tracks","publicationAdded","publication","prevPublications","publicationRemoved","useTrack","setTrack","removeTrack","useParticipantIsReconnecting","isReconnecting","setIsReconnecting","handleReconnecting","handleReconnected","useStyles","makeStyles","theme","createStyles","container","position","overflow","objectFit","paddingTop","border","notContainedInGrid","breakpoints","sidebarMobileHeight","marginBottom","fontSize","innerContainer","top","infoContainer","zIndex","flexDirection","justifyContent","avatarContainer","bottom","reconnectingContainer","screenShareIconContainer","identity","margin","infoRowBottom","networkQualityContainer","typeography","hideParticipant","cursorPointer","cursor","highlightParticipant","palette","primary","ParticipantInfo","profile","onClick","isSelected","children","isLocalParticipant","slot","insideGrid","highlight","audioPublication","kind","videoPublication","trackName","includes","isVideoEnabled","Boolean","isScreenShareEnabled","isVideoSwitchedOff","isParticipantReconnecting","classes","anchorEl","setAnchorEl","handlePopoverOpen","useCallback","event","currentTarget","handlePopoverClose","className","clsx","data-cy-participant","aria-haspopup","onMouseEnter","onMouseLeave","href","rel","Typography","variant","component","displayName","isMobile","navigator","userAgent","test","removeUndefineds","isPlainObject","val","initialSettings","trackSwitchOffMode","dominantSpeakerPriority","bandwidthProfileMode","maxTracks","maxAudioBitrate","renderDimensionLow","renderDimensionStandard","renderDimensionHigh","inputLabels","setting","settingsReducer","state","action","value","StateContext","AppStateProvider","props","setError","isFetching","setIsFetching","activeSinkId","setActiveSinkId","useReducer","settings","dispatchSetting","contextValue","toggleWidth","preferredMode","highlightedProfiles","Provider","getToken","room","res","useAppState","context","AudioTrack","audioEl","attach","document","appendChild","detach","el","remove","setSinkId","maxWidth","maxHeight","VideoTrack","isLocal","priority","dimensions","setDimensions","handleDimensionsChanged","_track","useVideoTrackDimensions","isPortrait","muted","setPriority","isFrontFacing","getSettings","facingMode","Publication","videoOnly","videoPriority","ParticipantTracks","filteredPublications","enableScreenShare","some","Participant","selectedParticipantContext","useSelectedParticipant","SelectedParticipantProvider","selectedParticipant","_setSelectedParticipant","onDisconnect","prevParticipant","TwilioVideo","localStorage","getItem","twilioVideoCameraEnabledKey","setItem","removeItem","twilioVideoMicEnabledKey","twilioVideoLastCameraKey","twilioVideoLastMicKey","useLocalVideoToggle","useVideoContext","localParticipant","videoTrack","localVideoTrack","getLocalVideoTrack","removeLocalVideoTrack","isPublishing","setIsPublishing","stopVideo","LocalStorage_TwilioVideo","twilioVideoLastCamera","deviceId","localTrackPublication","unpublishTrack","emit","toggleVideoEnabled","twilioVideoCameraEnabled","lastCamera","exact","publishTrack","log","AttachVisibilityHandler","shouldRepublishVideoOnForeground","handleVisibilityChange","visibilityState","useDevices","devices","setDevices","getDevices","mediaDevices","enumerateDevices","_devices","useAudioInputDevices","device","useVideoInputDevices","useHasAudioInputDevices","useHasVideoInputDevices","DEFAULT_VIDEO_CONSTRAINTS","useScreenShareParticipant","screenShareParticipant","setScreenShareParticipant","updateScreenShareParticipant","participants","concat","presentingContext","usePresenting","PresentingProvider","VideoContext","VideoProvider","options","onError","onErrorCallback","setAudioTrack","setVideoTrack","isAcquiringLocalTracks","setIsAcquiringLocalTracks","hasAudio","hasVideo","getLocalAudioTrack","createLocalAudioTrack","newTrack","newOptions","now","createLocalVideoTrack","removeLocalAudioTrack","getAudioAndVideoTracksMutex","useMutex","getAudioAndVideoTracks","run","lock","createLocalTracks","audio","twilioVideoLastMic","_videoTrack","_audioTrack","unlock","useLocalTracks","localAudioTrack","EventEmitter","setRoom","isConnecting","setIsConnecting","optionsRef","token","localTracks","newRoom","disconnect","setMaxListeners","once","setTimeout","twilioRoom","videoTracks","useRoom","onDisconnected","useHandleRoomDisconnectionErrors","useHandleTrackPublicationFailed","useHandleOnDisconnect","isSharing","setIsSharing","stopScreenShareRef","shareScreen","getDisplayMedia","trackPublication","onended","toggleScreenShare","useScreenShareToggle","isSharingScreen","useMainParticipant","nearbyPlayers","ParticipantList","idx","setParticipants","participantConnected","prevParticipants","ps","sort","participantDisconnected","useParticipants","setSelectedParticipant","mainParticipant","NearbyPlayersContext","useNearbyPlayers","overflowY","gridArea","overflowX","transparentBackground","scrollContainer","gridContainer","gridInnerContainer","gridTemplateColumns","gridAutoRows","participantsEl","gridView","participantWithSlot","remoteProfile","sid","marginLeft","fullWidth","MainParticipantInfo","screenSharePublication","participantProfile","data-cy-main-participant","MainParticipant","presenting","sidebarWidth","gridTemplateRows","Room","button","brand","EndCallButton","Button","data-cy-disconnect","FlipCameraIcon","FlipCameraButton","supportsFacingMode","setSupportsFacingMode","videoDeviceList","toggleFacingMode","newFacingMode","restart","disabled","startIcon","AudioInputList","audioInputDevices","localAudioInputDeviceId","lastAudioDeviceId","_setLastAudioDeviceId","setLastAudioDeviceId","gutterBottom","Grid","justify","FormControl","Select","onChange","e","newDeviceId","MenuItem","AudioOutputList","audioOutputDevices","activeOutputLabel","preview","VideoInputList","videoInputDevices","localVideoInputDeviceId","lastVideoDeviceId","_setLastVideoDeviceId","setLastVideoDeviceId","paper","headline","listSection","DeviceSelectionDialog","open","onClose","Dialog","DialogTitle","Divider","DialogContent","DialogActions","Menu","useMediaQuery","setMenuOpen","settingsOpen","setSettingsOpen","useRoomState","setState","setRoomState","MicIcon","MicOffIcon","useLocalAudioToggle","stopAudio","toggleAudioEnabled","twilioVideoMicEnabled","ToggleAudioButton","isAudioEnabled","lastClickTimeRef","hasAudioDevices","toggleAudio","setMediaError","data-cy-audio-toggle","VideoOffIcon","VideoOnIcon","ToggleVideoButton","hasVideoDevices","toggleVideo","spacing","ToggleScreenShareButton","disableScreenShareButton","isScreenShareSupported","isDisabled","tooltipMessage","PopperProps","disablePortal","data-cy-share-screen","useMaybeVideo","TownSettings","useDisclosure","isOpen","onOpen","apiClient","currentTownID","currentTownFriendlyName","currentTownIsPubliclyListed","setFriendlyName","setIsPubliclyListed","roomUpdatePassword","setRoomUpdatePassword","openSettings","closeSettings","toast","useToast","processUpdates","deleteTown","status","description","updateTown","data-testid","onSubmit","ev","preventDefault","pb","htmlFor","placeholder","mt","isChecked","checked","isRequired","colorScheme","mr","mobileFooterHeight","screenShareBanner","footerHeight","hideMobile","MenuBar","item","Hidden","smDown","flex","paddingLeft","mobileTopBarHeight","endCallButton","settingsButton","MobileTopMenuBar","buttonClassName","ErrorIcon","version","stroke","WarningIcon","borderRadius","boxShadow","contentContainer","iconContainer","fontWeight","borderLeft","warning","Snackbar","handleClose","anchorOrigin","vertical","horizontal","_","reason","IconButton","size","aria-label","ReconnectingNotification","roomState","MediaErrorSnackbar","dismissError","isSnackbarOpen","marginTop","getSnackbarContent","Main","_theme","paddingBottom","VideoGrid","coveyController","unmountRef","unloadRef","existingRoomRef","mediaError","coveyRoom","isPresenting","onPresentingChanged","when","LocalAudioLevelIndicator","identityContainer","LocalVideoPreview","RenderDimensions","resolution","formControl","withDefault","RenderDimensionItems","ConnectionOptionsDialog","handleChange","handleNumberChange","xs","hidden","sm","InputLabel","TextField","SettingsIcon","strokeLinecap","SettingsMenu","mobileButtonClass","roomType","menuOpen","deviceSettingsOpen","setDeviceSettingsOpen","connectionSettingsOpen","setConnectionSettingsOpen","anchorRef","transformOrigin","deviceButton","localPreviewContainer","paddingRight","joinButtons","mobileButtonBar","mobileButton","DeviceSelectionScreen","disableButtons","useForm","handleSubmit","errors","register","formState","md","mdUp","direction","content","subContentContainer","IntroContainer","subContent","TownSelection","doLogin","setUserName","newTownName","setNewTownName","newTownIsPublic","setNewTownIsPublic","townIDToJoin","setTownIDToJoin","currentPublicTowns","setCurrentPublicTowns","updateTownListings","listTowns","towns","b","currentOccupancy","setInterval","clearInterval","handleJoin","coveyRoomID","initData","handleCreate","createTown","newTownInfo","privateMessage","isClosable","duration","borderWidth","as","autoFocus","maxH","town","role","maximumOccupancy","PreJoinScreens","Login","useConnectionOptions","connectionOptions","bandwidthProfile","mode","renderDimensions","low","standard","high","Number","dominantSpeaker","networkQuality","local","remote","preferredVideoCodecs","codec","simulcast","maxSubscriptionBitrate","heading","isSupported","Paper","Link","ErrorDialog","code","enhancedMessage","enhanceMessage","DialogContentText","defaultTheme","createMuiTheme","defaultAppState","myPlayerID","socket","currentLocation","appStateReducer","update","updatePlayer","nextState","calculateNearbyPlayers","dx","dy","sqrt","isWithinCallRadius","samePlayers","a1","a2","ids1","ids2","townID","townIsPubliclyListed","GameController","dispatchAppUpdate","gamePlayerID","coveyUserID","url","roomName","io","auth","fromServerPlayer","currentPlayers","sp","App","appState","setupGameController","videoInstance","setOnDisconnect","page","useMemo","EmbeddedTwilioAppWrapper","UnsupportedBrowserWarning","AppStateWrapper","highlightColour","overrides","MuiButton","root","textTransform","transition","transitions","short","contained","outlinedPrimary","MuiTypography","body1","MuiInputBase","MuiSelect","MuiDialogActions","MuiTextField","MuiInputLabel","MuiOutlinedInput","notchedOutline","borderColor","lg","xl","typography","fontFamily","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8da17706.chunk.js","sourcesContent":["export default class Player {\r\n  public location?: UserLocation;\r\n\r\n  private readonly _id: string;\r\n\r\n  private readonly _userName: string;\r\n\r\n  public sprite?: Phaser.GameObjects.Sprite;\r\n\r\n  public label?: Phaser.GameObjects.Text;\r\n\r\n  constructor(id: string, userName: string, location: UserLocation) {\r\n    this._id = id;\r\n    this._userName = userName;\r\n    this.location = location;\r\n  }\r\n\r\n  get userName(): string {\r\n    return this._userName;\r\n  }\r\n\r\n  get id(): string {\r\n    return this._id;\r\n  }\r\n\r\n  static fromServerPlayer(playerFromServer: ServerPlayer): Player {\r\n    return new Player(playerFromServer._id, playerFromServer._userName, playerFromServer.location);\r\n  }\r\n}\r\nexport type ServerPlayer = { _id: string, _userName: string, location: UserLocation };\r\n\r\nexport type Direction = 'front'|'back'|'left'|'right';\r\n\r\nexport type UserLocation = {\r\n  x: number,\r\n  y: number,\r\n  rotation: Direction,\r\n  moving: boolean\r\n};\r\n","/* eslint-disable no-console */\r\n\r\nexport default class DebugLogger {\r\n  private enabled = false;\r\n\r\n  constructor(\r\n    private prefix: string,\r\n  ) {\r\n  }\r\n\r\n  enable(): void {\r\n    this.enabled = true;\r\n  }\r\n\r\n  disable(): void {\r\n    this.enabled = false;\r\n  }\r\n\r\n  get isEnabled(): boolean {\r\n    return this.enabled;\r\n  }\r\n\r\n  prefixMessage(msg: string): string {\r\n    return `${DebugLogger.getTimeString(new Date())} [${this.prefix}]: ${msg}`;\r\n  }\r\n\r\n  info(msg: string, ...params: any[]): void {\r\n    if (this.enabled) {\r\n      console.info(this.prefixMessage(msg), ...params);\r\n    }\r\n  }\r\n\r\n  warn(msg: string, ...params: any[]): void {\r\n    if (this.enabled) {\r\n      console.warn(this.prefixMessage(msg), ...params);\r\n    }\r\n  }\r\n\r\n  error(msg: string, ...params: any[]): void {\r\n    console.error(this.prefixMessage(msg), ...params);\r\n  }\r\n\r\n  static getTimeString(time: Date): string {\r\n    const hours = time.getHours().toString().padStart(2, '0');\r\n    const minutes = time.getMinutes().toString().padStart(2, '0');\r\n    const seconds = time.getSeconds().toString().padStart(2, '0');\r\n    const milliseconds = time.getMilliseconds().toString().padStart(3, '0');\r\n\r\n    return `${hours}:${minutes}:${seconds}.${milliseconds}`;\r\n  }\r\n}\r\n","import axios, { AxiosInstance, AxiosResponse } from 'axios';\r\nimport assert from 'assert';\r\nimport { ServerPlayer } from './Player';\r\n\r\n/**\r\n * The format of a request to join a Town in Covey.Town, as dispatched by the server middleware\r\n */\r\nexport interface TownJoinRequest {\r\n  /** userName of the player that would like to join * */\r\n  userName: string;\r\n  /** ID of the town that the player would like to join * */\r\n  coveyTownID: string;\r\n}\r\n\r\n/**\r\n * The format of a response to join a Town in Covey.Town, as returned by the handler to the server\r\n * middleware\r\n */\r\nexport interface TownJoinResponse {\r\n  /** Unique ID that represents this player * */\r\n  coveyUserID: string;\r\n  /** Secret token that this player should use to authenticate\r\n   * in future requests to this service * */\r\n  coveySessionToken: string;\r\n  /** Secret token that this player should use to authenticate\r\n   * in future requests to the video service * */\r\n  providerVideoToken: string;\r\n  /** List of players currently in this town * */\r\n  currentPlayers: ServerPlayer[];\r\n  /** Friendly name of this town * */\r\n  friendlyName: string;\r\n  /** Is this a private town? * */\r\n  isPubliclyListed: boolean;\r\n}\r\n\r\n/**\r\n * Payload sent by client to create a Town in Covey.Town\r\n */\r\nexport interface TownCreateRequest {\r\n  friendlyName: string;\r\n  isPubliclyListed: boolean;\r\n}\r\n\r\n/**\r\n * Response from the server for a Town create request\r\n */\r\nexport interface TownCreateResponse {\r\n  coveyTownID: string;\r\n  coveyTownPassword: string;\r\n}\r\n\r\n/**\r\n * Response from the server for a Town list request\r\n */\r\nexport interface TownListResponse {\r\n  towns: CoveyTownInfo[];\r\n}\r\n\r\n/**\r\n * Payload sent by the client to delete a Town\r\n */\r\nexport interface TownDeleteRequest {\r\n  coveyTownID: string;\r\n  coveyTownPassword: string;\r\n}\r\n\r\n/**\r\n * Payload sent by the client to update a Town.\r\n * N.B., JavaScript is terrible, so:\r\n * if(!isPubliclyListed) -> evaluates to true if the value is false OR undefined, use ===\r\n */\r\nexport interface TownUpdateRequest {\r\n  coveyTownID: string;\r\n  coveyTownPassword: string;\r\n  friendlyName?: string;\r\n  isPubliclyListed?: boolean;\r\n}\r\n\r\n/**\r\n * Envelope that wraps any response from the server\r\n */\r\nexport interface ResponseEnvelope<T> {\r\n  isOK: boolean;\r\n  message?: string;\r\n  response?: T;\r\n}\r\n\r\nexport type CoveyTownInfo = {\r\n  friendlyName: string;\r\n  coveyTownID: string;\r\n  currentOccupancy: number;\r\n  maximumOccupancy: number\r\n};\r\n\r\nexport default class TownsServiceClient {\r\n  private _axios: AxiosInstance;\r\n\r\n  /**\r\n   * Construct a new Towns Service API client. Specify a serviceURL for testing, or otherwise\r\n   * defaults to the URL at the environmental variable REACT_APP_ROOMS_SERVICE_URL\r\n   * @param serviceURL\r\n   */\r\n  constructor(serviceURL?: string) {\r\n    const baseURL = serviceURL || process.env.REACT_APP_TOWNS_SERVICE_URL;\r\n    assert(baseURL);\r\n    this._axios = axios.create({ baseURL });\r\n  }\r\n\r\n  static unwrapOrThrowError<T>(response: AxiosResponse<ResponseEnvelope<T>>, ignoreResponse = false): T {\r\n    if (response.data.isOK) {\r\n      if (ignoreResponse) {\r\n        return {} as T;\r\n      }\r\n      assert(response.data.response);\r\n      return response.data.response;\r\n    }\r\n    throw new Error(`Error processing request: ${response.data.message}`);\r\n  }\r\n\r\n  async createTown(requestData: TownCreateRequest): Promise<TownCreateResponse> {\r\n    const responseWrapper = await this._axios.post<ResponseEnvelope<TownCreateResponse>>('/towns', requestData);\r\n    return TownsServiceClient.unwrapOrThrowError(responseWrapper);\r\n  }\r\n\r\n  async updateTown(requestData: TownUpdateRequest): Promise<void> {\r\n    const responseWrapper = await this._axios.patch<ResponseEnvelope<void>>(`/towns/${requestData.coveyTownID}`, requestData);\r\n    return TownsServiceClient.unwrapOrThrowError(responseWrapper, true);\r\n  }\r\n\r\n  async deleteTown(requestData: TownDeleteRequest): Promise<void> {\r\n    const responseWrapper = await this._axios.delete<ResponseEnvelope<void>>(`/towns/${requestData.coveyTownID}/${requestData.coveyTownPassword}`);\r\n    return TownsServiceClient.unwrapOrThrowError(responseWrapper, true);\r\n  }\r\n\r\n  async listTowns(): Promise<TownListResponse> {\r\n    const responseWrapper = await this._axios.get<ResponseEnvelope<TownListResponse>>('/towns');\r\n    return TownsServiceClient.unwrapOrThrowError(responseWrapper);\r\n  }\r\n\r\n  async joinTown(requestData: TownJoinRequest): Promise<TownJoinResponse> {\r\n    const responseWrapper = await this._axios.post('/sessions', requestData);\r\n    return TownsServiceClient.unwrapOrThrowError(responseWrapper);\r\n  }\r\n\r\n}\r\n","import DebugLogger from '../DebugLogger';\r\nimport TownsServiceClient, { TownJoinResponse } from '../TownsServiceClient';\r\n\r\nexport default class Video {\r\n  private static video: Video | null = null;\r\n\r\n  private logger: DebugLogger = new DebugLogger('Video');\r\n\r\n  private initialisePromise: Promise<TownJoinResponse> | null = null;\r\n\r\n  private teardownPromise: Promise<void> | null = null;\r\n\r\n  private sessionToken?: string;\r\n\r\n  private videoToken: string | null = null;\r\n\r\n  private _userName: string;\r\n\r\n  private townsServiceClient: TownsServiceClient = new TownsServiceClient();\r\n\r\n  private _coveyTownID: string;\r\n\r\n  private _townFriendlyName: string | undefined;\r\n\r\n  private _isPubliclyListed: boolean | undefined;\r\n\r\n  pauseGame: () => void = ()=>{};\r\n\r\n  unPauseGame: () => void = ()=>{};\r\n\r\n  constructor(userName: string, coveyTownID: string) {\r\n    this._userName = userName;\r\n    this._coveyTownID = coveyTownID;\r\n  }\r\n\r\n  get isPubliclyListed(): boolean {\r\n    if (this._isPubliclyListed === true) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  get townFriendlyName(): string | undefined {\r\n    return this._townFriendlyName;\r\n  }\r\n\r\n  get userName(): string {\r\n    return this._userName;\r\n  }\r\n\r\n  get coveyTownID(): string {\r\n    return this._coveyTownID;\r\n  }\r\n\r\n  private async setup(): Promise<TownJoinResponse> {\r\n    if (!this.initialisePromise) {\r\n      this.initialisePromise = new Promise((resolve, reject) => {\r\n        // Request our token to join the town\r\n        this.townsServiceClient.joinTown({\r\n          coveyTownID: this._coveyTownID,\r\n          userName: this._userName,\r\n        })\r\n          .then((result) => {\r\n            this.sessionToken = result.coveySessionToken;\r\n            this.videoToken = result.providerVideoToken;\r\n            this._townFriendlyName = result.friendlyName;\r\n            this._isPubliclyListed = result.isPubliclyListed;\r\n            resolve(result);\r\n          })\r\n          .catch((err) => {\r\n            reject(err);\r\n          });\r\n      });\r\n    }\r\n    return this.initialisePromise;\r\n  }\r\n\r\n  private async teardown(): Promise<void> {\r\n    if (!this.teardownPromise) {\r\n      if (this.initialisePromise) {\r\n        const doTeardown = async () => {\r\n          this.logger.info('Tearing down video client...');\r\n          this.logger.info('Tore down video client.');\r\n          this.initialisePromise = null;\r\n        };\r\n\r\n        this.teardownPromise = this.initialisePromise.then(async () => {\r\n          await doTeardown();\r\n        }).catch(async (err) => {\r\n          this.logger.warn(\"Ignoring video initialisation error as we're teraing down anyway.\", err);\r\n          await doTeardown();\r\n        });\r\n      } else {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n\r\n    return this.teardownPromise ?? Promise.resolve();\r\n  }\r\n\r\n  public static async setup(username: string, coveyTownID: string): Promise<TownJoinResponse> {\r\n    let result = null;\r\n\r\n    if (!Video.video) {\r\n      Video.video = new Video(username, coveyTownID);\r\n    }\r\n\r\n    try {\r\n      result = await Video.video.setup();\r\n      if (!result) {\r\n        Video.video = null;\r\n      }\r\n    } catch (err) {\r\n      Video.video = null;\r\n      throw err;\r\n    }\r\n\r\n\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore - JB TODO\r\n    if (!window.clowdr) {\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore - JB TODO\r\n      window.clowdr = window.clowdr || {};\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore - JB TODO\r\n    window.clowdr.video = Video.video;\r\n\r\n    return result;\r\n  }\r\n\r\n  public static async teardown(): Promise<void> {\r\n    try {\r\n      await Video.video?.teardown();\r\n    } finally {\r\n      Video.video = null;\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore - JB TODO\r\n      if (window.clowdr && window.clowdr.video) {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore - JB TODO\r\n        window.clowdr.video = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public static instance(): Video | null {\r\n    return Video.video;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { CoveyAppState } from '../CoveyTypes';\r\n\r\n/**\r\n * Hint: You will never need to use this directly. Instead, use the\r\n * `useCoveyAppState` hook.\r\n */\r\nconst Context = React.createContext<CoveyAppState | null>(null);\r\n\r\nexport default Context;\r\n","import { useContext } from 'react';\r\nimport assert from 'assert';\r\nimport CoveyAppContext from '../contexts/CoveyAppContext';\r\nimport { CoveyAppState } from '../CoveyTypes';\r\n\r\n/**\r\n * Use this hook to access the current user profile.\r\n *\r\n * To access the User class from the data layer, use this hook to get the user\r\n * current profile, then utilise its `user` field.\r\n *\r\n * To access the User class from parse, use\r\n * `Parse.User.currentAsync().then(...)`\r\n *\r\n * Use this hook if your component can only render when the user is logged in.\r\n * Otherwise, use the `useMaybeUser` hook.\r\n */\r\nexport default function useCoveyAppState(): CoveyAppState {\r\n  const ctx = useContext(CoveyAppContext);\r\n  assert(ctx, 'App context should be defined.');\r\n  return ctx;\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport Phaser from 'phaser';\r\nimport Player, { UserLocation } from '../../classes/Player';\r\nimport Video from '../../classes/Video/Video';\r\nimport useCoveyAppState from '../../hooks/useCoveyAppState';\r\n\r\n// https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-1-958fc7e6bbd6\r\nclass CoveyGameScene extends Phaser.Scene {\r\n  private player?: {\r\n    sprite: Phaser.Types.Physics.Arcade.SpriteWithDynamicBody, label: Phaser.GameObjects.Text\r\n  };\r\n\r\n  private id?: string;\r\n\r\n  private players: Player[] = [];\r\n\r\n  private cursors: Phaser.Types.Input.Keyboard.CursorKeys[] = [];\r\n\r\n  /*\r\n   * A \"captured\" key doesn't send events to the browser - they are trapped by Phaser\r\n   * When pausing the game, we uncapture all keys, and when resuming, we re-capture them.\r\n   * This is the list of keys that are currently captured by Phaser.\r\n   */\r\n  private previouslyCapturedKeys: number[] = [];\r\n\r\n  private lastLocation?: UserLocation;\r\n\r\n  private ready = false;\r\n\r\n  private paused = false;\r\n\r\n  private video: Video;\r\n\r\n  private emitMovement: (loc: UserLocation) => void;\r\n\r\n  constructor(video: Video, emitMovement: (loc: UserLocation) => void) {\r\n    super('PlayGame');\r\n    this.video = video;\r\n    this.emitMovement = emitMovement;\r\n  }\r\n\r\n  preload() {\r\n    // this.load.image(\"logo\", logoImg);\r\n    this.load.image('tiles', '/assets/tilesets/tuxmon-sample-32px-extruded.png');\r\n    this.load.tilemapTiledJSON('map', '/assets/tilemaps/tuxemon-town.json');\r\n    this.load.atlas('atlas', '/assets/atlas/atlas.png', '/assets/atlas/atlas.json');\r\n  }\r\n\r\n  updatePlayersLocations(players: Player[]) {\r\n    if (!this.ready) {\r\n      this.players = players;\r\n      return;\r\n    }\r\n    players.forEach((p) => {\r\n      this.updatePlayerLocation(p);\r\n    });\r\n    // Remove disconnected players from board\r\n    const disconnectedPlayers = this.players.filter(\r\n      (player) => !players.find((p) => p.id === player.id),\r\n    );\r\n    disconnectedPlayers.forEach((disconnectedPlayer) => {\r\n      if (disconnectedPlayer.sprite) {\r\n        disconnectedPlayer.sprite.destroy();\r\n        disconnectedPlayer.label?.destroy();\r\n      }\r\n    });\r\n    // Remove disconnected players from list\r\n    if (disconnectedPlayers.length) {\r\n      this.players = this.players.filter(\r\n        (player) => !disconnectedPlayers.find(\r\n          (p) => p.id === player.id,\r\n        ),\r\n      );\r\n    }\r\n  }\r\n\r\n  updatePlayerLocation(player: Player) {\r\n    let myPlayer = this.players.find((p) => p.id === player.id);\r\n    if (!myPlayer) {\r\n      let { location } = player;\r\n      if (!location) {\r\n        location = {\r\n          rotation: 'back',\r\n          moving: false,\r\n          x: 0,\r\n          y: 0,\r\n        };\r\n      }\r\n      myPlayer = new Player(player.id, player.userName, location);\r\n      this.players.push(myPlayer);\r\n    }\r\n    if (this.id !== myPlayer.id && this.physics && player.location) {\r\n      let { sprite } = myPlayer;\r\n      if (!sprite) {\r\n        sprite = this.physics.add\r\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n          // @ts-ignore - JB todo\r\n          .sprite(0, 0, 'atlas', 'misa-front')\r\n          .setSize(30, 40)\r\n          .setOffset(0, 24);\r\n        const label = this.add.text(0, 0, myPlayer.userName, {\r\n          font: '18px monospace',\r\n          color: '#000000',\r\n          backgroundColor: '#ffffff',\r\n        });\r\n        myPlayer.label = label;\r\n        myPlayer.sprite = sprite;\r\n      }\r\n      if (!sprite.anims) return;\r\n      sprite.setX(player.location.x);\r\n      sprite.setY(player.location.y);\r\n      myPlayer.label?.setX(player.location.x);\r\n      myPlayer.label?.setY(player.location.y - 20);\r\n      if (player.location.moving) {\r\n        sprite.anims.play(`misa-${player.location.rotation}-walk`, true);\r\n      } else {\r\n        sprite.anims.stop();\r\n        sprite.setTexture('atlas', `misa-${player.location.rotation}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  getNewMovementDirection() {\r\n    if (this.cursors.find(keySet => keySet.left?.isDown)) {\r\n      return 'left';\r\n    }\r\n    if (this.cursors.find(keySet => keySet.right?.isDown)) {\r\n      return 'right';\r\n    }\r\n    if (this.cursors.find(keySet => keySet.down?.isDown)) {\r\n      return 'front';\r\n    }\r\n    if (this.cursors.find(keySet => keySet.up?.isDown)) {\r\n      return 'back';\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  update() {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n    if (this.player && this.cursors) {\r\n      const speed = 175;\r\n      const prevVelocity = this.player.sprite.body.velocity.clone();\r\n      const body = this.player.sprite.body as Phaser.Physics.Arcade.Body;\r\n\r\n      // Stop any previous movement from the last frame\r\n      body.setVelocity(0);\r\n\r\n      const primaryDirection = this.getNewMovementDirection();\r\n      switch (primaryDirection) {\r\n        case 'left':\r\n          body.setVelocityX(-speed);\r\n          this.player.sprite.anims.play('misa-left-walk', true);\r\n          break;\r\n        case 'right':\r\n          body.setVelocityX(speed);\r\n          this.player.sprite.anims.play('misa-right-walk', true);\r\n          break;\r\n        case 'front':\r\n          body.setVelocityY(speed);\r\n          this.player.sprite.anims.play('misa-front-walk', true);\r\n          break;\r\n        case 'back':\r\n          body.setVelocityY(-speed);\r\n          this.player.sprite.anims.play('misa-back-walk', true);\r\n          break;\r\n        default:\r\n          // Not moving\r\n          this.player.sprite.anims.stop();\r\n          // If we were moving, pick and idle frame to use\r\n          if (prevVelocity.x < 0) {\r\n            this.player.sprite.setTexture('atlas', 'misa-left');\r\n          } else if (prevVelocity.x > 0) {\r\n            this.player.sprite.setTexture('atlas', 'misa-right');\r\n          } else if (prevVelocity.y < 0) {\r\n            this.player.sprite.setTexture('atlas', 'misa-back');\r\n          } else if (prevVelocity.y > 0) this.player.sprite.setTexture('atlas', 'misa-front');\r\n          break;\r\n      }\r\n\r\n      // Normalize and scale the velocity so that player can't move faster along a diagonal\r\n      this.player.sprite.body.velocity.normalize()\r\n        .scale(speed);\r\n\r\n      const isMoving = primaryDirection !== undefined;\r\n      this.player.label.setX(body.x);\r\n      this.player.label.setY(body.y - 20);\r\n      if (!this.lastLocation\r\n        || this.lastLocation.x !== body.x\r\n        || this.lastLocation.y !== body.y\r\n        || (isMoving && this.lastLocation.rotation !== primaryDirection)\r\n        || this.lastLocation.moving !== isMoving) {\r\n        if (!this.lastLocation) {\r\n          this.lastLocation = {\r\n            x: body.x,\r\n            y: body.y,\r\n            rotation: primaryDirection || 'front',\r\n            moving: isMoving,\r\n          };\r\n        }\r\n        this.lastLocation.x = body.x;\r\n        this.lastLocation.y = body.y;\r\n        this.lastLocation.rotation = primaryDirection || 'front';\r\n        this.lastLocation.moving = isMoving;\r\n        this.emitMovement(this.lastLocation);\r\n      }\r\n    }\r\n  }\r\n\r\n  create() {\r\n    const map = this.make.tilemap({ key: 'map' });\r\n\r\n    /* Parameters are the name you gave the tileset in Tiled and then the key of the\r\n     tileset image in Phaser's cache (i.e. the name you used in preload)\r\n     */\r\n    const tileset = map.addTilesetImage('tuxmon-sample-32px-extruded', 'tiles');\r\n\r\n    // Parameters: layer name (or index) from Tiled, tileset, x, y\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const belowLayer = map.createLayer('Below Player', tileset, 0, 0);\r\n    const worldLayer = map.createLayer('World', tileset, 0, 0);\r\n    worldLayer.setCollisionByProperty({ collides: true });\r\n    const aboveLayer = map.createLayer('Above Player', tileset, 0, 0);\r\n    /* By default, everything gets depth sorted on the screen in the order we created things.\r\n     Here, we want the \"Above Player\" layer to sit on top of the player, so we explicitly give\r\n     it a depth. Higher depths will sit on top of lower depth objects.\r\n     */\r\n    aboveLayer.setDepth(10);\r\n\r\n    // Object layers in Tiled let you embed extra info into a map - like a spawn point or custom\r\n    // collision shapes. In the tmx file, there's an object layer with a point named \"Spawn Point\"\r\n    const spawnPoint = map.findObject('Objects',\r\n      (obj) => obj.name === 'Spawn Point') as unknown as\r\n      Phaser.GameObjects.Components.Transform;\r\n\r\n\r\n    // Find all of the transporters, add them to the physics engine\r\n    const transporters = map.createFromObjects('Objects',\r\n      { name: 'transporter' })\r\n    this.physics.world.enable(transporters);\r\n\r\n    // For each of the transporters (rectangle objects), we need to tweak their location on the scene\r\n    // for reasons that are not obvious to me, but this seems to work. We also set them to be invisible\r\n    // but for debugging, you can comment out that line.\r\n    transporters.forEach(transporter => {\r\n        const sprite = transporter as Phaser.GameObjects.Sprite;\r\n        sprite.y += 2 * sprite.height; // Phaser and Tiled seem to disagree on which corner is y\r\n        sprite.setVisible(false); // Comment this out to see the transporter rectangles drawn on\r\n                                  // the map\r\n      }\r\n    );\r\n\r\n    const labels = map.filterObjects('Objects',(obj)=>obj.name==='label');\r\n    labels.forEach(label => {\r\n      if(label.x && label.y){\r\n        this.add.text(label.x, label.y, label.text.text, {\r\n          color: '#FFFFFF',\r\n          backgroundColor: '#000000',\r\n        })\r\n      }\r\n    });\r\n\r\n\r\n\r\n    const cursorKeys = this.input.keyboard.createCursorKeys();\r\n    this.cursors.push(cursorKeys);\r\n    this.cursors.push(this.input.keyboard.addKeys({\r\n      'up': Phaser.Input.Keyboard.KeyCodes.W,\r\n      'down': Phaser.Input.Keyboard.KeyCodes.S,\r\n      'left': Phaser.Input.Keyboard.KeyCodes.A,\r\n      'right': Phaser.Input.Keyboard.KeyCodes.D\r\n    }, false) as Phaser.Types.Input.Keyboard.CursorKeys);\r\n    this.cursors.push(this.input.keyboard.addKeys({\r\n      'up': Phaser.Input.Keyboard.KeyCodes.H,\r\n      'down': Phaser.Input.Keyboard.KeyCodes.J,\r\n      'left': Phaser.Input.Keyboard.KeyCodes.K,\r\n      'right': Phaser.Input.Keyboard.KeyCodes.L\r\n    }, false) as Phaser.Types.Input.Keyboard.CursorKeys);\r\n\r\n\r\n\r\n\r\n    // Create a sprite with physics enabled via the physics system. The image used for the sprite\r\n    // has a bit of whitespace, so I'm using setSize & setOffset to control the size of the\r\n    // player's body.\r\n    const sprite = this.physics.add\r\n      .sprite(spawnPoint.x, spawnPoint.y, 'atlas', 'misa-front')\r\n      .setSize(30, 40)\r\n      .setOffset(0, 24);\r\n    const label = this.add.text(spawnPoint.x, spawnPoint.y - 20, '(You)', {\r\n      font: '18px monospace',\r\n      color: '#000000',\r\n      // padding: {x: 20, y: 10},\r\n      backgroundColor: '#ffffff',\r\n    });\r\n    this.player = {\r\n      sprite,\r\n      label\r\n    };\r\n\r\n    /* Configure physics overlap behavior for when the player steps into\r\n    a transporter area. If you enter a transporter and press 'space', you'll\r\n    transport to the location on the map that is referenced by the 'target' property\r\n    of the transporter.\r\n     */\r\n    this.physics.add.overlap(sprite, transporters,\r\n      (overlappingObject, transporter)=>{\r\n      if(cursorKeys.space.isDown && this.player){\r\n        // In the tiled editor, set the 'target' to be an *object* pointer\r\n        // Here, we'll see just the ID, then find the object by ID\r\n        const transportTargetID = transporter.getData('target') as number;\r\n        const target = map.findObject('Objects', obj => (obj as unknown as Phaser.Types.Tilemaps.TiledObject).id === transportTargetID);\r\n        if(target && target.x && target.y && this.lastLocation){\r\n          // Move the player to the target, update lastLocation and send it to other players\r\n          this.player.sprite.x = target.x;\r\n          this.player.sprite.y = target.y;\r\n          this.lastLocation.x = target.x;\r\n          this.lastLocation.y = target.y;\r\n          this.emitMovement(this.lastLocation);\r\n        }\r\n        else{\r\n          throw new Error(`Unable to find target object ${target}`);\r\n        }\r\n      }\r\n    })\r\n\r\n    this.emitMovement({\r\n      rotation: 'front',\r\n      moving: false,\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore - JB todo\r\n      x: spawnPoint.x,\r\n      y: spawnPoint.y,\r\n    });\r\n\r\n    // Watch the player and worldLayer for collisions, for the duration of the scene:\r\n    this.physics.add.collider(sprite, worldLayer);\r\n\r\n    // Create the player's walking animations from the texture atlas. These are stored in the global\r\n    // animation manager so any sprite can access them.\r\n    const { anims } = this;\r\n    anims.create({\r\n      key: 'misa-left-walk',\r\n      frames: anims.generateFrameNames('atlas', {\r\n        prefix: 'misa-left-walk.',\r\n        start: 0,\r\n        end: 3,\r\n        zeroPad: 3,\r\n      }),\r\n      frameRate: 10,\r\n      repeat: -1,\r\n    });\r\n    anims.create({\r\n      key: 'misa-right-walk',\r\n      frames: anims.generateFrameNames('atlas', {\r\n        prefix: 'misa-right-walk.',\r\n        start: 0,\r\n        end: 3,\r\n        zeroPad: 3,\r\n      }),\r\n      frameRate: 10,\r\n      repeat: -1,\r\n    });\r\n    anims.create({\r\n      key: 'misa-front-walk',\r\n      frames: anims.generateFrameNames('atlas', {\r\n        prefix: 'misa-front-walk.',\r\n        start: 0,\r\n        end: 3,\r\n        zeroPad: 3,\r\n      }),\r\n      frameRate: 10,\r\n      repeat: -1,\r\n    });\r\n    anims.create({\r\n      key: 'misa-back-walk',\r\n      frames: anims.generateFrameNames('atlas', {\r\n        prefix: 'misa-back-walk.',\r\n        start: 0,\r\n        end: 3,\r\n        zeroPad: 3,\r\n      }),\r\n      frameRate: 10,\r\n      repeat: -1,\r\n    });\r\n\r\n    const camera = this.cameras.main;\r\n    camera.startFollow(this.player.sprite);\r\n    camera.setBounds(0, 0, map.widthInPixels, map.heightInPixels);\r\n\r\n\r\n\r\n    // Help text that has a \"fixed\" position on the screen\r\n    this.add\r\n      .text(16, 16, `Arrow keys to move, space to transport\\nCurrent town: ${this.video.townFriendlyName} (${this.video.coveyTownID})`, {\r\n        font: '18px monospace',\r\n        color: '#000000',\r\n        padding: {\r\n          x: 20,\r\n          y: 10\r\n        },\r\n        backgroundColor: '#ffffff',\r\n      })\r\n      .setScrollFactor(0)\r\n      .setDepth(30);\r\n\r\n    this.ready = true;\r\n    if (this.players.length) {\r\n      // Some players got added to the queue before we were ready, make sure that they have\r\n      // sprites....\r\n      this.players.forEach((p) => this.updatePlayerLocation(p));\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    this.paused = true;\r\n    this.previouslyCapturedKeys = this.input.keyboard.getCaptures();\r\n    this.input.keyboard.clearCaptures();\r\n  }\r\n\r\n  resume() {\r\n    this.paused = false;\r\n    this.input.keyboard.addCapture(this.previouslyCapturedKeys);\r\n    this.previouslyCapturedKeys = [];\r\n  }\r\n}\r\n\r\nexport default function WorldMap(): JSX.Element {\r\n  const video = Video.instance();\r\n  const {\r\n    emitMovement, players,\r\n  } = useCoveyAppState();\r\n  const [gameScene, setGameScene] = useState<CoveyGameScene>();\r\n  useEffect(() => {\r\n    const config = {\r\n      type: Phaser.AUTO,\r\n      parent: 'map-container',\r\n      minWidth: 800,\r\n      minHeight: 600,\r\n      physics: {\r\n        default: 'arcade',\r\n        arcade: {\r\n          gravity: { y: 0 }, // Top down game, so no gravity\r\n        },\r\n      },\r\n    };\r\n\r\n    const game = new Phaser.Game(config);\r\n    if (video) {\r\n      const newGameScene = new CoveyGameScene(video, emitMovement);\r\n      setGameScene(newGameScene);\r\n      game.scene.add('coveyBoard', newGameScene, true);\r\n      video.pauseGame = () => {\r\n        newGameScene.pause();\r\n      }\r\n      video.unPauseGame = () => {\r\n        newGameScene.resume();\r\n      }\r\n    }\r\n    return () => {\r\n      game.destroy(true);\r\n    };\r\n  }, [video, emitMovement]);\r\n\r\n  const deepPlayers = JSON.stringify(players);\r\n  useEffect(() => {\r\n    gameScene?.updatePlayersLocations(players);\r\n  }, [players, deepPlayers, gameScene]);\r\n\r\n  return <div id=\"map-container\"/>;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport {\r\n  LocalAudioTrack, LocalVideoTrack, RemoteAudioTrack, RemoteVideoTrack,\r\n} from 'twilio-video';\r\n\r\ntype TrackType = LocalAudioTrack | LocalVideoTrack | RemoteAudioTrack | RemoteVideoTrack | undefined;\r\n\r\nexport default function useIsTrackEnabled(track: TrackType) {\r\n  const [isEnabled, setIsEnabled] = useState(track ? track.isEnabled : false);\r\n\r\n  useEffect(() => {\r\n    setIsEnabled(track ? track.isEnabled : false);\r\n\r\n    if (track) {\r\n      const setEnabled = () => setIsEnabled(true);\r\n      const setDisabled = () => setIsEnabled(false);\r\n      track.on('enabled', setEnabled);\r\n      track.on('disabled', setDisabled);\r\n      return () => {\r\n        track.off('enabled', setEnabled);\r\n        track.off('disabled', setDisabled);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [track]);\r\n\r\n  return isEnabled;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { AudioTrack, VideoTrack } from 'twilio-video';\r\n\r\n/*\r\n * This hook allows components to reliably use the 'mediaStreamTrack' property of\r\n * an AudioTrack or a VideoTrack. Whenever 'localTrack.restart(...)' is called, it\r\n * will replace the mediaStreamTrack property of the localTrack, but the localTrack\r\n * object will stay the same. Therefore this hook is needed in order for components\r\n * to rerender in response to the mediaStreamTrack changing.\r\n */\r\nexport default function useMediaStreamTrack(track?: AudioTrack | VideoTrack) {\r\n  const [mediaStreamTrack, setMediaStreamTrack] = useState(track?.mediaStreamTrack);\r\n\r\n  useEffect(() => {\r\n    setMediaStreamTrack(track?.mediaStreamTrack);\r\n\r\n    if (track) {\r\n      const handleStarted = () => setMediaStreamTrack(track.mediaStreamTrack);\r\n      track.on('started', handleStarted);\r\n      return () => {\r\n        track.off('started', handleStarted);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [track]);\r\n\r\n  return mediaStreamTrack;\r\n}\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { AudioTrack, LocalAudioTrack, RemoteAudioTrack } from 'twilio-video';\r\nimport { interval } from 'd3-timer';\r\nimport useIsTrackEnabled from '../../hooks/useIsTrackEnabled/useIsTrackEnabled';\r\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\n\r\nlet clipId = 0;\r\nconst getUniqueClipId = () => clipId++;\r\n\r\n// @ts-ignore\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\r\nlet audioContext: AudioContext;\r\n\r\nexport function initializeAnalyser(stream: MediaStream) {\r\n  audioContext = audioContext || new AudioContext();\r\n  const audioSource = audioContext.createMediaStreamSource(stream);\r\n\r\n  const analyser = audioContext.createAnalyser();\r\n  analyser.smoothingTimeConstant = 0.2;\r\n  analyser.fftSize = 256;\r\n\r\n  audioSource.connect(analyser);\r\n  return analyser;\r\n}\r\n\r\nfunction AudioLevelIndicator({ audioTrack, color = 'white' }: { audioTrack?: AudioTrack; color?: string }) {\r\n  const SVGRectRef = useRef<SVGRectElement>(null);\r\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\r\n  const isTrackEnabled = useIsTrackEnabled(audioTrack as LocalAudioTrack | RemoteAudioTrack);\r\n  const mediaStreamTrack = useMediaStreamTrack(audioTrack);\r\n\r\n  useEffect(() => {\r\n    if (audioTrack && mediaStreamTrack && isTrackEnabled) {\r\n      // Here we create a new MediaStream from a clone of the mediaStreamTrack.\r\n      // A clone is created to allow multiple instances of this component for a single\r\n      // AudioTrack on iOS Safari.\r\n      let newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\r\n\r\n      // Here we listen for the 'stopped' event on the audioTrack. When the audioTrack is stopped,\r\n      // we stop the cloned track that is stored in 'newMediaStream'. It is important that we stop\r\n      // all tracks when they are not in use. Browsers like Firefox don't let you create a new stream\r\n      // from a new audio device while the active audio device still has active tracks.\r\n      const stopAllMediaStreamTracks = () => newMediaStream.getTracks().forEach((track) => track.stop());\r\n      audioTrack.on('stopped', stopAllMediaStreamTracks);\r\n\r\n      const reinitializeAnalyser = () => {\r\n        stopAllMediaStreamTracks();\r\n        newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\r\n        setAnalyser(initializeAnalyser(newMediaStream));\r\n      };\r\n\r\n      setAnalyser(initializeAnalyser(newMediaStream));\r\n\r\n      // Here we reinitialize the AnalyserNode on focus to avoid an issue in Safari\r\n      // where the analysers stop functioning when the user switches to a new tab\r\n      // and switches back to the app.\r\n      window.addEventListener('focus', reinitializeAnalyser);\r\n\r\n      return () => {\r\n        stopAllMediaStreamTracks();\r\n        window.removeEventListener('focus', reinitializeAnalyser);\r\n        audioTrack.off('stopped', stopAllMediaStreamTracks);\r\n      };\r\n    }\r\n    return () => {\r\n    };\r\n  }, [isTrackEnabled, mediaStreamTrack, audioTrack]);\r\n\r\n  useEffect(() => {\r\n    const SVGClipElement = SVGRectRef.current;\r\n\r\n    if (isTrackEnabled && SVGClipElement && analyser) {\r\n      const sampleArray = new Uint8Array(analyser.frequencyBinCount);\r\n\r\n      const timer = interval(() => {\r\n        analyser.getByteFrequencyData(sampleArray);\r\n        let values = 0;\r\n\r\n        const { length } = sampleArray;\r\n        for (let i = 0; i < length; i++) {\r\n          values += sampleArray[i];\r\n        }\r\n\r\n        const volume = Math.min(14, Math.max(0, Math.log10(values / length / 3) * 7));\r\n\r\n        SVGClipElement?.setAttribute('y', String(14 - volume));\r\n      }, 100);\r\n\r\n      return () => {\r\n        SVGClipElement.setAttribute('y', '14');\r\n        timer.stop();\r\n      };\r\n    }\r\n    return () => {\r\n    };\r\n  }, [isTrackEnabled, analyser]);\r\n\r\n  // Each instance of this component will need a unique HTML ID\r\n  const clipPathId = `audio-level-clip-${getUniqueClipId()}`;\r\n\r\n  return isTrackEnabled ? (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" data-test-audio-indicator>\r\n      <defs>\r\n        <clipPath id={clipPathId}>\r\n          <rect ref={SVGRectRef} x=\"0\" y=\"14\" width=\"24\" height=\"24\" />\r\n        </clipPath>\r\n      </defs>\r\n      <g fill=\"none\" fillRule=\"evenodd\" transform=\"translate(.5)\">\r\n        <rect\r\n          clipPath={`url(#${clipPathId})`}\r\n          width=\"5.2\"\r\n          height=\"10\"\r\n          x=\"9.5\"\r\n          y=\"3.5\"\r\n          rx=\"6\"\r\n          ry=\"3\"\r\n          fill=\"#23BF6E\"\r\n        />\r\n        <path\r\n          fill={color}\r\n          strokeWidth=\"0\"\r\n          d=\"M17.389 10.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V17.09C8.395 16.836 6 14.281 6 11.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM11.944 4c1.566 0 2.834 1.268 2.834 2.833v4.334c0 1.564-1.268 2.833-2.834 2.833-1.564 0-2.833-1.27-2.833-2.833V6.833C9.111 5.268 10.38 4 11.944 4zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334c0 1.012.822 1.833 1.833 1.833 1.013 0 1.834-.82 1.834-1.833V6.833c0-1.013-.82-1.833-1.834-1.833z\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  ) : (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      transform=\"translate(-0.5, 0)\"\r\n      data-test-audio-mute-icon\r\n    >\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <path\r\n          fill={color}\r\n          strokeWidth=\"0\"\r\n          d=\"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z\"\r\n          transform=\"translate(6.5 4)\"\r\n        />\r\n        <path\r\n          fill=\"red\"\r\n          strokeWidth=\"0\"\r\n          d=\"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z\"\r\n          transform=\"translate(6.5 4)\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default React.memo(AudioLevelIndicator);\r\n","import React from 'react';\r\n\r\nexport default function AvatarIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"73\" height=\"73\" viewBox=\"0 0 73 73\">\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <circle cx=\"36.5\" cy=\"36.5\" r=\"36.5\" fill=\"#FFF\" />\r\n        <path\r\n          fill=\"#282A2B\"\r\n          strokeLinejoin=\"round\"\r\n          d=\"M30.973 23.925c-3.162 3.794-3.162 9.886 0 13.68l.262.301c.266.293.548.564.842.812l.192.154v2.95l-6.71 2.397-.213.082c-2.03.834-3.346 2.793-3.346 4.97v2.766c0 .532.431.963.963.963h27.874c.531 0 .962-.431.962-.963V49.27l-.005-.228-.015-.233c-.187-2.092-1.562-3.883-3.539-4.59l-6.71-2.397v-2.95l.192-.154c.393-.33.762-.702 1.104-1.112 3.162-3.795 3.162-9.887 0-13.681-3.25-3.9-8.603-3.9-11.853 0zm10.374 1.232c2.567 3.08 2.567 8.135 0 11.216-.404.484-.85.894-1.328 1.226-.26.18-.414.476-.414.791v4.111c0 .407.255.77.639.907l7.348 2.625c1.314.47 2.213 1.687 2.278 3.077l.004.183v1.781h-25.95l.002-1.804c0-1.394.843-2.65 2.131-3.18l.172-.065 7.327-2.617c.383-.137.639-.5.639-.907v-4.11c0-.316-.155-.612-.415-.792-.478-.332-.924-.742-1.328-1.226-2.567-3.08-2.567-8.135 0-11.216 2.427-2.912 6.248-2.974 8.735-.186l.16.186z\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Participant } from 'twilio-video';\r\nimport useParticipantNetworkQualityLevel from '../../hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel';\r\n\r\nconst Container = styled('div')({\r\n  display: 'flex',\r\n  alignItems: 'flex-end',\r\n  '& div': {\r\n    width: '2px',\r\n    marginRight: '1px',\r\n    '&:not(:last-child)': {\r\n      borderRight: 'none',\r\n    },\r\n  },\r\n});\r\n\r\nconst STEP = 3;\r\nconst BARS_ARRAY = [0, 1, 2, 3, 4];\r\n\r\nexport default function NetworkQualityLevel({ participant }: { participant: Participant }) {\r\n  const networkQualityLevel = useParticipantNetworkQualityLevel(participant);\r\n\r\n  if (networkQualityLevel === null) return null;\r\n\r\n  return (\r\n    <Container>\r\n      {BARS_ARRAY.map((level) => (\r\n        <div\r\n          key={level}\r\n          style={{\r\n            height: `${STEP * (level + 1)}px`,\r\n            background: networkQualityLevel > level ? 'white' : 'rgba(255, 255, 255, 0.2)',\r\n          }}\r\n        />\r\n      ))}\r\n    </Container>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantNetworkQualityLevel(participant: Participant) {\r\n  const [networkQualityLevel, setNetworkQualityLevel] = useState(participant.networkQualityLevel);\r\n\r\n  useEffect(() => {\r\n    const handleNewtorkQualityLevelChange = (newNetworkQualityLevel: number) => setNetworkQualityLevel(newNetworkQualityLevel);\r\n\r\n    setNetworkQualityLevel(participant.networkQualityLevel);\r\n    participant.on('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    return () => {\r\n      participant.off('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    };\r\n  }, [participant]);\r\n\r\n  return networkQualityLevel;\r\n}\r\n","import React from 'react';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport SvgIcon from '@material-ui/core/SvgIcon';\r\n\r\nexport default function PinIcon() {\r\n  return (\r\n    <Tooltip title=\"Participant is pinned. Click to un-pin.\" placement=\"top\">\r\n      <SvgIcon\r\n        style={{\r\n          float: 'right', background: 'rgba(0, 0, 0, 0.5)', padding: '0.1em', boxSizing: 'content-box',\r\n        }}\r\n        width=\"26\"\r\n        height=\"26\"\r\n        viewBox=\"0 0 26 26\"\r\n      >\r\n        <path\r\n          fill=\"#FFF\"\r\n          fillRule=\"evenodd\"\r\n          strokeWidth=\"0\"\r\n          d=\"M15.808 4.489c.208-.207.544-.207.75 0l4.953 4.952c.207.207.207.543 0 .75l-1.415 1.415c-.207.208-.543.208-.75 0l-.333-.333-3.007 3.007v2.611c0 .113-.035.222-.1.312l-.055.063-1.06 1.062c-.208.207-.544.207-.751 0l-2.809-2.81-5.992 5.993c-.207.207-.543.207-.75 0-.184-.184-.205-.47-.062-.677l.062-.073 5.991-5.993-2.808-2.808c-.184-.184-.204-.47-.061-.677l.061-.073 1.062-1.061c.1-.1.234-.156.375-.156h2.61l3.007-3.007-.332-.332c-.185-.184-.205-.47-.062-.677l.062-.073zm.376 1.125l-.666.664.333.333c.185.184.205.47.062.677l-.062.074-3.537 3.537c-.1.1-.234.155-.375.155h-2.61l-.531.531 2.803 2.803.005.006.005.005 2.804 2.803.53-.531v-2.61c0-.112.036-.221.102-.311l.054-.064 3.537-3.537c.208-.208.544-.208.75 0l.333.332.664-.666-4.201-4.201z\"\r\n        />\r\n      </SvgIcon>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function ScreenShareIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n      <path\r\n        fill=\"#707578\"\r\n        fillRule=\"evenodd\"\r\n        d=\"M17.657 6.343c3.124 3.124 3.124 8.19 0 11.314-3.124 3.124-8.19 3.124-11.314 0-3.124-3.124-3.124-8.19 0-11.314 3.124-3.124 8.19-3.124 11.314 0zm-10.444.87c-2.643 2.644-2.643 6.93 0 9.574 2.644 2.643 6.93 2.643 9.574 0 2.57-2.57 2.641-6.693.214-9.35l-.214-.224L16.563 7c-2.657-2.427-6.78-2.356-9.35.214zm4.865.484l.02.003.026.005.041.01c.025.007.045.014.063.021l.043.019c.018.009.036.019.053.03.01.005.02.012.03.02.027.019.053.04.077.063l2.773 2.774c.24.24.24.63 0 .87-.213.214-.545.237-.785.071l-.085-.07-1.719-1.72v5.9c0 .34-.275.615-.615.615-.302 0-.553-.218-.605-.505l-.01-.11-.001-5.9-1.718 1.72c-.24.24-.63.24-.87 0-.214-.215-.238-.546-.072-.786l.072-.085 2.769-2.77.015-.014c.02-.018.04-.035.062-.05l.005-.004.008-.006c.027-.018.055-.034.085-.048l.034-.015.059-.02.032-.008c.021-.005.044-.008.068-.011l.038-.003H12.025l.027.002.026.002z\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalVideoTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = RemoteVideoTrack | LocalVideoTrack | undefined | null;\r\n\r\n// The 'switchedOff' event is emitted when there is not enough bandwidth to support\r\n// a track. See: https://www.twilio.com/docs/video/tutorials/using-bandwidth-profile-api#understanding-track-switch-offs\r\n\r\nexport default function useIsTrackSwitchedOff(track: TrackType) {\r\n  const [isSwitchedOff, setIsSwitchedOff] = useState(track && track.isSwitchedOff);\r\n\r\n  useEffect(() => {\r\n    // Reset the value if the 'track' variable changes\r\n    setIsSwitchedOff(track && track.isSwitchedOff);\r\n\r\n    if (track) {\r\n      const handleSwitchedOff = () => setIsSwitchedOff(true);\r\n      const handleSwitchedOn = () => setIsSwitchedOff(false);\r\n      track.on('switchedOff', handleSwitchedOff);\r\n      track.on('switchedOn', handleSwitchedOn);\r\n      return () => {\r\n        track.off('switchedOff', handleSwitchedOff);\r\n        track.off('switchedOn', handleSwitchedOn);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [track]);\r\n\r\n  return !!isSwitchedOff;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, Participant, RemoteTrackPublication } from 'twilio-video';\r\n\r\ntype TrackPublication = LocalTrackPublication | RemoteTrackPublication;\r\n\r\nexport default function usePublications(participant: Participant) {\r\n  const [publications, setPublications] = useState<TrackPublication[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Reset the publications when the 'participant' variable changes.\r\n    setPublications(Array.from(participant.tracks.values()) as TrackPublication[]);\r\n\r\n    const publicationAdded = (publication: TrackPublication) => setPublications((prevPublications) => [...prevPublications, publication]);\r\n    const publicationRemoved = (publication: TrackPublication) => setPublications((prevPublications) => prevPublications.filter((p) => p !== publication));\r\n\r\n    participant.on('trackPublished', publicationAdded);\r\n    participant.on('trackUnpublished', publicationRemoved);\r\n    return () => {\r\n      participant.off('trackPublished', publicationAdded);\r\n      participant.off('trackUnpublished', publicationRemoved);\r\n    };\r\n  }, [participant]);\r\n\r\n  return publications;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, RemoteTrackPublication } from 'twilio-video';\r\n\r\nexport default function useTrack(publication: LocalTrackPublication | RemoteTrackPublication | undefined) {\r\n  const [track, setTrack] = useState(publication && publication.track);\r\n\r\n  useEffect(() => {\r\n    // Reset the track when the 'publication' variable changes.\r\n    setTrack(publication && publication.track);\r\n\r\n    if (publication) {\r\n      const removeTrack = () => setTrack(null);\r\n\r\n      publication.on('subscribed', setTrack);\r\n      publication.on('unsubscribed', removeTrack);\r\n      return () => {\r\n        publication.off('subscribed', setTrack);\r\n        publication.off('unsubscribed', removeTrack);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [publication]);\r\n\r\n  return track;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantIsReconnecting(participant: Participant) {\r\n  const [isReconnecting, setIsReconnecting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleReconnecting = () => setIsReconnecting(true);\r\n    const handleReconnected = () => setIsReconnecting(false);\r\n\r\n    handleReconnected(); // Reset state when there is a new participant\r\n\r\n    participant.on('reconnecting', handleReconnecting);\r\n    participant.on('reconnected', handleReconnected);\r\n    return () => {\r\n      participant.off('reconnecting', handleReconnecting);\r\n      participant.off('reconnected', handleReconnected);\r\n    };\r\n  }, [participant]);\r\n\r\n  return isReconnecting;\r\n}\r\n","import React, { useCallback, useMemo } from 'react';\r\nimport clsx from 'clsx';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\nimport {\r\n  LocalAudioTrack, LocalVideoTrack, Participant, RemoteAudioTrack, RemoteVideoTrack,\r\n} from 'twilio-video';\r\n\r\nimport Typography from '@material-ui/core/Typography';\r\nimport AudioLevelIndicator from '../AudioLevelIndicator/AudioLevelIndicator';\r\nimport AvatarIcon from '../../icons/AvatarIcon';\r\nimport NetworkQualityLevel from '../NetworkQualityLevel/NetworkQualityLevel';\r\nimport PinIcon from './PinIcon/PinIcon';\r\nimport ScreenShareIcon from '../../icons/ScreenShareIcon';\r\n\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport useParticipantIsReconnecting from '../../hooks/useParticipantIsReconnecting/useParticipantIsReconnecting';\r\nimport { UserProfile } from '../../../../../CoveyTypes';\r\n// import BioPopover from \"../../../../Profile/BioPopover/BioPopover\";\r\n\r\nconst BORDER_SIZE = 3;\r\n\r\nconst useStyles = makeStyles((theme: Theme) => createStyles<any, {}>({\r\n  container: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    height: 0,\r\n    overflow: 'hidden',\r\n    '& video': {\r\n      filter: 'none',\r\n      objectFit: 'contain !important' as any,\r\n    },\r\n    paddingTop: `calc(${(9 / 16) * 100}% - ${BORDER_SIZE}px)`,\r\n    border: `${BORDER_SIZE}px solid black`,\r\n    background: 'black',\r\n  },\r\n  notContainedInGrid: {\r\n    [theme.breakpoints.down('sm')]: {\r\n      height: theme.sidebarMobileHeight,\r\n      width: `${(theme.sidebarMobileHeight * 16) / 9}px`,\r\n      marginRight: '8px',\r\n      marginBottom: '0',\r\n      fontSize: '10px',\r\n      paddingTop: `${theme.sidebarMobileHeight - 2}px`,\r\n    },\r\n  },\r\n  innerContainer: {\r\n    position: 'absolute',\r\n    top: 0,\r\n    left: 0,\r\n    width: '100%',\r\n    height: '100%',\r\n  },\r\n  infoContainer: {\r\n    position: 'absolute',\r\n    zIndex: 2,\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    justifyContent: 'space-between',\r\n    height: '100%',\r\n    width: '100%',\r\n    background: 'transparent',\r\n    top: 0,\r\n  },\r\n  avatarContainer: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'black',\r\n    position: 'absolute',\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    zIndex: 1,\r\n    [theme.breakpoints.down('sm')]: {\r\n      '& svg': {\r\n        transform: 'scale(0.7)',\r\n      },\r\n    },\r\n  },\r\n  reconnectingContainer: {\r\n    position: 'absolute',\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'rgba(40, 42, 43, 0.75)',\r\n    zIndex: 1,\r\n  },\r\n  screenShareIconContainer: {\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n    padding: '0.18em 0.3em',\r\n    marginRight: '0.3em',\r\n    display: 'flex',\r\n    '& path': {\r\n      fill: 'white',\r\n    },\r\n  },\r\n  identity: {\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n    color: 'white',\r\n    padding: '0.18em 0.3em',\r\n    margin: 0,\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n  },\r\n  infoRowBottom: {\r\n    display: 'flex',\r\n    justifyContent: 'space-between',\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    left: 0,\r\n  },\r\n  networkQualityContainer: {\r\n    width: '28px',\r\n    height: '28px',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n  },\r\n  typeography: {\r\n    color: 'white',\r\n    [theme.breakpoints.down('sm')]: {\r\n      fontSize: '0.75rem',\r\n    },\r\n  },\r\n  hideParticipant: {\r\n    display: 'none',\r\n  },\r\n  cursorPointer: {\r\n    cursor: 'pointer',\r\n  },\r\n  highlightParticipant: {\r\n    border: `${BORDER_SIZE}px solid ${theme.palette.primary.main}`,\r\n  },\r\n}));\r\n\r\ninterface ParticipantInfoProps {\r\n  participant: Participant;\r\n  profile?: UserProfile;\r\n  children: React.ReactNode;\r\n  onClick?: () => void;\r\n  isSelected?: boolean;\r\n  isLocalParticipant?: boolean;\r\n  hideParticipant?: boolean;\r\n  slot?: number;\r\n  insideGrid: boolean;\r\n  highlight?: boolean;\r\n}\r\n\r\nexport default function ParticipantInfo({\r\n  participant,\r\n  profile,\r\n  onClick,\r\n  isSelected,\r\n  children,\r\n  isLocalParticipant,\r\n  hideParticipant,\r\n  slot,\r\n  insideGrid,\r\n  highlight,\r\n}: ParticipantInfoProps) {\r\n  const publications = usePublications(participant);\r\n\r\n  const audioPublication = publications.find((p) => p.kind === 'audio');\r\n  const videoPublication = publications.find((p) => p.trackName.includes('camera'));\r\n\r\n  const isVideoEnabled = Boolean(videoPublication);\r\n  const isScreenShareEnabled = publications.find((p) => p.trackName.includes('screen'));\r\n\r\n  const videoTrack = useTrack(videoPublication);\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n\r\n  const audioTrack = useTrack(audioPublication) as LocalAudioTrack | RemoteAudioTrack | undefined;\r\n  const isParticipantReconnecting = useParticipantIsReconnecting(participant);\r\n\r\n  const classes = useStyles();\r\n\r\n  const [anchorEl, setAnchorEl] = React.useState<HTMLElement | null>(null);\r\n\r\n  const handlePopoverOpen = useCallback((event: React.MouseEvent<HTMLElement, MouseEvent>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  }, []);\r\n\r\n  const handlePopoverClose = useCallback(() => {\r\n    setAnchorEl(null);\r\n  }, []);\r\n\r\n  const bioPopoverOpen = Boolean(anchorEl);\r\n\r\n  // const profilePopoverEl = useMemo(() => {\r\n  //     return profile ? (\r\n  //         <BioPopover\r\n  //             id={`${profile.id}-mouse-over-popover`}\r\n  //             profile={profile}\r\n  //             open={bioPopoverOpen}\r\n  //             anchorEl={anchorEl}\r\n  //             onClose={handlePopoverClose}\r\n  //         />\r\n  //     ) : <></>;\r\n  // }, [anchorEl, bioPopoverOpen, handlePopoverClose, profile]);\r\n\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        classes.container,\r\n        {\r\n          [classes.hideParticipant]: hideParticipant,\r\n          [classes.cursorPointer]: Boolean(onClick),\r\n          [classes.notContainedInGrid]: !insideGrid,\r\n          [classes.highlightParticipant]: highlight,\r\n        },\r\n        slot !== undefined ? `area-${slot}` : undefined,\r\n      )}\r\n      onClick={onClick}\r\n      data-cy-participant={participant.identity}\r\n    >\r\n      <div className={classes.infoContainer}>\r\n        <div className={classes.networkQualityContainer}>\r\n          <NetworkQualityLevel participant={participant} />\r\n        </div>\r\n        <div className={classes.infoRowBottom}>\r\n          {isScreenShareEnabled && (\r\n            <span className={classes.screenShareIconContainer}>\r\n              <ScreenShareIcon />\r\n            </span>\r\n          )}\r\n          {/* {profilePopoverEl} */}\r\n          <a\r\n            className={classes.identity}\r\n            id={profile ? `${profile.id}-mouse-over-popover` : undefined}\r\n            aria-haspopup=\"true\"\r\n            onMouseEnter={handlePopoverOpen}\r\n            onMouseLeave={handlePopoverClose}\r\n            href={`/profile/${profile ? profile.id : ''}`}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            <AudioLevelIndicator audioTrack={audioTrack} />\r\n            <Typography variant=\"body1\" className={classes.typeography} component=\"span\">\r\n              {profile ? profile.displayName : ''}\r\n              {isLocalParticipant && ' (You)'}\r\n            </Typography>\r\n          </a>\r\n        </div>\r\n        <div>{isSelected && <PinIcon />}</div>\r\n      </div>\r\n      <div className={classes.innerContainer}>\r\n        {(!isVideoEnabled || isVideoSwitchedOff) && (\r\n        <div className={classes.avatarContainer}>\r\n          <AvatarIcon />\r\n        </div>\r\n        )}\r\n        {isParticipantReconnecting && (\r\n        <div className={classes.reconnectingContainer}>\r\n          <Typography variant=\"body1\" className={classes.typeography}>\r\n            Reconnecting...\r\n          </Typography>\r\n        </div>\r\n        )}\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import isPlainObject from 'is-plain-object';\r\n\r\nexport const isMobile = (() => {\r\n  if (typeof navigator === 'undefined' || typeof navigator.userAgent !== 'string') {\r\n    return false;\r\n  }\r\n  return /Mobile/.test(navigator.userAgent);\r\n})();\r\n\r\n// Recursively removes any object keys with a value of undefined\r\nexport function removeUndefineds<T>(obj: T): T {\r\n  if (!isPlainObject(obj)) return obj;\r\n\r\n  const target: { [name: string]: any } = {};\r\n\r\n  for (const key in obj) {\r\n    const val = obj[key];\r\n    if (typeof val !== 'undefined') {\r\n      target[key] = removeUndefineds(val);\r\n    }\r\n  }\r\n\r\n  return target as T;\r\n}\r\n","import { Track, VideoBandwidthProfileOptions } from 'twilio-video';\r\nimport { isMobile } from '../../utils';\r\nimport { RenderDimensionValue } from './renderDimensions';\r\n\r\nexport interface Settings {\r\n  trackSwitchOffMode: VideoBandwidthProfileOptions['trackSwitchOffMode'];\r\n  dominantSpeakerPriority?: Track.Priority;\r\n  bandwidthProfileMode: VideoBandwidthProfileOptions['mode'];\r\n  maxTracks: string;\r\n  maxAudioBitrate: string;\r\n  renderDimensionLow?: RenderDimensionValue;\r\n  renderDimensionStandard?: RenderDimensionValue;\r\n  renderDimensionHigh?: RenderDimensionValue;\r\n}\r\n\r\ntype SettingsKeys = keyof Settings;\r\n\r\nexport interface SettingsAction {\r\n  name: SettingsKeys;\r\n  value: string;\r\n}\r\n\r\nexport const initialSettings: Settings = {\r\n  trackSwitchOffMode: undefined,\r\n  dominantSpeakerPriority: 'standard',\r\n  bandwidthProfileMode: 'collaboration',\r\n  maxTracks: isMobile ? '5' : '10',\r\n  maxAudioBitrate: '16000',\r\n  renderDimensionLow: 'low',\r\n  renderDimensionStandard: '960p',\r\n  renderDimensionHigh: 'wide1080p',\r\n};\r\n\r\n// This inputLabels object is used by ConnectionOptions.tsx. It is used to populate the id, name, and label props\r\n// of the various input elements. Using a typed object like this (instead of strings) eliminates the possibility\r\n// of there being a typo.\r\nexport const inputLabels = (() => {\r\n  const target: any = {};\r\n  for (const setting in initialSettings) {\r\n    target[setting] = setting as SettingsKeys;\r\n  }\r\n  return target as { [key in SettingsKeys]: string };\r\n})();\r\n\r\nexport function settingsReducer(state: Settings, action: SettingsAction) {\r\n  return {\r\n    ...state,\r\n    [action.name]: action.value === 'default' ? undefined : action.value,\r\n  };\r\n}\r\n","import React, {\r\n  createContext, useContext, useReducer, useState,\r\n} from 'react';\r\nimport { TwilioError } from 'twilio-video';\r\nimport assert from 'assert';\r\nimport { RoomType } from '../types';\r\nimport {\r\n  settingsReducer, initialSettings, Settings, SettingsAction,\r\n} from './settings/settingsReducer';\r\nimport { VideoRoom } from '../../../../CoveyTypes';\r\n\r\nexport interface StateContextType {\r\n  error: TwilioError | null;\r\n  setError(error: TwilioError | null): void;\r\n  getToken(\r\n    room: VideoRoom\r\n  ): Promise<{\r\n    token: string | null;\r\n    expiry: Date | null;\r\n    twilioRoomId: string | null;\r\n  }>;\r\n  isAuthReady?: boolean;\r\n  isFetching: boolean;\r\n  activeSinkId: string;\r\n  setActiveSinkId(sinkId: string): void;\r\n  settings: Settings;\r\n  dispatchSetting: React.Dispatch<SettingsAction>;\r\n  roomType?: RoomType;\r\n  toggleWidth(): void;\r\n  preferredMode: 'sidebar' | 'fullwidth';\r\n  highlightedProfiles: string[];\r\n}\r\n\r\nexport const StateContext = createContext<StateContextType>(null!);\r\n\r\n/*\r\n  The 'react-hooks/rules-of-hooks' linting rules prevent React Hooks fron being called\r\n  inside of if() statements. This is because hooks must always be called in the same order\r\n  every time a component is rendered. The 'react-hooks/rules-of-hooks' rule is disabled below\r\n  because the \"if (process.env.REACT_APP_SET_AUTH === 'firebase')\" statements are evaluated\r\n  at build time (not runtime). If the statement evaluates to false, then the code is not\r\n  included in the bundle that is produced (due to tree-shaking). Thus, in this instance, it\r\n  is ok to call hooks inside if() statements.\r\n*/\r\nexport default function AppStateProvider(\r\n  props: React.PropsWithChildren<{\r\n    toggleWidth?: StateContextType['toggleWidth'];\r\n    preferredMode: StateContextType['preferredMode'];\r\n    highlightedProfiles: StateContextType['highlightedProfiles'];\r\n  }>,\r\n) {\r\n  const [error, setError] = useState<TwilioError | null>(null);\r\n  const [isFetching, setIsFetching] = useState(false);\r\n  const [activeSinkId, setActiveSinkId] = useState('default');\r\n  const [settings, dispatchSetting] = useReducer(settingsReducer, initialSettings);\r\n\r\n  const contextValue = {\r\n    error,\r\n    setError,\r\n    isFetching,\r\n    activeSinkId,\r\n    setActiveSinkId,\r\n    settings,\r\n    dispatchSetting,\r\n    toggleWidth: props.toggleWidth ?? (() => {}),\r\n    preferredMode: props.preferredMode,\r\n    highlightedProfiles: props.highlightedProfiles,\r\n  } as StateContextType;\r\n\r\n  const getToken: StateContextType['getToken'] = (room) => {\r\n    setIsFetching(true);\r\n    return contextValue\r\n      .getToken(room)\r\n      .then((res) => {\r\n        setIsFetching(false);\r\n        return res;\r\n      })\r\n      .catch((err) => {\r\n        setError(err);\r\n        setIsFetching(false);\r\n        return Promise.reject(err);\r\n      });\r\n  };\r\n\r\n  return <StateContext.Provider value={{ ...contextValue, getToken }}>{props.children}</StateContext.Provider>;\r\n}\r\n\r\nexport function useAppState() {\r\n  const context = useContext(StateContext);\r\n  if (!context) {\r\n    throw new Error('useAppState must be used within the AppStateProvider');\r\n  }\r\n  return context;\r\n}\r\n","import { useEffect, useRef } from 'react';\r\nimport { AudioTrack as IAudioTrack } from 'twilio-video';\r\nimport { useAppState } from '../../state';\r\n\r\ninterface AudioTrackProps {\r\n  track: IAudioTrack;\r\n}\r\n\r\nexport default function AudioTrack({ track }: AudioTrackProps) {\r\n  const { activeSinkId } = useAppState();\r\n  const audioEl = useRef<HTMLAudioElement>();\r\n\r\n  useEffect(() => {\r\n    audioEl.current = track.attach();\r\n    audioEl.current.setAttribute('data-cy-audio-track-name', track.name);\r\n    document.body.appendChild(audioEl.current);\r\n    return () => track.detach().forEach((el) => el.remove());\r\n  }, [track]);\r\n\r\n  useEffect(() => {\r\n    audioEl.current?.setSinkId?.(activeSinkId);\r\n  }, [activeSinkId]);\r\n\r\n  return null;\r\n}\r\n","import React, { useRef, useEffect } from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Track } from 'twilio-video';\r\nimport { IVideoTrack } from '../../types';\r\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoTrackDimensions from '../../hooks/useVideoTrackDimensions/useVideoTrackDimensions';\r\n\r\nconst Video = styled('video')({\r\n  maxWidth: '100%',\r\n  maxHeight: '100%',\r\n  width: '100%',\r\n  objectFit: 'contain',\r\n});\r\n\r\ninterface VideoTrackProps {\r\n  track: IVideoTrack;\r\n  isLocal?: boolean;\r\n  priority?: Track.Priority | null;\r\n}\r\n\r\nexport default function VideoTrack({ track, isLocal, priority }: VideoTrackProps) {\r\n  const ref = useRef<HTMLVideoElement>(null!);\r\n  const mediaStreamTrack = useMediaStreamTrack(track);\r\n  const dimensions = useVideoTrackDimensions(track);\r\n  const isPortrait = (dimensions?.height ?? 0) > (dimensions?.width ?? 0);\r\n\r\n  useEffect(() => {\r\n    const el = ref.current;\r\n    el.muted = true;\r\n    if (track.setPriority && priority) {\r\n      track.setPriority(priority);\r\n    }\r\n    track.attach(el);\r\n    return () => {\r\n      track.detach(el);\r\n      if (track.setPriority && priority) {\r\n        // Passing `null` to setPriority will set the track's priority to that which it was published with.\r\n        track.setPriority(null);\r\n      }\r\n    };\r\n  }, [track, priority]);\r\n\r\n  // The local video track is mirrored if it is not facing the environment.\r\n  const isFrontFacing = mediaStreamTrack?.getSettings().facingMode !== 'environment';\r\n  const style = {\r\n    transform: isLocal && isFrontFacing ? 'rotateY(180deg)' : '',\r\n    objectFit: isPortrait || track.name.includes('screen') ? ('contain' as const) : ('cover' as const),\r\n  };\r\n\r\n  return <Video ref={ref} style={style} />;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalVideoTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = LocalVideoTrack | RemoteVideoTrack;\r\n\r\nexport default function useVideoTrackDimensions(track?: TrackType) {\r\n  const [dimensions, setDimensions] = useState(track?.dimensions);\r\n\r\n  useEffect(() => {\r\n    setDimensions(track?.dimensions);\r\n\r\n    if (track) {\r\n      const handleDimensionsChanged = (_track: TrackType) => setDimensions(_track?.dimensions);\r\n      track.on('dimensionsChanged', handleDimensionsChanged);\r\n      return () => {\r\n        track.off('dimensionsChanged', handleDimensionsChanged);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [track]);\r\n\r\n  return dimensions;\r\n}\r\n","import React from 'react';\r\nimport {\r\n  AudioTrack as IAudioTrack,\r\n  LocalTrackPublication,\r\n  Participant,\r\n  RemoteTrackPublication,\r\n  Track,\r\n} from 'twilio-video';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport AudioTrack from '../AudioTrack/AudioTrack';\r\nimport VideoTrack from '../VideoTrack/VideoTrack';\r\n\r\nimport { IVideoTrack } from '../../types';\r\n\r\ninterface PublicationProps {\r\n  publication: LocalTrackPublication | RemoteTrackPublication;\r\n  participant: Participant;\r\n  isLocalParticipant?: boolean;\r\n  videoOnly?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n}\r\n\r\nexport default function Publication({\r\n  publication, isLocalParticipant, videoOnly, videoPriority,\r\n}: PublicationProps) {\r\n  const track = useTrack(publication);\r\n\r\n  if (!track) return null;\r\n\r\n  switch (track.kind) {\r\n    case 'video':\r\n      return (\r\n        <VideoTrack\r\n          track={track as IVideoTrack}\r\n          priority={videoPriority}\r\n          isLocal={track.name.includes('camera') && isLocalParticipant}\r\n        />\r\n      );\r\n    case 'audio':\r\n      return videoOnly ? null : <AudioTrack track={track as IAudioTrack} />;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Participant, Track } from 'twilio-video';\r\nimport Publication from '../Publication/Publication';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\n\r\ninterface ParticipantTracksProps {\r\n  participant: Participant;\r\n  videoOnly?: boolean;\r\n  enableScreenShare?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n  isLocalParticipant?: boolean;\r\n}\r\n\r\n/*\r\n *  The object model for the Room object (found here: https://www.twilio.com/docs/video/migrating-1x-2x#object-model) shows\r\n *  that Participant objects have TrackPublications, and TrackPublication objects have Tracks.\r\n *\r\n *  The React components in this application follow the same pattern. This ParticipantTracks component renders Publications,\r\n *  and the Publication component renders Tracks.\r\n */\r\n\r\nexport default function ParticipantTracks({\r\n  participant,\r\n  videoOnly,\r\n  enableScreenShare,\r\n  videoPriority,\r\n  isLocalParticipant,\r\n}: ParticipantTracksProps) {\r\n  const publications = usePublications(participant);\r\n\r\n  let filteredPublications;\r\n\r\n  if (enableScreenShare && publications.some((p) => p.trackName.includes('screen'))) {\r\n    filteredPublications = publications.filter((p) => !p.trackName.includes('camera'));\r\n  } else {\r\n    filteredPublications = publications.filter((p) => !p.trackName.includes('screen'));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {filteredPublications.map((publication) => (\r\n        <Publication\r\n          key={publication.kind}\r\n          publication={publication}\r\n          participant={participant}\r\n          isLocalParticipant={isLocalParticipant}\r\n          videoOnly={videoOnly}\r\n          videoPriority={videoPriority}\r\n        />\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Participant as IParticipant } from 'twilio-video';\r\nimport ParticipantInfo from '../ParticipantInfo/ParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport { UserProfile } from '../../../../../CoveyTypes';\r\n\r\ninterface ParticipantProps {\r\n  participant: IParticipant;\r\n  profile?: UserProfile;\r\n  videoOnly?: boolean;\r\n  enableScreenShare?: boolean;\r\n  onClick?: () => void;\r\n  isSelected?: boolean;\r\n  isDominantSpeaker?: boolean;\r\n  isLocalParticipant?: boolean;\r\n  hideParticipant?: boolean;\r\n  slot?: number;\r\n  insideGrid: boolean;\r\n  highlight?: boolean;\r\n}\r\n\r\nexport default function Participant({\r\n  participant,\r\n  profile,\r\n  videoOnly,\r\n  enableScreenShare,\r\n  onClick,\r\n  isSelected,\r\n  isLocalParticipant,\r\n  hideParticipant,\r\n  slot,\r\n  insideGrid,\r\n  highlight,\r\n}: ParticipantProps) {\r\n  return (\r\n    <ParticipantInfo\r\n      participant={participant}\r\n      profile={profile}\r\n      onClick={onClick}\r\n      isSelected={isSelected}\r\n      isLocalParticipant={isLocalParticipant}\r\n      hideParticipant={hideParticipant}\r\n      slot={slot}\r\n      insideGrid={insideGrid}\r\n      highlight={highlight}\r\n    >\r\n      <ParticipantTracks\r\n        participant={participant}\r\n        videoOnly={videoOnly}\r\n        enableScreenShare={enableScreenShare}\r\n        isLocalParticipant={isLocalParticipant}\r\n      />\r\n    </ParticipantInfo>\r\n  );\r\n}\r\n","import React, {\r\n  createContext, useContext, useState, useEffect,\r\n} from 'react';\r\nimport { Participant, Room } from 'twilio-video';\r\n\r\ntype selectedParticipantContextType = [Participant | null, (participant: Participant) => void];\r\n\r\nexport const selectedParticipantContext = createContext<selectedParticipantContextType>(null!);\r\n\r\nexport default function useSelectedParticipant() {\r\n  const [selectedParticipant, setSelectedParticipant] = useContext(selectedParticipantContext);\r\n  return [selectedParticipant, setSelectedParticipant] as const;\r\n}\r\n\r\ntype SelectedParticipantProviderProps = {\r\n  room: Room;\r\n  children: React.ReactNode;\r\n};\r\n\r\nexport function SelectedParticipantProvider({ room, children }: SelectedParticipantProviderProps) {\r\n  const [selectedParticipant, _setSelectedParticipant] = useState<Participant | null>(null);\r\n  const setSelectedParticipant = (participant: Participant) => _setSelectedParticipant((prevParticipant) => (prevParticipant === participant ? null : participant));\r\n\r\n  useEffect(() => {\r\n    const onDisconnect = () => _setSelectedParticipant(null);\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room]);\r\n\r\n  return (\r\n    <selectedParticipantContext.Provider value={[selectedParticipant, setSelectedParticipant]}>\r\n      {children}\r\n    </selectedParticipantContext.Provider>\r\n  );\r\n}\r\n","export default class TwilioVideo {\r\n  private static readonly twilioVideoCameraEnabledKey = 'twilioVideoCameraEnabled';\r\n\r\n  private static readonly twilioVideoMicEnabledKey = 'twilioVideoMicEnabled';\r\n\r\n  private static readonly twilioVideoLastCameraKey = 'twilioVideoLastCamera';\r\n\r\n  private static readonly twilioVideoLastMicKey = 'twilioVideoLastMic';\r\n\r\n  static get twilioVideoCameraEnabled(): boolean | null {\r\n    return localStorage.getItem(TwilioVideo.twilioVideoCameraEnabledKey) === 'true';\r\n  }\r\n\r\n  static set twilioVideoCameraEnabled(value: boolean | null) {\r\n    if (value !== null) {\r\n      localStorage.setItem(TwilioVideo.twilioVideoCameraEnabledKey, value === true ? 'true' : 'false');\r\n    } else {\r\n      localStorage.removeItem(TwilioVideo.twilioVideoCameraEnabledKey);\r\n    }\r\n  }\r\n\r\n  static get twilioVideoMicEnabled(): boolean | null {\r\n    return localStorage.getItem(TwilioVideo.twilioVideoMicEnabledKey) === 'true';\r\n  }\r\n\r\n  static set twilioVideoMicEnabled(value: boolean | null) {\r\n    if (value !== null) {\r\n      localStorage.setItem(TwilioVideo.twilioVideoMicEnabledKey, value === true ? 'true' : 'false');\r\n    } else {\r\n      localStorage.removeItem(TwilioVideo.twilioVideoMicEnabledKey);\r\n    }\r\n  }\r\n\r\n  static get twilioVideoLastCamera(): string | null {\r\n    return localStorage.getItem(TwilioVideo.twilioVideoLastCameraKey);\r\n  }\r\n\r\n  static set twilioVideoLastCamera(value: string | null) {\r\n    if (value) {\r\n      localStorage.setItem(TwilioVideo.twilioVideoLastCameraKey, value);\r\n    } else {\r\n      localStorage.removeItem(TwilioVideo.twilioVideoLastCameraKey);\r\n    }\r\n  }\r\n\r\n  static get twilioVideoLastMic(): string | null {\r\n    return localStorage.getItem(TwilioVideo.twilioVideoLastMicKey);\r\n  }\r\n\r\n  static set twilioVideoLastMic(value: string | null) {\r\n    if (value) {\r\n      localStorage.setItem(TwilioVideo.twilioVideoLastMicKey, value);\r\n    } else {\r\n      localStorage.removeItem(TwilioVideo.twilioVideoLastMicKey);\r\n    }\r\n  }\r\n}\r\n","import { useCallback, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\nimport LocalStorage_TwilioVideo from '../../../../../classes/LocalStorage/TwilioVideo';\r\n\r\nexport default function useLocalVideoToggle() {\r\n  const {\r\n    room: { localParticipant },\r\n    localVideoTrack: videoTrack,\r\n    getLocalVideoTrack,\r\n    removeLocalVideoTrack,\r\n  } = useVideoContext();\r\n  const [isPublishing, setIsPublishing] = useState(false);\r\n\r\n  const stopVideo = useCallback(() => {\r\n    if (videoTrack) {\r\n      LocalStorage_TwilioVideo.twilioVideoLastCamera = videoTrack.mediaStreamTrack.getSettings().deviceId ?? null;\r\n      const localTrackPublication = localParticipant?.unpublishTrack(videoTrack);\r\n      // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n      localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n      removeLocalVideoTrack();\r\n    }\r\n  }, [localParticipant, removeLocalVideoTrack, videoTrack]);\r\n\r\n  const toggleVideoEnabled = useCallback(async () => {\r\n    if (!isPublishing) {\r\n      if (videoTrack) {\r\n        stopVideo();\r\n        LocalStorage_TwilioVideo.twilioVideoCameraEnabled = false;\r\n      } else {\r\n        setIsPublishing(true);\r\n        try {\r\n          LocalStorage_TwilioVideo.twilioVideoCameraEnabled = true;\r\n          const lastCamera = LocalStorage_TwilioVideo.twilioVideoLastCamera;\r\n          const track = lastCamera\r\n            ? await getLocalVideoTrack({\r\n              deviceId: { exact: lastCamera },\r\n            })\r\n            : await getLocalVideoTrack();\r\n          localParticipant?.publishTrack(track, { priority: 'low' });\r\n        } catch (e) {\r\n          // If the device is not readable (probably in use by another app), don't try to\r\n          // use it next time.\r\n          console.log(e.name);\r\n          if (e?.name === 'NotReadableError' || e?.name === 'OverconstrainedError') {\r\n            LocalStorage_TwilioVideo.twilioVideoLastCamera = null;\r\n          }\r\n          throw e;\r\n        } finally {\r\n          setIsPublishing(false);\r\n        }\r\n      }\r\n    }\r\n  }, [isPublishing, videoTrack, stopVideo, getLocalVideoTrack, localParticipant]);\r\n\r\n  return { isEnabled: !!videoTrack, toggleVideoEnabled, stopVideo } as const;\r\n}\r\n","import { useEffect, useRef } from 'react';\r\nimport { isMobile } from '../../../utils';\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\n/*\r\n  This component adds a visibilitychange handler to the document when\r\n  the user is using a mobile device. When the handler detects that\r\n  the browser has been backgrounded, it unpublishes the users local\r\n  video track. The browser cannot send video to the room when it has\r\n  been backgrounded, so unpublishing the track stops video capture\r\n  on the device, and triggers a UI update for all other participants\r\n  to show that this user's video track has been turned off.\r\n*/\r\n\r\nexport default function AttachVisibilityHandler() {\r\n  const { room } = useVideoContext();\r\n  const { isEnabled: isVideoEnabled, toggleVideoEnabled } = useLocalVideoToggle();\r\n  const shouldRepublishVideoOnForeground = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (isMobile) {\r\n      const handleVisibilityChange = () => {\r\n        // We don't need to unpublish the local video track if it has already been unpublished\r\n        if (document.visibilityState === 'hidden' && isVideoEnabled) {\r\n          shouldRepublishVideoOnForeground.current = true;\r\n          toggleVideoEnabled();\r\n\r\n          // Don't publish the local video track if it wasn't published before the app was backgrounded\r\n        } else if (shouldRepublishVideoOnForeground.current) {\r\n          shouldRepublishVideoOnForeground.current = false;\r\n          toggleVideoEnabled();\r\n        }\r\n      };\r\n\r\n      document.addEventListener('visibilitychange', handleVisibilityChange);\r\n      return () => {\r\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      };\r\n    }\r\n    return () => {};\r\n  }, [isVideoEnabled, room, toggleVideoEnabled]);\r\n\r\n  return null;\r\n}\r\n","import { useState, useEffect } from 'react';\r\n\r\nexport function useDevices() {\r\n  const [devices, setDevices] = useState<MediaDeviceInfo[]>([]);\r\n\r\n  useEffect(() => {\r\n    const getDevices = () => navigator.mediaDevices.enumerateDevices().then((_devices) => setDevices(_devices));\r\n    navigator.mediaDevices.addEventListener('devicechange', getDevices);\r\n    getDevices();\r\n\r\n    return () => {\r\n      navigator.mediaDevices.removeEventListener('devicechange', getDevices);\r\n    };\r\n  }, []);\r\n\r\n  return devices;\r\n}\r\n\r\nexport function useAudioInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter((device) => device.kind === 'audioinput');\r\n}\r\n\r\nexport function useVideoInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter((device) => device.kind === 'videoinput');\r\n}\r\n\r\nexport function useAudioOutputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter((device) => device.kind === 'audiooutput');\r\n}\r\n\r\nexport function useHasAudioInputDevices() {\r\n  const audioDevices = useAudioInputDevices();\r\n  return audioDevices.length > 0;\r\n}\r\n\r\nexport function useHasVideoInputDevices() {\r\n  const videoDevices = useVideoInputDevices();\r\n  return videoDevices.length > 0;\r\n}\r\n","export const DEFAULT_VIDEO_CONSTRAINTS: MediaStreamConstraints['video'] = {\r\n  width: 1280,\r\n  height: 720,\r\n  frameRate: 24,\r\n};\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant, TrackPublication } from 'twilio-video';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\n/*\r\n  Returns the participant that is sharing their screen (if any). This hook assumes that only one participant\r\n  can share their screen at a time.\r\n*/\r\nexport default function useScreenShareParticipant() {\r\n  const { room } = useVideoContext();\r\n  const [screenShareParticipant, setScreenShareParticipant] = useState<Participant>();\r\n\r\n  useEffect(() => {\r\n    if (room.state === 'connected') {\r\n      const updateScreenShareParticipant = () => {\r\n        setScreenShareParticipant(\r\n          Array.from<Participant>(room.participants.values())\r\n          // the screenshare participant could be the localParticipant\r\n            .concat(room.localParticipant)\r\n            .find((participant: Participant) => Array.from<TrackPublication>(participant.tracks.values()).find((track) => track.trackName.includes('screen'))),\r\n        );\r\n      };\r\n      updateScreenShareParticipant();\r\n\r\n      room.on('trackPublished', updateScreenShareParticipant);\r\n      room.on('trackUnpublished', updateScreenShareParticipant);\r\n      room.on('participantDisconnected', updateScreenShareParticipant);\r\n\r\n      // the room object does not emit 'trackPublished' events for the localParticipant,\r\n      // so we need to listen for them here.\r\n      room.localParticipant.on('trackPublished', updateScreenShareParticipant);\r\n      room.localParticipant.on('trackUnpublished', updateScreenShareParticipant);\r\n      return () => {\r\n        room.off('trackPublished', updateScreenShareParticipant);\r\n        room.off('trackUnpublished', updateScreenShareParticipant);\r\n        room.off('participantDisconnected', updateScreenShareParticipant);\r\n\r\n        room.localParticipant.off('trackPublished', updateScreenShareParticipant);\r\n        room.localParticipant.off('trackUnpublished', updateScreenShareParticipant);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [room]);\r\n\r\n  return screenShareParticipant;\r\n}\r\n","import EventEmitter from 'events';\r\nimport Video, {\r\n  ConnectOptions, LocalAudioTrack, LocalTrack, LocalVideoTrack, Room,\r\n} from 'twilio-video';\r\nimport {\r\n  useCallback, useEffect, useRef, useState,\r\n} from 'react';\r\nimport { isMobile } from '../../../utils';\r\nimport { Callback } from '../../../types';\r\n\r\n// @ts-ignore\r\nwindow.TwilioVideo = Video;\r\n\r\nexport default function useRoom(\r\n  localAudioTrack: LocalAudioTrack | undefined,\r\n  localVideoTrack: LocalVideoTrack | undefined,\r\n  onError: Callback,\r\n  options?: ConnectOptions,\r\n) {\r\n  // @ts-ignore\r\n  const [room, setRoom] = useState<Room>(new EventEmitter() as Room);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const optionsRef = useRef(options);\r\n\r\n  useEffect(() => {\r\n    // This allows the connect function to always access the most recent version of the options object. This allows us to\r\n    // reliably use the connect function at any time.\r\n    optionsRef.current = options;\r\n  }, [options]);\r\n\r\n  const connect = useCallback(\r\n    (token) => {\r\n      setIsConnecting(true);\r\n      const localTracks = [localAudioTrack, localVideoTrack].filter((x) => x !== undefined) as LocalTrack[];\r\n      return Video.connect(token, { ...optionsRef.current, tracks: localTracks }).then(\r\n        (newRoom) => {\r\n          setRoom(newRoom);\r\n          const disconnect = () => newRoom.disconnect();\r\n\r\n          // This app can add up to 13 'participantDisconnected' listeners to the room object, which can trigger\r\n          // a warning from the EventEmitter object. Here we increase the max listeners to suppress the warning.\r\n          newRoom.setMaxListeners(15);\r\n\r\n          newRoom.once('disconnected', () => {\r\n            // Reset the room only after all other `disconnected` listeners have been called.\r\n            // @ts-ignore\r\n            setTimeout(() => setRoom(new EventEmitter() as Room));\r\n            window.removeEventListener('beforeunload', disconnect);\r\n\r\n            if (isMobile) {\r\n              window.removeEventListener('pagehide', disconnect);\r\n            }\r\n          });\r\n\r\n          // @ts-ignore\r\n          window.twilioRoom = newRoom;\r\n\r\n          newRoom.localParticipant.videoTracks.forEach((publication) =>\r\n          // All video tracks are published with 'low' priority because the video track\r\n          // that is displayed in the 'MainParticipant' component will have it's priority\r\n          // set to 'high' via track.setPriority()\r\n            publication.setPriority('low'));\r\n\r\n          setIsConnecting(false);\r\n\r\n          // Add a listener to disconnect from the room when a user closes their browser\r\n          window.addEventListener('beforeunload', disconnect);\r\n\r\n          if (isMobile) {\r\n            // Add a listener to disconnect from the room when a mobile user closes their browser\r\n            window.addEventListener('pagehide', disconnect);\r\n          }\r\n        },\r\n        (error) => {\r\n          onError(error);\r\n          setIsConnecting(false);\r\n        },\r\n      );\r\n    },\r\n    [localAudioTrack, localVideoTrack, onError],\r\n  );\r\n\r\n  return { room, isConnecting, connect };\r\n}\r\n","import React, { createContext, useContext } from 'react';\r\nimport useScreenShareParticipant from '../../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport useSelectedParticipant from '../useSelectedParticipant/useSelectedParticipant';\r\n\r\nexport const presentingContext = createContext<'presenting' | 'not presenting'>(null!);\r\n\r\nexport default function usePresenting() {\r\n  return useContext(presentingContext);\r\n}\r\n\r\ntype PresentingProviderProps = {\r\n  children: React.ReactNode;\r\n};\r\n\r\nexport function PresentingProvider({ children }: PresentingProviderProps) {\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n\r\n  return (\r\n    <presentingContext.Provider\r\n      value={selectedParticipant || screenShareParticipant ? 'presenting' : 'not presenting'}\r\n    >\r\n      {children}\r\n    </presentingContext.Provider>\r\n  );\r\n}\r\n","import React, { createContext, ReactNode } from 'react';\r\nimport {\r\n  CreateLocalTrackOptions,\r\n  ConnectOptions,\r\n  LocalAudioTrack,\r\n  LocalVideoTrack,\r\n  Room,\r\n  TwilioError,\r\n} from 'twilio-video';\r\nimport { Callback, ErrorCallback } from '../../types';\r\nimport { SelectedParticipantProvider } from './useSelectedParticipant/useSelectedParticipant';\r\n\r\nimport AttachVisibilityHandler from './AttachVisibilityHandler/AttachVisibilityHandler';\r\nimport useHandleRoomDisconnectionErrors from './useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors';\r\nimport useHandleOnDisconnect from './useHandleOnDisconnect/useHandleOnDisconnect';\r\nimport useHandleTrackPublicationFailed from './useHandleTrackPublicationFailed/useHandleTrackPublicationFailed';\r\nimport useLocalTracks from './useLocalTracks/useLocalTracks';\r\nimport useRoom from './useRoom/useRoom';\r\nimport useScreenShareToggle from './useScreenShareToggle/useScreenShareToggle';\r\nimport { PresentingProvider } from './usePresenting/usePresenting';\r\n\r\n/*\r\n *  The hooks used by the VideoProvider component are different than the hooks found in the 'hooks/' directory. The hooks\r\n *  in the 'hooks/' directory can be used anywhere in a video application, and they can be used any number of times.\r\n *  the hooks in the 'VideoProvider/' directory are intended to be used by the VideoProvider component only. Using these hooks\r\n *  elsewhere in the application may cause problems as these hooks should not be used more than once in an application.\r\n */\r\n\r\nexport interface IVideoContext {\r\n  room: Room;\r\n  localAudioTrack: LocalAudioTrack | undefined;\r\n  localVideoTrack: LocalVideoTrack | undefined;\r\n  isConnecting: boolean;\r\n  connect: (token: string) => Promise<void>;\r\n  onError: ErrorCallback;\r\n  onDisconnect: Callback;\r\n  getLocalVideoTrack: (newOptions?: CreateLocalTrackOptions) => Promise<LocalVideoTrack>;\r\n  getLocalAudioTrack: (deviceId?: string) => Promise<LocalAudioTrack>;\r\n  isAcquiringLocalTracks: boolean;\r\n  removeLocalVideoTrack: () => void;\r\n  removeLocalAudioTrack: () => void;\r\n  isSharingScreen: boolean;\r\n  toggleScreenShare: () => void;\r\n  getAudioAndVideoTracks: () => Promise<void>;\r\n}\r\n\r\nexport const VideoContext = createContext<IVideoContext>(null!);\r\n\r\ninterface VideoProviderProps {\r\n  options?: ConnectOptions;\r\n  onError: ErrorCallback;\r\n  onDisconnect?: Callback;\r\n  children: ReactNode;\r\n}\r\n\r\nexport function VideoProvider({\r\n  options, children, onError = () => {}, onDisconnect = () => {},\r\n}: VideoProviderProps) {\r\n  const onErrorCallback = (error: TwilioError) => {\r\n    // tslint:disable-next-line:no-console\r\n    console.log(`ERROR: ${error.message}`, error);\r\n    onError(error);\r\n  };\r\n\r\n  const {\r\n    audioTrack: localAudioTrack,\r\n    videoTrack: localVideoTrack,\r\n    getLocalVideoTrack,\r\n    getLocalAudioTrack,\r\n    isAcquiringLocalTracks,\r\n    removeLocalVideoTrack,\r\n    removeLocalAudioTrack,\r\n    getAudioAndVideoTracks,\r\n  } = useLocalTracks();\r\n  const { room, isConnecting, connect } = useRoom(localAudioTrack, localVideoTrack, onErrorCallback, options);\r\n\r\n  // Register onError and onDisconnect callback functions.\r\n  useHandleRoomDisconnectionErrors(room, onError);\r\n  useHandleTrackPublicationFailed(room, onError);\r\n  useHandleOnDisconnect(room, onDisconnect);\r\n  const [isSharingScreen, toggleScreenShare] = useScreenShareToggle(room, onError);\r\n\r\n  return (\r\n    <VideoContext.Provider\r\n      value={{\r\n        room,\r\n        localAudioTrack,\r\n        localVideoTrack,\r\n        isConnecting,\r\n        onError: onErrorCallback,\r\n        onDisconnect,\r\n        getLocalVideoTrack,\r\n        getLocalAudioTrack,\r\n        connect,\r\n        isAcquiringLocalTracks,\r\n        removeLocalVideoTrack,\r\n        removeLocalAudioTrack,\r\n        isSharingScreen,\r\n        toggleScreenShare,\r\n        getAudioAndVideoTracks,\r\n      }}\r\n    >\r\n      <SelectedParticipantProvider room={room}>\r\n        <PresentingProvider>{children}</PresentingProvider>\r\n      </SelectedParticipantProvider>\r\n      {/*\r\n        The AttachVisibilityHandler component is using the useLocalVideoToggle hook\r\n        which must be used within the VideoContext Provider.\r\n      */}\r\n      <AttachVisibilityHandler />\r\n    </VideoContext.Provider>\r\n  );\r\n}\r\n","import { useCallback, useState } from 'react';\r\nimport Video, { LocalVideoTrack, LocalAudioTrack, CreateLocalTrackOptions } from 'twilio-video';\r\nimport { useMutex } from 'react-context-mutex';\r\nimport { useHasAudioInputDevices, useHasVideoInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\nimport { DEFAULT_VIDEO_CONSTRAINTS } from '../../../constants';\r\nimport LocalStorage_TwilioVideo from '../../../../../../classes/LocalStorage/TwilioVideo';\r\n\r\nexport default function useLocalTracks() {\r\n  const [audioTrack, setAudioTrack] = useState<LocalAudioTrack>();\r\n  const [videoTrack, setVideoTrack] = useState<LocalVideoTrack>();\r\n  const [isAcquiringLocalTracks, setIsAcquiringLocalTracks] = useState(false);\r\n\r\n  const hasAudio = useHasAudioInputDevices();\r\n  const hasVideo = useHasVideoInputDevices();\r\n\r\n  const getLocalAudioTrack = useCallback(async (deviceId?: string) => {\r\n    const options: CreateLocalTrackOptions = {};\r\n\r\n    if (deviceId) {\r\n      options.deviceId = { exact: deviceId };\r\n    }\r\n\r\n    console.log('Running getLocalAudioTrack');\r\n\r\n    const newTrack = await Video.createLocalAudioTrack(options);\r\n    setAudioTrack(newTrack);\r\n    return newTrack;\r\n  }, []);\r\n\r\n  const getLocalVideoTrack = useCallback((newOptions?: CreateLocalTrackOptions) => {\r\n    const options: CreateLocalTrackOptions = {\r\n      // ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n      width: 640,\r\n      height: 480,\r\n      frameRate: 24,\r\n      name: `camera-${Date.now()}`,\r\n      ...newOptions,\r\n    };\r\n\r\n    return Video.createLocalVideoTrack(options).then((newTrack) => {\r\n      setVideoTrack(newTrack);\r\n      return newTrack;\r\n    });\r\n  }, []);\r\n\r\n  const removeLocalVideoTrack = useCallback(() => {\r\n    if (videoTrack) {\r\n      videoTrack.stop();\r\n      setVideoTrack(undefined);\r\n    }\r\n  }, [videoTrack]);\r\n\r\n  const removeLocalAudioTrack = useCallback(() => {\r\n    if (audioTrack) {\r\n      audioTrack.stop();\r\n      setAudioTrack(undefined);\r\n    }\r\n  }, [audioTrack]);\r\n\r\n  const MutexRunner = useMutex();\r\n  const getAudioAndVideoTracksMutex = new MutexRunner('getAudioAndVideoTracks');\r\n  const getAudioAndVideoTracks = async () => getAudioAndVideoTracksMutex.run(\r\n    async () => {\r\n      getAudioAndVideoTracksMutex.lock();\r\n      try {\r\n        if (!hasAudio && !hasVideo) return Promise.resolve();\r\n        if (audioTrack || videoTrack) return Promise.resolve();\r\n\r\n        console.log('Running getAudioAndVideoTracks');\r\n\r\n        setIsAcquiringLocalTracks(true);\r\n        const tracks = await Video.createLocalTracks({\r\n          video: hasVideo && {\r\n            ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n            name: `camera-${Date.now()}`,\r\n            deviceId: LocalStorage_TwilioVideo.twilioVideoLastCamera ?? undefined,\r\n          },\r\n          audio: hasAudio && {\r\n            deviceId: LocalStorage_TwilioVideo.twilioVideoLastMic ?? undefined,\r\n          },\r\n        });\r\n\r\n        const _videoTrack = tracks.find((track) => track.kind === 'video');\r\n        const _audioTrack = tracks.find((track) => track.kind === 'audio');\r\n        if (_videoTrack) {\r\n          console.log('Running getAudioAndVideoTracks:setVideoTrack');\r\n          setVideoTrack(_videoTrack as LocalVideoTrack);\r\n        }\r\n        if (_audioTrack) {\r\n          console.log('Running getAudioAndVideoTracks:setAudioTrack');\r\n          setAudioTrack(_audioTrack as LocalAudioTrack);\r\n        }\r\n      } finally {\r\n        setIsAcquiringLocalTracks(false);\r\n        getAudioAndVideoTracksMutex.unlock();\r\n      }\r\n    },\r\n    () => {},\r\n  );\r\n\r\n  return {\r\n    audioTrack,\r\n    videoTrack,\r\n    getLocalVideoTrack,\r\n    getLocalAudioTrack,\r\n    isAcquiringLocalTracks,\r\n    removeLocalVideoTrack,\r\n    removeLocalAudioTrack,\r\n    getAudioAndVideoTracks,\r\n  };\r\n}\r\n","import { Room, TwilioError } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleRoomDisconnectionErrors(room: Room, onError: Callback) {\r\n  useEffect(() => {\r\n    const onDisconnected = (room: Room, error: TwilioError) => {\r\n      if (error) {\r\n        onError(error);\r\n      }\r\n    };\r\n\r\n    room.on('disconnected', onDisconnected);\r\n    return () => {\r\n      room.off('disconnected', onDisconnected);\r\n    };\r\n  }, [room, onError]);\r\n}\r\n","import { Room } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleTrackPublicationFailed(room: Room, onError: Callback) {\r\n  const { localParticipant } = room;\r\n  useEffect(() => {\r\n    if (localParticipant) {\r\n      localParticipant.on('trackPublicationFailed', onError);\r\n      return () => {\r\n        localParticipant.off('trackPublicationFailed', onError);\r\n      };\r\n    }\r\n    return () => { };\r\n  }, [localParticipant, onError]);\r\n}\r\n","import { useEffect } from 'react';\r\nimport { Room } from 'twilio-video';\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleOnDisconnect(room: Room, onDisconnect: Callback) {\r\n  useEffect(() => {\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room, onDisconnect]);\r\n}\r\n","import { useState, useCallback, useRef } from 'react';\r\nimport { LogLevels, Track, Room } from 'twilio-video';\r\nimport { ErrorCallback } from '../../../types';\r\n\r\ninterface MediaStreamTrackPublishOptions {\r\n  name?: string;\r\n  priority: Track.Priority;\r\n  logLevel: LogLevels;\r\n}\r\n\r\nexport default function useScreenShareToggle(room: Room, onError: ErrorCallback) {\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const stopScreenShareRef = useRef<() => void>(null!);\r\n\r\n  const shareScreen = useCallback(() => {\r\n    navigator.mediaDevices\r\n      .getDisplayMedia({\r\n        audio: false,\r\n        video: {\r\n          frameRate: 10,\r\n          height: 1080,\r\n          width: 1920,\r\n        },\r\n      })\r\n      .then((stream) => {\r\n        const track = stream.getTracks()[0];\r\n\r\n        // All video tracks are published with 'low' priority. This works because the video\r\n        // track that is displayed in the 'MainParticipant' component will have it's priority\r\n        // set to 'high' via track.setPriority()\r\n        room.localParticipant\r\n          .publishTrack(track, {\r\n            name: 'screen', // Tracks can be named to easily find them later\r\n            priority: 'low', // Priority is set to high by the subscriber when the video track is rendered\r\n          } as MediaStreamTrackPublishOptions)\r\n          .then((trackPublication) => {\r\n            stopScreenShareRef.current = () => {\r\n              room.localParticipant.unpublishTrack(track);\r\n              // TODO: remove this if the SDK is updated to emit this event\r\n              room.localParticipant.emit('trackUnpublished', trackPublication);\r\n              track.stop();\r\n              setIsSharing(false);\r\n            };\r\n\r\n            track.onended = stopScreenShareRef.current;\r\n            setIsSharing(true);\r\n          })\r\n          .catch(onError);\r\n      })\r\n      .catch((error) => {\r\n        // Don't display an error if the user closes the screen share dialog\r\n        if (error.name !== 'AbortError' && error.name !== 'NotAllowedError') {\r\n          onError(error);\r\n        }\r\n      });\r\n  }, [room, onError]);\r\n\r\n  const toggleScreenShare = useCallback(() => {\r\n    !isSharing ? shareScreen() : stopScreenShareRef.current();\r\n  }, [isSharing, shareScreen, stopScreenShareRef]);\r\n\r\n  return [isSharing, toggleScreenShare] as const;\r\n}\r\n","import { useContext } from 'react';\r\nimport { VideoContext } from '../../components/VideoProvider';\r\n\r\nexport default function useVideoContext() {\r\n  const context = useContext(VideoContext);\r\n  if (!context) {\r\n    throw new Error('useVideoContext must be used within a VideoProvider');\r\n  }\r\n  return context;\r\n}\r\n","import useVideoContext from '../useVideoContext/useVideoContext';\r\nimport useScreenShareParticipant from '../useScreenShareParticipant/useScreenShareParticipant';\r\nimport useSelectedParticipant from '../../components/VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\n\r\nexport default function useMainParticipant() {\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const remoteScreenShareParticipant = screenShareParticipant !== localParticipant ? screenShareParticipant : null;\r\n\r\n  // The participant that is returned is displayed in the main video area. Changing the order of the following\r\n  // variables will change the how the main speaker is determined.\r\n  return remoteScreenShareParticipant || selectedParticipant || localParticipant;\r\n}\r\n","import React from 'react';\r\nimport { NearbyPlayers } from '../CoveyTypes';\r\n\r\n/**\r\n * Hint: You will never need to use this directly. Instead, use the\r\n * `useCoveyAppState` hook.\r\n */\r\nconst Context = React.createContext<NearbyPlayers>({ nearbyPlayers: [] });\r\n\r\nexport default Context;\r\n","import React, { useState } from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles, createStyles, Theme } from '@material-ui/core/styles';\r\nimport Participant from '../Participant/Participant';\r\nimport useMainParticipant from '../../hooks/useMainParticipant/useMainParticipant';\r\nimport useParticipants, { ParticipantWithSlot } from '../../hooks/useParticipants/useParticipants';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\nimport useScreenShareParticipant from '../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport { UserProfile } from '../../../../../CoveyTypes';\r\n\r\nimport useNearbyPlayers from '../../../../../hooks/useNearbyPlayers';\r\n\r\nfunction useStyles(width: 'sidebar' | 'fullwidth') {\r\n  return makeStyles((theme: Theme) => createStyles({\r\n    container: {\r\n      padding: '2em',\r\n      overflowY: 'auto',\r\n      background: 'rgb(79, 83, 85)',\r\n      gridArea: '1 / 2 / 1 / 3',\r\n      zIndex: 5,\r\n      [theme.breakpoints.down('sm')]: {\r\n        gridArea: '2 / 1 / 3 / 3',\r\n        overflowY: 'initial',\r\n        overflowX: 'auto',\r\n        display: 'flex',\r\n        padding: '8px',\r\n      },\r\n    },\r\n    transparentBackground: {\r\n      background: 'transparent',\r\n    },\r\n    scrollContainer: {\r\n      [theme.breakpoints.down('sm')]: {\r\n        display: 'flex',\r\n      },\r\n    },\r\n    gridContainer: {\r\n      gridArea: '1 / 1 / 1 / 3',\r\n      overflowX: 'hidden',\r\n      overflowY: 'auto',\r\n      [theme.breakpoints.down('sm')]: {\r\n        gridArea: '1 / 1 / 3 / 1',\r\n      },\r\n    },\r\n    gridInnerContainer: {\r\n      display: 'grid',\r\n      gridTemplateColumns: width === 'sidebar' ? '1fr' : '1fr 1fr 1fr 1fr',\r\n      gridAutoRows: '1fr',\r\n      [theme.breakpoints.down('md')]: {\r\n        gridTemplateColumns: width === 'sidebar' ? '1fr' : '1fr 1fr 1fr',\r\n      },\r\n      [theme.breakpoints.down('sm')]: {\r\n        gridTemplateColumns: width === 'sidebar' ? '1fr' : '1fr 1fr',\r\n      },\r\n      [theme.breakpoints.down('xs')]: {\r\n        gridTemplateColumns: '1fr',\r\n      },\r\n    },\r\n  }))();\r\n}\r\n\r\nexport default function ParticipantList(props: { gridView: boolean }) {\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const participants = useParticipants();\r\n  const [selectedParticipant, setSelectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const mainParticipant = useMainParticipant();\r\n  const { nearbyPlayers } = useNearbyPlayers();\r\n\r\n  // const { preferredMode, highlightedProfiles } = useAppState();\r\n  // const classes = useStyles(preferredMode);\r\n\r\n  const classes = useStyles('fullwidth');\r\n\r\n  function participantSorter(x: ParticipantWithSlot, y: ParticipantWithSlot): number {\r\n    return x.slot < y.slot ? -1 : x.slot === y.slot ? 0 : 1;\r\n  }\r\n\r\n  const participantsEl = (\r\n    <>\r\n      <Participant\r\n        participant={localParticipant}\r\n        isLocalParticipant\r\n        insideGrid={props.gridView}\r\n                // highlight={highlightedProfiles?.includes(localUserProfile.id) ?? false}\r\n        slot={0}\r\n      />\r\n      {participants\r\n        .filter((p) => nearbyPlayers.find((player) => player.id == p.participant.identity))\r\n        .sort(participantSorter).map((participantWithSlot) => {\r\n          const { participant } = participantWithSlot;\r\n          const isSelected = participant === selectedParticipant;\r\n          const hideParticipant = participant === mainParticipant\r\n                    && participant !== screenShareParticipant\r\n                    && !isSelected\r\n                    && participants.length > 1;\r\n          const player = nearbyPlayers.find((p) => p.id == participantWithSlot.participant.identity);\r\n          const remoteProfile = { displayName: player ? player.userName : 'unknown', id: participantWithSlot.participant.identity };\r\n          return (\r\n            <Participant\r\n              key={participant.sid}\r\n                        // highlight={highlightedProfiles?.includes(participant.identity) ?? false}\r\n              participant={participant}\r\n              profile={remoteProfile}\r\n              isSelected={participant === selectedParticipant}\r\n              onClick={() => setSelectedParticipant(participant)}\r\n              hideParticipant={hideParticipant}\r\n              slot={participantWithSlot.slot}\r\n              insideGrid={props.gridView}\r\n            />\r\n          );\r\n        })}\r\n    </>\r\n  );\r\n\r\n  return props.gridView ? (\r\n    <main\r\n      className={clsx(\r\n        classes.gridContainer,\r\n        {\r\n          [classes.transparentBackground]: true,\r\n        },\r\n        'participants-grid-container',\r\n        {\r\n          // \"single-column\": preferredMode === \"sidebar\" && props.gridView,\r\n          'single-column': false,\r\n        },\r\n      )}\r\n    >\r\n      <div className={classes.gridInnerContainer}>{participantsEl}</div>\r\n    </main>\r\n  ) : (\r\n    <aside\r\n      className={clsx(classes.container, {\r\n        [classes.transparentBackground]: true,\r\n      })}\r\n    >\r\n      <div className={classes.scrollContainer}>{participantsEl}</div>\r\n    </aside>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant, RemoteParticipant } from 'twilio-video';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport type ParticipantWithSlot = {\r\n  participant: Participant,\r\n  slot: number\r\n};\r\n\r\nexport default function useParticipants() {\r\n  const { room } = useVideoContext();\r\n\r\n  const [participants, setParticipants] = useState<Array<ParticipantWithSlot>>(Array.from(room.participants.values()).map((x, idx) => ({\r\n    participant: x,\r\n    // Slot 0 is reserved for local participant\r\n    slot: idx + 1,\r\n  })));\r\n\r\n  useEffect(() => {\r\n    const participantConnected = (participant: RemoteParticipant) => setParticipants((prevParticipants) => {\r\n      let idx = 0;\r\n      const ps = prevParticipants.sort((x, y) => (x.slot < y.slot ? -1 : x.slot === y.slot ? 0 : 1));\r\n      while (idx < ps.length) {\r\n        if (idx + 1 === ps[idx].slot) {\r\n          idx++;\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      return [\r\n        ...prevParticipants,\r\n        {\r\n          participant,\r\n          // Slot 0 is reserved for local participant\r\n          slot: idx + 1,\r\n        },\r\n      ];\r\n    });\r\n\r\n    const participantDisconnected = (participant: RemoteParticipant) => setParticipants((prevParticipants) => prevParticipants.filter((p) => p.participant !== participant));\r\n    room.on('participantConnected', participantConnected);\r\n    room.on('participantDisconnected', participantDisconnected);\r\n    return () => {\r\n      room.off('participantConnected', participantConnected);\r\n      room.off('participantDisconnected', participantDisconnected);\r\n    };\r\n  }, [room]);\r\n\r\n  return participants;\r\n}\r\n","import assert from 'assert';\r\nimport { useContext } from 'react';\r\nimport { NearbyPlayers } from '../CoveyTypes';\r\nimport NearbyPlayersContext from '../contexts/NearbyPlayersContext';\r\n\r\nexport default function useNearbyPlayers(): NearbyPlayers {\r\n  const ctx = useContext(NearbyPlayersContext);\r\n  assert(ctx, 'App context should be defined.');\r\n  return ctx;\r\n}\r\n","import React, { useState } from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles, Theme } from '@material-ui/core/styles';\r\nimport {\r\n  LocalAudioTrack, LocalVideoTrack, Participant, RemoteAudioTrack, RemoteVideoTrack,\r\n} from 'twilio-video';\r\n\r\nimport Typography from '@material-ui/core/Typography';\r\nimport AvatarIcon from '../../icons/AvatarIcon';\r\n\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport useParticipantIsReconnecting from '../../hooks/useParticipantIsReconnecting/useParticipantIsReconnecting';\r\nimport AudioLevelIndicator from '../AudioLevelIndicator/AudioLevelIndicator';\r\n// import useConference from '../../../../../hooks/useConference';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\nimport { UserProfile } from '../../../../../CoveyTypes';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    cursor: 'pointer',\r\n  },\r\n  identity: {\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n    color: 'white',\r\n    padding: '0.1em 0.3em 0.1em 0',\r\n    fontSize: '1.2em',\r\n    display: 'inline-flex',\r\n    '& svg': {\r\n      marginLeft: '0.3em',\r\n    },\r\n  },\r\n  infoContainer: {\r\n    position: 'absolute',\r\n    zIndex: 2,\r\n    height: '100%',\r\n    width: '100%',\r\n  },\r\n  reconnectingContainer: {\r\n    position: 'absolute',\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'rgba(40, 42, 43, 0.75)',\r\n    zIndex: 1,\r\n  },\r\n  fullWidth: {\r\n    gridArea: '1 / 1 / 2 / 3',\r\n    [theme.breakpoints.down('sm')]: {\r\n      gridArea: '1 / 1 / 3 / 3',\r\n    },\r\n  },\r\n  avatarContainer: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'black',\r\n    position: 'absolute',\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    zIndex: 1,\r\n    '& svg': {\r\n      transform: 'scale(2)',\r\n    },\r\n  },\r\n}));\r\n\r\ninterface MainParticipantInfoProps {\r\n  participant: Participant;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function MainParticipantInfo({ participant, children }: MainParticipantInfoProps) {\r\n  const classes = useStyles();\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const isLocal = localParticipant === participant;\r\n\r\n  // const screenShareParticipant = useScreenShareParticipant();\r\n  // const isRemoteParticipantScreenSharing = screenShareParticipant && screenShareParticipant !== localParticipant;\r\n\r\n  const publications = usePublications(participant);\r\n  const videoPublication = publications.find((p) => p.trackName.includes('camera'));\r\n  const screenSharePublication = publications.find((p) => p.trackName.includes('screen'));\r\n  const setSelectedParticipant = useSelectedParticipant()[1];\r\n\r\n  const videoTrack = useTrack(screenSharePublication || videoPublication);\r\n  const isVideoEnabled = Boolean(videoTrack);\r\n\r\n  const audioPublication = publications.find((p) => p.kind === 'audio');\r\n  const audioTrack = useTrack(audioPublication) as LocalAudioTrack | RemoteAudioTrack | undefined;\r\n\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n  const isParticipantReconnecting = useParticipantIsReconnecting(participant);\r\n\r\n  const [participantProfile, setParticipantProfile] = useState<UserProfile | null>(null);\r\n  // useSafeAsync(() => UserProfile.get(participant.identity, conference.id), setParticipantProfile, [participant.identity], \"MainParticipantInfo:setParticipantProfile\");\r\n\r\n  return (\r\n    <div\r\n      data-cy-main-participant\r\n      data-cy-participant={participant.identity}\r\n      className={clsx(classes.container, {\r\n        [classes.fullWidth]: false,\r\n      })}\r\n      onClick={() => setSelectedParticipant(participant)}\r\n    >\r\n      <div className={classes.infoContainer}>\r\n        <div className={classes.identity}>\r\n          <AudioLevelIndicator audioTrack={audioTrack} />\r\n          <Typography variant=\"body1\" color=\"inherit\">\r\n            {participantProfile ? participantProfile.displayName : ''}\r\n            {isLocal && ' (You)'}\r\n            {screenSharePublication && ' - Screen'}\r\n          </Typography>\r\n        </div>\r\n      </div>\r\n      {(!isVideoEnabled || isVideoSwitchedOff) && (\r\n        <div className={classes.avatarContainer}>\r\n          <AvatarIcon />\r\n        </div>\r\n      )}\r\n      {isParticipantReconnecting && (\r\n        <div className={classes.reconnectingContainer}>\r\n          <Typography variant=\"body1\" style={{ color: 'white' }}>\r\n            Reconnecting...\r\n          </Typography>\r\n        </div>\r\n      )}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport MainParticipantInfo from '../MainParticipantInfo/MainParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport useMainParticipant from '../../hooks/useMainParticipant/useMainParticipant';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\nimport useScreenShareParticipant from '../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function MainParticipant() {\r\n  const mainParticipant = useMainParticipant();\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n\r\n  const videoPriority = (mainParticipant === selectedParticipant || mainParticipant === screenShareParticipant)\r\n    && mainParticipant !== localParticipant\r\n    ? 'high'\r\n    : null;\r\n\r\n  return (\r\n    /* audio is disabled for this participant component because this participant's audio\r\n       is already being rendered in the <ParticipantStrip /> component.  */\r\n    <MainParticipantInfo participant={mainParticipant}>\r\n      <ParticipantTracks\r\n        participant={mainParticipant}\r\n        videoOnly\r\n        enableScreenShare={mainParticipant !== localParticipant}\r\n        videoPriority={videoPriority}\r\n        isLocalParticipant={mainParticipant === localParticipant}\r\n      />\r\n    </MainParticipantInfo>\r\n  );\r\n}\r\n","import React, { useMemo } from 'react';\r\nimport { makeStyles, Theme } from '@material-ui/core/styles';\r\nimport clsx from 'clsx';\r\nimport ParticipantList from '../ParticipantList/ParticipantList';\r\nimport MainParticipant from '../MainParticipant/MainParticipant';\r\nimport usePresenting from '../VideoProvider/usePresenting/usePresenting';\r\nimport { useAppState } from '../../state';\r\n\r\ntype StyleProps = {\r\n  preferredMode: 'sidebar' | 'fullwidth';\r\n  presenting: 'presenting' | 'not presenting';\r\n};\r\n\r\nconst useStyles = makeStyles<Theme, StyleProps>((theme) => ({\r\n  container: (props) => ({\r\n    position: 'relative',\r\n    height: '100%',\r\n    display: 'grid',\r\n    gridTemplateColumns:\r\n            props.preferredMode === 'sidebar' && props.presenting === 'not presenting'\r\n              ? '1fr'\r\n              : `1fr ${theme.sidebarWidth}px`,\r\n    gridTemplateRows: '100%',\r\n    [theme.breakpoints.down('sm')]: {\r\n      gridTemplateColumns: '100%',\r\n      gridTemplateRows: `1fr ${theme.sidebarMobileHeight + 26}px`,\r\n      overflow: 'auto',\r\n    },\r\n  }),\r\n}));\r\n\r\nexport default function Room() {\r\n  const { preferredMode } = useAppState();\r\n  const presenting = usePresenting();\r\n  const classes = useStyles({ preferredMode, presenting });\r\n\r\n  return (\r\n    <div className={clsx(classes.container)}>\r\n      {presenting === 'presenting' ? <MainParticipant /> : <></>}\r\n      <ParticipantList gridView={presenting === 'not presenting'} />\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport { Button } from '@material-ui/core';\r\n\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\nimport { useAppState } from '../../../state';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => createStyles({\r\n  button: {\r\n    background: theme.brand,\r\n    color: 'white',\r\n    '&:hover': {\r\n      background: '#600101',\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function EndCallButton(props: { className?: string }) {\r\n  const classes = useStyles();\r\n  const { room } = useVideoContext();\r\n\r\n  // const {handleDisconnect} = useAppState();\r\n\r\n  return (\r\n    <Button\r\n      onClick={async () => {\r\n        await room.disconnect();\r\n      }}\r\n      className={clsx(classes.button, props.className)}\r\n      data-cy-disconnect\r\n    >\r\n      Disconnect\r\n    </Button>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function FlipCameraIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"25\" height=\"24\" viewBox=\"0 0 25 24\">\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <g fill=\"#707578\">\r\n          <path\r\n            d=\"M12 3.5c4.694 0 8.5 3.806 8.5 8.5s-3.806 8.5-8.5 8.5-8.5-3.806-8.5-8.5S7.306 3.5 12 3.5zm0 1c-4.142 0-7.5 3.358-7.5 7.5 0 4.142 3.358 7.5 7.5 7.5 4.142 0 7.5-3.358 7.5-7.5 0-4.142-3.358-7.5-7.5-7.5zm1.367 3.429C14.959 8.492 16.1 10.215 16.1 12c0 1.16-.481 2.294-1.256 3.1h.356c.245 0 .45.177.492.41l.008.09c0 .245-.177.45-.41.492l-.09.008h-2.008l-.048-.003-.034-.005c-.088-.017-.167-.055-.233-.11l-.06-.06c-.037-.044-.067-.096-.087-.151l-.001-.004-.012-.04c-.004-.012-.007-.024-.009-.037v-.005c-.005-.024-.006-.042-.007-.06L12.7 13.6c0-.276.224-.5.5-.5.245 0 .45.177.492.41l.008.09v1.176c.833-.6 1.4-1.676 1.4-2.776 0-1.373-.886-2.71-2.067-3.129-.26-.092-.396-.377-.304-.638.092-.26.378-.396.638-.304zm-2.559-.03c.03.001.058.004.086.01l.062.016.018.006c.04.015.075.034.108.056.086.059.152.143.188.242l.001.004.008.025c.006.017.01.034.013.052l.008.09v2c0 .276-.224.5-.5.5-.245 0-.45-.177-.492-.41l-.008-.09V9.224c-.833.6-1.4 1.676-1.4 2.776 0 1.373.886 2.71 2.067 3.129.26.092.396.377.304.638-.092.26-.378.396-.638.304C9.041 15.508 7.9 13.785 7.9 12c0-1.16.481-2.294 1.255-3.1H8.8c-.245 0-.45-.177-.492-.41L8.3 8.4c0-.245.177-.45.41-.492L8.8 7.9h2.008z\"\r\n            transform=\"translate(-233 -689) translate(-1 673) translate(37 16) translate(197.298)\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { Button } from '@material-ui/core';\r\nimport { DEFAULT_VIDEO_CONSTRAINTS } from '../../../constants';\r\nimport FlipCameraIcon from './FlipCameraIcon';\r\nimport useMediaStreamTrack from '../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\nimport { useVideoInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\n\r\nexport default function FlipCameraButton() {\r\n  const { localVideoTrack: videoTrack } = useVideoContext();\r\n  const [supportsFacingMode, setSupportsFacingMode] = useState<boolean | null>(null);\r\n  const mediaStreamTrack = useMediaStreamTrack(videoTrack);\r\n  const videoDeviceList = useVideoInputDevices();\r\n\r\n  useEffect(() => {\r\n    // The 'supportsFacingMode' variable determines if this component is rendered\r\n    // If 'facingMode' exists, we will set supportsFacingMode to true.\r\n    // However, if facingMode is ever undefined again (when the user unpublishes video), we\r\n    // won't set 'supportsFacingMode' to false. This prevents the icon from briefly\r\n    // disappearing when the user switches their front/rear camera.\r\n    const currentFacingMode = mediaStreamTrack?.getSettings().facingMode;\r\n    if (currentFacingMode && supportsFacingMode === null) {\r\n      setSupportsFacingMode(true);\r\n    }\r\n  }, [mediaStreamTrack, supportsFacingMode]);\r\n\r\n  const toggleFacingMode = useCallback(() => {\r\n    if (videoTrack) {\r\n      const newFacingMode = mediaStreamTrack?.getSettings().facingMode === 'user' ? 'environment' : 'user';\r\n      videoTrack.restart({\r\n        ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n        facingMode: newFacingMode,\r\n      });\r\n    }\r\n  }, [mediaStreamTrack, videoTrack]);\r\n\r\n  return supportsFacingMode && videoDeviceList.length > 1 ? (\r\n    <Button onClick={toggleFacingMode} disabled={!videoTrack} startIcon={<FlipCameraIcon />}>\r\n      Flip Camera\r\n    </Button>\r\n  ) : null;\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport {\r\n  FormControl, MenuItem, Typography, Select, Grid,\r\n} from '@material-ui/core';\r\nimport AudioLevelIndicator from '../../AudioLevelIndicator/AudioLevelIndicator';\r\nimport { useAudioInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\nimport useMediaStreamTrack from '../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\nimport LocalStorage_TwilioVideo from '../../../../../../classes/LocalStorage/TwilioVideo';\r\n\r\nexport default function AudioInputList() {\r\n  const audioInputDevices = useAudioInputDevices();\r\n  const { localAudioTrack } = useVideoContext();\r\n\r\n  const mediaStreamTrack = useMediaStreamTrack(localAudioTrack);\r\n  const localAudioInputDeviceId = mediaStreamTrack?.getSettings().deviceId;\r\n  const [lastAudioDeviceId, _setLastAudioDeviceId] = useState<string | null>(\r\n    LocalStorage_TwilioVideo.twilioVideoLastMic,\r\n  );\r\n\r\n  const setLastAudioDeviceId = useCallback((deviceId: string | null) => {\r\n    LocalStorage_TwilioVideo.twilioVideoLastMic = deviceId;\r\n    _setLastAudioDeviceId(deviceId);\r\n  }, []);\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    setLastAudioDeviceId(newDeviceId);\r\n    localAudioTrack?.restart({ deviceId: { exact: newDeviceId } });\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Typography variant=\"subtitle2\" gutterBottom>\r\n        Audio Input\r\n      </Typography>\r\n      <Grid container alignItems=\"center\" justify=\"space-between\">\r\n        <div className=\"inputSelect\">\r\n          {audioInputDevices.length > 1 ? (\r\n            <FormControl fullWidth>\r\n              <Select\r\n                onChange={(e) => replaceTrack(e.target.value as string)}\r\n                value={localAudioInputDeviceId || lastAudioDeviceId}\r\n                variant=\"outlined\"\r\n              >\r\n                {audioInputDevices.map((device) => (\r\n                  <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                    {device.label}\r\n                  </MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n          ) : (\r\n            <Typography>{localAudioTrack?.mediaStreamTrack.label || 'No Local Audio'}</Typography>\r\n          )}\r\n        </div>\r\n        <AudioLevelIndicator audioTrack={localAudioTrack} color=\"black\" />\r\n      </Grid>\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {\r\n  FormControl, MenuItem, Typography, Select,\r\n} from '@material-ui/core';\r\nimport { useAppState } from '../../../state';\r\nimport { useAudioOutputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\n\r\nexport default function AudioOutputList() {\r\n  const audioOutputDevices = useAudioOutputDevices();\r\n  const { activeSinkId, setActiveSinkId } = useAppState();\r\n  const activeOutputLabel = audioOutputDevices.find((device) => device.deviceId === activeSinkId)?.label;\r\n\r\n  return (\r\n    <div className=\"inputSelect\">\r\n      {audioOutputDevices.length > 1 ? (\r\n        <FormControl fullWidth>\r\n          <Typography variant=\"subtitle2\" gutterBottom>\r\n            Audio Output\r\n          </Typography>\r\n          <Select onChange={(e) => setActiveSinkId(e.target.value as string)} value={activeSinkId} variant=\"outlined\">\r\n            {audioOutputDevices.map((device) => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"subtitle2\">Audio Output</Typography>\r\n          <Typography>{activeOutputLabel || 'System Default Audio Output'}</Typography>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\nimport {\r\n  FormControl, MenuItem, Typography, Select,\r\n} from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { DEFAULT_VIDEO_CONSTRAINTS } from '../../../constants';\r\nimport VideoTrack from '../../VideoTrack/VideoTrack';\r\nimport useMediaStreamTrack from '../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\nimport { useVideoInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\nimport LocalStorage_TwilioVideo from '../../../../../../classes/LocalStorage/TwilioVideo';\r\n\r\nconst useStyles = makeStyles({\r\n  preview: {\r\n    width: '300px',\r\n    maxHeight: '200px',\r\n    margin: '0.5em auto',\r\n    '& video': {\r\n      maxHeight: '200px',\r\n    },\r\n  },\r\n});\r\n\r\nexport default function VideoInputList() {\r\n  const classes = useStyles();\r\n  const videoInputDevices = useVideoInputDevices();\r\n  const { localVideoTrack } = useVideoContext();\r\n  const mediaStreamTrack = useMediaStreamTrack(localVideoTrack);\r\n  const localVideoInputDeviceId = mediaStreamTrack?.getSettings().deviceId;\r\n  const [lastVideoDeviceId, _setLastVideoDeviceId] = useState<string | null>(\r\n    LocalStorage_TwilioVideo.twilioVideoLastCamera,\r\n  );\r\n\r\n  const setLastVideoDeviceId = useCallback((deviceId: string | null) => {\r\n    LocalStorage_TwilioVideo.twilioVideoLastCamera = deviceId;\r\n    _setLastVideoDeviceId(deviceId);\r\n  }, []);\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    setLastVideoDeviceId(newDeviceId);\r\n    if (localVideoTrack) {\r\n      localVideoTrack.restart({\r\n        ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n        deviceId: { exact: newDeviceId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {localVideoTrack && (\r\n        <div className={classes.preview}>\r\n          <VideoTrack isLocal track={localVideoTrack} />\r\n        </div>\r\n      )}\r\n      {videoInputDevices.length > 1 ? (\r\n        <FormControl fullWidth>\r\n          <Typography variant=\"subtitle2\" gutterBottom>\r\n            Video Input\r\n          </Typography>\r\n          <Select\r\n            onChange={(e) => replaceTrack(e.target.value as string)}\r\n            value={localVideoInputDeviceId || lastVideoDeviceId}\r\n            variant=\"outlined\"\r\n          >\r\n            {videoInputDevices.map((device) => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"subtitle2\" gutterBottom>\r\n            Video Input\r\n          </Typography>\r\n          <Typography>{localVideoTrack?.mediaStreamTrack.label || 'No Local Video'}</Typography>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nimport {\r\n  DialogContent,\r\n  Typography,\r\n  Divider,\r\n  Dialog,\r\n  DialogActions,\r\n  Button,\r\n  Theme,\r\n  DialogTitle,\r\n} from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport AudioInputList from './AudioInputList/AudioInputList';\r\nimport AudioOutputList from './AudioOutputList/AudioOutputList';\r\nimport VideoInputList from './VideoInputList/VideoInputList';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    width: '600px',\r\n    minHeight: '400px',\r\n    [theme.breakpoints.down('xs')]: {\r\n      width: 'calc(100vw - 32px)',\r\n    },\r\n    '& .inputSelect': {\r\n      width: 'calc(100% - 35px)',\r\n    },\r\n  },\r\n  button: {\r\n    float: 'right',\r\n  },\r\n  paper: {\r\n    [theme.breakpoints.down('xs')]: {\r\n      margin: '16px',\r\n    },\r\n  },\r\n  headline: {\r\n    marginBottom: '1.3em',\r\n    fontSize: '1.1rem',\r\n  },\r\n  listSection: {\r\n    margin: '2em 0 0.8em',\r\n    '&:first-child': {\r\n      margin: '1em 0 2em 0',\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function DeviceSelectionDialog({ open, onClose }: { open: boolean; onClose: () => void }) {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} classes={{ paper: classes.paper }}>\r\n      <DialogTitle>Audio and Video Settings</DialogTitle>\r\n      <Divider />\r\n      <DialogContent className={classes.container}>\r\n        <div className={classes.listSection}>\r\n          <Typography variant=\"h6\" className={classes.headline}>\r\n            Video\r\n          </Typography>\r\n          <VideoInputList />\r\n        </div>\r\n        <Divider />\r\n        <div className={classes.listSection}>\r\n          <Typography variant=\"h6\" className={classes.headline}>\r\n            Audio\r\n          </Typography>\r\n          <AudioInputList />\r\n        </div>\r\n        <div className={classes.listSection}>\r\n          <AudioOutputList />\r\n        </div>\r\n      </DialogContent>\r\n      <Divider />\r\n      <DialogActions>\r\n        <Button color=\"primary\" variant=\"contained\" className={classes.button} onClick={onClose}>\r\n          Done\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React, { useState, useRef } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport MenuContainer from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport MoreIcon from '@material-ui/icons/MoreVert';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { Theme, useMediaQuery } from '@material-ui/core';\r\nimport DeviceSelectionDialog from '../../DeviceSelectionDialog/DeviceSelectionDialog';\r\nimport TownSettings from '../../../../../Login/TownSettings';\r\n\r\nexport default function Menu(props: { buttonClassName?: string }) {\r\n  const isMobile = useMediaQuery((theme: Theme) => theme.breakpoints.down('sm'));\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  const anchorRef = useRef<HTMLButtonElement>(null);\r\n\r\n  return (\r\n    <>\r\n        <MenuItem onClick={() => setSettingsOpen(true)}>\r\n          <Typography variant=\"body1\">A/V Settings</Typography>\r\n        </MenuItem>\r\n      <DeviceSelectionDialog\r\n        open={settingsOpen}\r\n        onClose={() => {\r\n          setSettingsOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\ntype RoomStateType = 'disconnected' | 'connected' | 'reconnecting';\r\n\r\nexport default function useRoomState() {\r\n  const { room } = useVideoContext();\r\n  const [state, setState] = useState<RoomStateType>('disconnected');\r\n\r\n  useEffect(() => {\r\n    const setRoomState = () => setState((room.state || 'disconnected') as RoomStateType);\r\n    setRoomState();\r\n    room\r\n      .on('disconnected', setRoomState)\r\n      .on('reconnected', setRoomState)\r\n      .on('reconnecting', setRoomState);\r\n    return () => {\r\n      room\r\n        .off('disconnected', setRoomState)\r\n        .off('reconnected', setRoomState)\r\n        .off('reconnecting', setRoomState);\r\n    };\r\n  }, [room]);\r\n\r\n  return state;\r\n}\r\n","import React from 'react';\r\n\r\nexport default function MicIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"17\" viewBox=\"0 0 12 17\">\r\n      <path\r\n        fill=\"#707578\"\r\n        fillRule=\"evenodd\"\r\n        d=\"M11.389 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09C2.395 12.836 0 10.281 0 7.167c0-.276.224-.5.5-.5s.5.224.5.5c0 2.73 2.214 4.944 4.944 4.944 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM5.944 0C7.51 0 8.778 1.268 8.778 2.833v4.334C8.778 8.73 7.51 10 5.944 10 4.38 10 3.111 8.73 3.111 7.167V2.833C3.111 1.268 4.38 0 5.944 0zm0 1c-1.012 0-1.833.82-1.833 1.833v4.334C4.111 8.179 4.933 9 5.944 9c1.013 0 1.834-.82 1.834-1.833V2.833C7.778 1.82 6.958 1 5.944 1z\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function MicOffIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"25\" height=\"24\" viewBox=\"0 0 25 24\">\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <path\r\n          fill=\"#707578\"\r\n          d=\"M11.889 6.667c.276 0 .5.224.5.5 0 3.114-2.396 5.67-5.445 5.923v2.632c0 .276-.223.5-.5.5-.245 0-.45-.177-.491-.41l-.009-.09V13.09c-1.116-.093-2.145-.494-3-1.119l.717-.717c.793.54 1.751.857 2.783.857 2.731 0 4.945-2.214 4.945-4.944 0-.276.224-.5.5-.5zM1 6.667c.276 0 .5.224.5.5 0 .975.282 1.884.77 2.65l-.722.721C.888 9.58.5 8.418.5 7.167c0-.276.224-.5.5-.5zm8.277-1.031v1.53C9.278 8.732 8.01 10 6.445 10c-.446 0-.868-.103-1.243-.287l.776-.773c.149.039.306.06.467.06.963 0 1.751-.74 1.828-1.683l.006-.15v-.531l1-1zM6.444 0C8.01 0 9.278 1.268 9.278 2.833l-.002-.025-.999.999v-.974c0-.962-.74-1.75-1.682-1.827L6.445 1c-.962 0-1.751.74-1.828 1.683l-.006.15v4.334c0 .097.008.192.022.285l-.804.805c-.112-.269-.184-.558-.209-.86l-.009-.23V2.833C3.611 1.268 4.88 0 6.444 0z\"\r\n          transform=\"translate(6.5 4)\"\r\n        />\r\n        <path\r\n          fill=\"red\"\r\n          d=\"M12.146.646c.196-.195.512-.195.708 0 .173.174.192.443.057.638l-.057.07-12 12c-.196.195-.512.195-.708 0-.173-.174-.192-.443-.057-.638l.057-.07 12-12z\"\r\n          transform=\"translate(6.5 4)\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport LocalStorage_TwilioVideo from '../../../../../classes/LocalStorage/TwilioVideo';\r\nimport useIsTrackEnabled from '../useIsTrackEnabled/useIsTrackEnabled';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useLocalAudioToggle() {\r\n  const {\r\n    // @ts-ignore\r\n    localAudioTrack: audioTrack,\r\n    room: { localParticipant },\r\n    getLocalAudioTrack,\r\n    // @ts-ignore\r\n    removeLocalAudioTrack,\r\n  } = useVideoContext();\r\n  const isEnabled = useIsTrackEnabled(audioTrack);\r\n  const [isPublishing, setIsPublishing] = useState(false);\r\n\r\n  const stopAudio = useCallback(() => {\r\n    if (audioTrack) {\r\n      LocalStorage_TwilioVideo.twilioVideoLastMic = audioTrack.mediaStreamTrack.getSettings().deviceId ?? null;\r\n      const localTrackPublication = localParticipant?.unpublishTrack(audioTrack);\r\n      // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n      localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n      removeLocalAudioTrack();\r\n    }\r\n  }, [audioTrack, localParticipant, removeLocalAudioTrack]);\r\n\r\n  const toggleAudioEnabled = useCallback(async () => {\r\n    if (!isPublishing) {\r\n      if (audioTrack) {\r\n        stopAudio();\r\n        LocalStorage_TwilioVideo.twilioVideoMicEnabled = false;\r\n      } else {\r\n        setIsPublishing(true);\r\n        try {\r\n          LocalStorage_TwilioVideo.twilioVideoMicEnabled = true;\r\n          const track = await getLocalAudioTrack(LocalStorage_TwilioVideo.twilioVideoLastMic ?? undefined);\r\n          localParticipant?.publishTrack(track, { priority: 'low' });\r\n        } catch (e) {\r\n          if (e?.name === 'NotReadableError' || e?.name === 'OverconstrainedError') {\r\n            LocalStorage_TwilioVideo.twilioVideoLastMic = null;\r\n          }\r\n          throw e;\r\n        } finally {\r\n          setIsPublishing(false);\r\n        }\r\n      }\r\n    }\r\n  }, [audioTrack, getLocalAudioTrack, isPublishing, localParticipant, stopAudio]);\r\n\r\n  return { isEnabled, toggleAudioEnabled, stopAudio } as const;\r\n}\r\n","import React, { useCallback, useRef } from 'react';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport MicIcon from '../../../icons/MicIcon';\r\nimport MicOffIcon from '../../../icons/MicOffIcon';\r\n\r\nimport useLocalAudioToggle from '../../../hooks/useLocalAudioToggle/useLocalAudioToggle';\r\nimport { useHasAudioInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\n\r\nexport default function ToggleAudioButton(props: {\r\n  disabled?: boolean;\r\n  className?: string;\r\n  setMediaError?(error: Error): void;\r\n}) {\r\n  const { isEnabled: isAudioEnabled, toggleAudioEnabled } = useLocalAudioToggle();\r\n  const lastClickTimeRef = useRef(0);\r\n  const hasAudioDevices = useHasAudioInputDevices();\r\n\r\n  const toggleAudio = useCallback(async () => {\r\n    if (Date.now() - lastClickTimeRef.current > 200) {\r\n      lastClickTimeRef.current = Date.now();\r\n      try {\r\n        await toggleAudioEnabled();\r\n      } catch (e) {\r\n        if (props.setMediaError) {\r\n          props.setMediaError(e);\r\n        }\r\n      }\r\n    }\r\n  }, [props, toggleAudioEnabled]);\r\n\r\n  return (\r\n    <Button\r\n      className={props.className}\r\n      onClick={toggleAudio}\r\n      disabled={props.disabled || !hasAudioDevices}\r\n      startIcon={isAudioEnabled ? <MicIcon /> : <MicOffIcon />}\r\n      data-cy-audio-toggle\r\n    >\r\n      {!hasAudioDevices ? 'No audio devices' : isAudioEnabled ? 'Mute' : 'Unmute'}\r\n    </Button>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function VideoOffIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <path\r\n          fill=\"#707578\"\r\n          d=\"M10.503.85c.32 0 .611.125.827.329l-.696.697c-.025-.018-.053-.032-.084-.038l-.047-.006H1.207c-.102 0-.19.071-.216.165l-.008.059v7.866c0 .101.07.189.165.215l.059.008h1.156l-.983.983h-.173c-.624 0-1.139-.476-1.2-1.083L0 9.922V2.056C0 1.433.476.917 1.084.856l.123-.007h9.296zm5.49 1.124l.007.082v7.866c0 .337-.328.566-.635.47l-.076-.03-3.58-1.79v1.35c0 .623-.476 1.138-1.083 1.2l-.123.006H4.16l.984-.983h5.359c.101 0 .189-.07.215-.164l.008-.06V4.564l.983-.982.353-.353 3.227-1.612c.301-.15.652.04.704.358zm-.977.876L11.71 4.504v2.967l3.307 1.654V2.85z\"\r\n          transform=\"translate(4 6)\"\r\n        />\r\n        <path\r\n          fill=\"red\"\r\n          fillRule=\"nonzero\"\r\n          d=\"M13.06.144c.192-.192.503-.192.695 0 .171.17.19.436.057.627l-.057.068-12.29 12.29c-.192.193-.503.193-.695 0-.171-.17-.19-.435-.057-.626l.057-.069L13.06.144z\"\r\n          transform=\"translate(4 6)\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function VideoOnIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"25\" height=\"24\" viewBox=\"0 0 25 24\">\r\n      <path\r\n        fill=\"#707578\"\r\n        fillRule=\"evenodd\"\r\n        d=\"M15.003 7c.665 0 1.206.542 1.206 1.207v1.349l3.58-1.789c.301-.15.652.04.704.358l.007.082v7.866c0 .365-.385.603-.711.44l-3.58-1.79v1.35c0 .623-.476 1.138-1.083 1.2l-.123.006H5.707c-.665 0-1.207-.542-1.207-1.206V8.207C4.5 7.542 5.042 7 5.707 7zm0 .983H5.707c-.122 0-.224.102-.224.224v7.866c0 .121.102.223.224.223h9.296c.122 0 .223-.102.223-.223V8.207c0-.122-.101-.224-.223-.224zm4.513 1.019l-3.307 1.654v2.968l3.307 1.653V9.002z\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n","import React, { useCallback, useRef } from 'react';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport VideoOffIcon from '../../../icons/VideoOffIcon';\r\nimport VideoOnIcon from '../../../icons/VideoOnIcon';\r\n\r\nimport { useHasVideoInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\n\r\nexport default function ToggleVideoButton(props: {\r\n  disabled?: boolean;\r\n  className?: string;\r\n  setMediaError?(error: Error): void;\r\n}) {\r\n  // @ts-ignore\r\n  const { isEnabled: isVideoEnabled, toggleVideoEnabled } = useLocalVideoToggle();\r\n  const lastClickTimeRef = useRef(0);\r\n  const hasVideoDevices = useHasVideoInputDevices();\r\n\r\n  const toggleVideo = useCallback(async () => {\r\n    if (Date.now() - lastClickTimeRef.current > 200) {\r\n      lastClickTimeRef.current = Date.now();\r\n      try {\r\n        await toggleVideoEnabled();\r\n      } catch (e) {\r\n        if (props.setMediaError) {\r\n          props.setMediaError(e);\r\n        }\r\n      }\r\n    }\r\n  }, [props, toggleVideoEnabled]);\r\n\r\n  return (\r\n    <Button\r\n      className={props.className}\r\n      onClick={toggleVideo}\r\n      disabled={!hasVideoDevices || props.disabled}\r\n      startIcon={isVideoEnabled ? <VideoOnIcon /> : <VideoOffIcon />}\r\n    >\r\n      {!hasVideoDevices ? 'No video devices' : isVideoEnabled ? 'Stop Video' : 'Start Video'}\r\n    </Button>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport ScreenShareIcon from '../../../icons/ScreenShareIcon';\r\n\r\nimport useScreenShareParticipant from '../../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport const SCREEN_SHARE_TEXT = 'Share Screen';\r\nexport const STOP_SCREEN_SHARE_TEXT = 'Stop Sharing Screen';\r\nexport const SHARE_IN_PROGRESS_TEXT = 'Cannot share screen when another user is sharing';\r\nexport const SHARE_NOT_SUPPORTED_TEXT = 'Screen sharing is not supported with this browser';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => createStyles({\r\n  button: {\r\n    margin: theme.spacing(1),\r\n    '&[disabled]': {\r\n      color: '#bbb',\r\n      '& svg *': {\r\n        fill: '#bbb',\r\n      },\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function ToggleScreenShareButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const { toggleScreenShare } = useVideoContext();\r\n  const disableScreenShareButton = Boolean(screenShareParticipant);\r\n  const isScreenShareSupported = navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia;\r\n  const isDisabled = props.disabled || disableScreenShareButton || !isScreenShareSupported;\r\n\r\n  let tooltipMessage = '';\r\n\r\n  if (disableScreenShareButton) {\r\n    tooltipMessage = SHARE_IN_PROGRESS_TEXT;\r\n  }\r\n\r\n  if (!isScreenShareSupported) {\r\n    tooltipMessage = SHARE_NOT_SUPPORTED_TEXT;\r\n  }\r\n\r\n  return (\r\n    <Tooltip\r\n      title={tooltipMessage}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n      style={{ cursor: isDisabled ? 'not-allowed' : 'pointer' }}\r\n    >\r\n      <span>\r\n        {/* The span element is needed because a disabled button will not emit hover events and we want to display\r\n          a tooltip when screen sharing is disabled */}\r\n        <Button\r\n          className={classes.button}\r\n          onClick={toggleScreenShare}\r\n          disabled={isDisabled}\r\n          startIcon={<ScreenShareIcon />}\r\n          data-cy-share-screen\r\n        >\r\n          {SCREEN_SHARE_TEXT}\r\n        </Button>\r\n      </span>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport Video from '../classes/Video/Video';\r\n\r\n/**\r\n * Hint: You will never need to use this directly. Instead, use the\r\n * `useVideo` hook.\r\n */\r\nconst Context = React.createContext<Video | null>(null);\r\n\r\nexport default Context;\r\n","import { useContext } from 'react';\r\nimport VideoContext from '../contexts/VideoContext';\r\nimport Video from '../classes/Video/Video';\r\n\r\n/**\r\n * Use this hook to access the video instance.\r\n */\r\nexport default function useMaybeVideo(): Video | null {\r\n  return useContext(VideoContext);\r\n}\r\n","import React, { useCallback, useState } from 'react';\r\n\r\nimport {\r\n  Button,\r\n  Checkbox,\r\n  FormControl,\r\n  FormLabel,\r\n  Input,\r\n  Modal,\r\n  ModalBody,\r\n  ModalCloseButton,\r\n  ModalContent,\r\n  ModalFooter,\r\n  ModalHeader,\r\n  ModalOverlay,\r\n  useDisclosure,\r\n  useToast\r\n} from '@chakra-ui/react';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport useCoveyAppState from '../../hooks/useCoveyAppState';\r\nimport useMaybeVideo from '../../hooks/useMaybeVideo';\r\n\r\nconst TownSettings: React.FunctionComponent = () => {\r\n  const {isOpen, onOpen, onClose} = useDisclosure()\r\n  const video = useMaybeVideo()\r\n  const {apiClient, currentTownID, currentTownFriendlyName, currentTownIsPubliclyListed} = useCoveyAppState();\r\n  const [friendlyName, setFriendlyName] = useState<string>(currentTownFriendlyName);\r\n  const [isPubliclyListed, setIsPubliclyListed] = useState<boolean>(currentTownIsPubliclyListed);\r\n  const [roomUpdatePassword, setRoomUpdatePassword] = useState<string>('');\r\n\r\n  const openSettings = useCallback(()=>{\r\n    onOpen();\r\n    video?.pauseGame();\r\n  }, [onOpen, video]);\r\n\r\n  const closeSettings = useCallback(()=>{\r\n    onClose();\r\n    video?.unPauseGame();\r\n  }, [onClose, video]);\r\n\r\n  const toast = useToast()\r\n  const processUpdates = async (action: string) =>{\r\n    if(action === 'delete'){\r\n      try{\r\n        await apiClient.deleteTown({coveyTownID: currentTownID,\r\n          coveyTownPassword: roomUpdatePassword});\r\n        toast({\r\n          title: 'Town deleted',\r\n          status: 'success'\r\n        })\r\n        closeSettings();\r\n      }catch(err){\r\n        toast({\r\n          title: 'Unable to delete town',\r\n          description: err.toString(),\r\n          status: 'error'\r\n        });\r\n      }\r\n    }else {\r\n      try {\r\n        await apiClient.updateTown({\r\n          coveyTownID: currentTownID,\r\n          coveyTownPassword: roomUpdatePassword,\r\n          friendlyName,\r\n          isPubliclyListed\r\n        });\r\n        toast({\r\n          title: 'Town updated',\r\n          description: 'To see the updated town, please exit and re-join this town',\r\n          status: 'success'\r\n        })\r\n        closeSettings();\r\n      }catch(err){\r\n        toast({\r\n          title: 'Unable to update town',\r\n          description: err.toString(),\r\n          status: 'error'\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  return <>\r\n    <MenuItem data-testid='openMenuButton' onClick={openSettings}>\r\n      <Typography variant=\"body1\">Town Settings</Typography>\r\n    </MenuItem>\r\n    <Modal isOpen={isOpen} onClose={closeSettings}>\r\n      <ModalOverlay/>\r\n      <ModalContent>\r\n        <ModalHeader>Edit town {currentTownFriendlyName} ({currentTownID})</ModalHeader>\r\n        <ModalCloseButton/>\r\n        <form onSubmit={(ev)=>{ev.preventDefault(); processUpdates('edit')}}>\r\n          <ModalBody pb={6}>\r\n            <FormControl>\r\n              <FormLabel htmlFor='friendlyName'>Friendly Name</FormLabel>\r\n              <Input id='friendlyName' placeholder=\"Friendly Name\" name=\"friendlyName\" value={friendlyName} onChange={(ev)=>setFriendlyName(ev.target.value)} />\r\n            </FormControl>\r\n\r\n            <FormControl mt={4}>\r\n              <FormLabel htmlFor='isPubliclyListed'>Publicly Listed</FormLabel>\r\n              <Checkbox id=\"isPubliclyListed\" name=\"isPubliclyListed\"  isChecked={isPubliclyListed} onChange={(e)=>setIsPubliclyListed(e.target.checked)} />\r\n            </FormControl>\r\n            <FormControl isRequired>\r\n              <FormLabel htmlFor=\"updatePassword\">Town Update Password</FormLabel>\r\n              <Input data-testid=\"updatePassword\" id=\"updatePassword\" placeholder=\"Password\" name=\"password\" type=\"password\" value={roomUpdatePassword} onChange={(e)=>setRoomUpdatePassword(e.target.value)} />\r\n            </FormControl>\r\n          </ModalBody>\r\n\r\n          <ModalFooter>\r\n            <Button data-testid='deletebutton' colorScheme=\"red\" mr={3} value=\"delete\" name='action1' onClick={()=>processUpdates('delete')}>\r\n              Delete\r\n            </Button>\r\n            <Button data-testid='updatebutton' colorScheme=\"blue\" mr={3} value=\"update\" name='action2' onClick={()=>processUpdates('edit')}>\r\n              Update\r\n            </Button>\r\n            <Button onClick={closeSettings}>Cancel</Button>\r\n          </ModalFooter>\r\n        </form>\r\n      </ModalContent>\r\n    </Modal>\r\n  </>\r\n}\r\n\r\n\r\nexport default TownSettings;\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport { Typography, Grid, Hidden } from '@material-ui/core';\r\nimport EndCallButton from '../Buttons/EndCallButton/EndCallButton';\r\nimport FlipCameraButton from './FlipCameraButton/FlipCameraButton';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport ToggleAudioButton from '../Buttons/ToggleAudioButton/ToggleAudioButton';\r\nimport ToggleVideoButton from '../Buttons/ToggleVideoButton/ToggleVideoButton';\r\nimport ToggleScreenShareButton from '../Buttons/ToogleScreenShareButton/ToggleScreenShareButton';\r\nimport TownSettings from '../../../../Login/TownSettings';\r\nimport MenuContainer from '@material-ui/core/Menu';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => createStyles({\r\n  container: {\r\n    backgroundColor: theme.palette.background.default,\r\n    bottom: 20,\r\n    left: 0,\r\n    right: 0,\r\n    // height: `${theme.footerHeight}px`,\r\n    position: 'absolute',\r\n    display: 'flex',\r\n    padding: '0 1.43em',\r\n    zIndex: 10,\r\n    [theme.breakpoints.down('sm')]: {\r\n      height: `${theme.mobileFooterHeight}px`,\r\n      padding: 0,\r\n    },\r\n  },\r\n  screenShareBanner: {\r\n    position: 'absolute',\r\n    zIndex: 10,\r\n    bottom: `${theme.footerHeight}px`,\r\n    left: 0,\r\n    right: 0,\r\n    height: '104px',\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n    '& h6': {\r\n      color: 'white',\r\n    },\r\n    '& button': {\r\n      background: 'white',\r\n      color: theme.brand,\r\n      border: `2px solid ${theme.brand}`,\r\n      margin: '0 2em',\r\n      '&:hover': {\r\n        color: '#600101',\r\n        border: '2px solid #600101',\r\n        background: '#FFE9E7',\r\n      },\r\n    },\r\n  },\r\n  hideMobile: {\r\n    display: 'initial',\r\n    [theme.breakpoints.down('sm')]: {\r\n      display: 'none',\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function MenuBar(props: { setMediaError?(error: Error): void }) {\r\n  const classes = useStyles();\r\n  const { isSharingScreen, toggleScreenShare } = useVideoContext();\r\n  const roomState = useRoomState();\r\n  const isReconnecting = roomState === 'reconnecting';\r\n\r\n  return (\r\n    <>\r\n      {isSharingScreen && (\r\n        <Grid container justify=\"center\" alignItems=\"center\" className={classes.screenShareBanner}>\r\n          <Typography variant=\"h6\">You are sharing your screen</Typography>\r\n          <Button onClick={() => toggleScreenShare()}>Stop Sharing</Button>\r\n        </Grid>\r\n      )}\r\n      <footer className={classes.container}>\r\n        <Grid container justify=\"space-around\" alignItems=\"center\">\r\n          <Grid item>\r\n            <Grid container justify=\"center\">\r\n              <ToggleAudioButton disabled={isReconnecting} setMediaError={props.setMediaError} />\r\n              <ToggleVideoButton disabled={isReconnecting} setMediaError={props.setMediaError} />\r\n              <Hidden smDown>\r\n                {!isSharingScreen && <ToggleScreenShareButton disabled={isReconnecting} />}\r\n              </Hidden>\r\n              <FlipCameraButton />\r\n            </Grid>\r\n          </Grid>\r\n          <Hidden smDown>\r\n            <Grid style={{ flex: 1 }}>\r\n              <Grid container justify=\"flex-end\">\r\n                <TownSettings />\r\n\r\n                <Menu />\r\n                <EndCallButton />\r\n              </Grid>\r\n            </Grid>\r\n          </Hidden>\r\n        </Grid>\r\n      </footer>\r\n    </>\r\n  );\r\n}\r\n","import {\r\n  Grid, makeStyles, Theme, Typography,\r\n} from '@material-ui/core';\r\nimport React from 'react';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport EndCallButton from '../Buttons/EndCallButton/EndCallButton';\r\nimport Menu from '../MenuBar/Menu/Menu';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    background: 'white',\r\n    paddingLeft: '1em',\r\n    display: 'none',\r\n    height: `${theme.mobileTopBarHeight}px`,\r\n    [theme.breakpoints.down('sm')]: {\r\n      display: 'flex',\r\n    },\r\n  },\r\n  endCallButton: {\r\n    height: '28px',\r\n    fontSize: '0.85rem',\r\n    padding: '0 0.6em',\r\n  },\r\n  settingsButton: {\r\n    [theme.breakpoints.down('sm')]: {\r\n      height: '28px',\r\n      minWidth: '28px',\r\n      border: '1px solid rgb(136, 140, 142)',\r\n      padding: 0,\r\n      margin: '0 1em',\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function MobileTopMenuBar() {\r\n  const classes = useStyles();\r\n  const { room } = useVideoContext();\r\n\r\n  return (\r\n    <Grid container alignItems=\"center\" justify=\"space-between\" className={classes.container}>\r\n      <Typography variant=\"subtitle1\">{room.name}</Typography>\r\n      <div>\r\n        <EndCallButton className={classes.endCallButton} />\r\n        <Menu buttonClassName={classes.settingsButton} />\r\n      </div>\r\n    </Grid>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function ErrorIcon() {\r\n  return (\r\n    <svg width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g stroke=\"none\" strokeWidth=\"1\" fill=\"none\" fillRule=\"evenodd\">\r\n        <g transform=\"translate(-299.000000, -723.000000)\" fill=\"#D61F1F\">\r\n          <g transform=\"translate(276.000000, 704.000000)\">\r\n            <g transform=\"translate(23.000000, 19.000000)\">\r\n              <path\r\n                d=\"M8.03935839,0.763849674 L13.2361503,5.96064161 C13.8101721,6.5346634 13.8101721,7.4653366 13.2361503,8.03935839 L8.03935839,13.2361503 C7.4653366,13.8101721 6.5346634,13.8101721 5.96064161,13.2361503 L0.763849674,8.03935839 C0.189827887,7.4653366 0.189827887,6.5346634 0.763849674,5.96064161 L5.96064161,0.763849674 C6.5346634,0.189827887 7.4653366,0.189827887 8.03935839,0.763849674 Z M7,8.66666667 C6.53976271,8.66666667 6.16666667,9.03976271 6.16666667,9.5 C6.16666667,9.96023729 6.53976271,10.3333333 7,10.3333333 C7.46023729,10.3333333 7.83333333,9.96023729 7.83333333,9.5 C7.83333333,9.03976271 7.46023729,8.66666667 7,8.66666667 Z M7.00842529,4.5 L6.99145559,4.5 C6.48802096,4.5 6.09771771,4.99363437 6.17690967,5.53663218 L6.53327351,7.40140326 C6.56721292,7.64822044 6.76519283,7.83333333 6.99711216,7.83333333 L7.00276873,7.83333333 C7.23468805,7.83333333 7.43266796,7.64822044 7.46660737,7.40140326 L7.82297121,5.53663218 C7.90216317,4.99363437 7.51751649,4.50617043 7.00842529,4.5 Z\"\r\n                id=\"Error\"\r\n              />\r\n            </g>\r\n          </g>\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function WarningIcon() {\r\n  return (\r\n    <svg width=\"16px\" height=\"14px\" viewBox=\"0 0 16 14\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <g stroke=\"none\" strokeWidth=\"1\" fill=\"none\" fillRule=\"evenodd\">\r\n        <g transform=\"translate(-273.000000, -162.000000)\" fill=\"#E46216\">\r\n          <g transform=\"translate(251.000000, 143.000000)\">\r\n            <g transform=\"translate(22.000000, 19.000000)\">\r\n              <path d=\"M6.68405227,0.743750848 C7.26590697,-0.247916949 8.73410873,-0.247916949 9.31596344,0.743750848 L9.31596344,0.743750848 L15.7980583,11.7915293 C16.3754418,12.775573 15.6458879,14 14.4821027,14 L14.4821027,14 L1.5178827,14 C0.354135396,14 -0.375441293,12.775573 0.201934693,11.7915293 L0.201934693,11.7915293 Z M8,10 C7.44771525,10 7,10.4477153 7,11 C7,11.5522847 7.44771525,12 8,12 C8.55228475,12 9,11.5522847 9,11 C9,10.4477153 8.55228475,10 8,10 Z M8.01011035,5 L7.98974671,5 L7.87816923,5.00681158 C7.32928042,5.07427655 6.92320065,5.63308608 7.01229161,6.24395862 L7.01229161,6.24395862 L7.43992821,8.48168391 L7.46058982,8.57746523 C7.53403676,8.82448556 7.74990819,9 8.00332247,9 L8.00332247,9 L8.09436762,8.9919759 C8.33199007,8.94972242 8.5237268,8.74495557 8.55992884,8.48168391 L8.55992884,8.48168391 L8.98756545,6.24395862 L8.99896034,6.12268979 C9.02431547,5.52149772 8.58283795,5.00694173 8.01011035,5 L8.01011035,5 Z\" />\r\n            </g>\r\n          </g>\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport {\r\n  IconButton, makeStyles, Theme, Typography,\r\n} from '@material-ui/core';\r\nimport MUISnackbar from '@material-ui/core/Snackbar';\r\nimport ErrorIcon from '../../icons/ErrorIcon';\r\nimport WarningIcon from '../../icons/WarningIcon';\r\n\r\ninterface SnackbarProps {\r\n  headline: string;\r\n  message: string | React.ReactNode | React.ReactNodeArray;\r\n  variant?: 'error' | 'warning';\r\n  open: boolean;\r\n  handleClose?: () => void;\r\n}\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    display: 'flex',\r\n    alignItems: 'baseline',\r\n    justifyContent: 'space-between',\r\n    width: '400px',\r\n    minHeight: '50px',\r\n    background: 'white',\r\n    padding: '1em',\r\n    borderRadius: '3px',\r\n    boxShadow: '0 12px 24px 4px rgba(40,42,43,0.2)',\r\n    [theme.breakpoints.down('sm')]: {\r\n      width: '100%',\r\n    },\r\n  },\r\n  contentContainer: {\r\n    display: 'flex',\r\n  },\r\n  iconContainer: {\r\n    display: 'flex',\r\n    padding: '0 1.3em 0 0.3em',\r\n    transform: 'translateY(4px)',\r\n  },\r\n  headline: {\r\n    fontWeight: 'bold',\r\n  },\r\n  error: {\r\n    borderLeft: '4px solid #D61F1F',\r\n  },\r\n  warning: {\r\n    borderLeft: '4px solid #E46216',\r\n  },\r\n}));\r\n\r\nexport default function Snackbar({\r\n  headline, message, variant, open, handleClose,\r\n}: SnackbarProps) {\r\n  const classes = useStyles();\r\n\r\n  const handleOnClose = (_: React.SyntheticEvent | React.MouseEvent, reason?: string) => {\r\n    if (reason === 'clickaway') {\r\n      return;\r\n    }\r\n\r\n    handleClose?.();\r\n  };\r\n\r\n  return (\r\n    <MUISnackbar\r\n      anchorOrigin={{\r\n        vertical: 'top',\r\n        horizontal: 'right',\r\n      }}\r\n      open={open}\r\n      onClose={handleOnClose}\r\n    >\r\n      <div\r\n        className={clsx(classes.container, {\r\n          [classes.error]: variant === 'error',\r\n          [classes.warning]: variant === 'warning',\r\n        })}\r\n      >\r\n        <div className={classes.contentContainer}>\r\n          <div className={classes.iconContainer}>\r\n            {variant === 'warning' && <WarningIcon />}\r\n            {variant === 'error' && <ErrorIcon />}\r\n          </div>\r\n          <div>\r\n            <Typography variant=\"body1\" className={classes.headline} component=\"span\">\r\n              {headline}\r\n            </Typography>\r\n            <Typography variant=\"body1\" component=\"span\">\r\n              {' '}\r\n              {message}\r\n            </Typography>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          {handleClose && (\r\n            <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\r\n              <CloseIcon fontSize=\"small\" />\r\n            </IconButton>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </MUISnackbar>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport Snackbar from '../Snackbar/Snackbar';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nexport default function ReconnectingNotification() {\r\n  const roomState = useRoomState();\r\n\r\n  return (\r\n    <Snackbar\r\n      variant=\"error\"\r\n      headline=\"Connection Lost:\"\r\n      message=\"Reconnecting to room...\"\r\n      open={roomState === 'reconnecting'}\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport Snackbar from '../../Snackbar/Snackbar';\r\nimport { useHasAudioInputDevices, useHasVideoInputDevices } from '../../../hooks/deviceHooks/deviceHooks';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport function getSnackbarContent(hasAudio: boolean, hasVideo: boolean, error?: Error) {\r\n  let headline = '';\r\n  let message: string | JSX.Element = '';\r\n\r\n  switch (true) {\r\n    // This error is emitted when the user or the user's system has denied permission to use the media devices\r\n    case error?.name === 'NotAllowedError':\r\n      headline = 'Unable to Access Media:';\r\n\r\n      if (error!.message === 'Permission denied by system') {\r\n        // Chrome only\r\n        message = 'The operating system has blocked the browser from accessing the microphone or camera. Please check your operating system settings.';\r\n      } else {\r\n        message = (\r\n          <>\r\n            Clowdr has been denied permission to use audio and video.\r\n            <br />\r\n            Learn how to enable audio and video in your browser:\r\n            <ul style={{ marginTop: '0.4em' }}>\r\n              <li>\r\n                <a\r\n                  href=\"https://support.google.com/chrome/answer/2693767\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Google Chrome\r\n                </a>\r\n              </li>\r\n              <li>\r\n                <a\r\n                  href=\"https://support.mozilla.org/en-US/kb/how-manage-your-camera-and-microphone-permissions\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Mozilla Firefox\r\n                </a>\r\n              </li>\r\n            </ul>\r\n          </>\r\n        );\r\n      }\r\n\r\n      break;\r\n\r\n      // This error is emitted when input devices are not connected or disabled in the OS settings\r\n    case error?.name === 'NotFoundError':\r\n      headline = 'Cannot Find Microphone or Camera:';\r\n      message = 'The browser cannot access the microphone or camera. Please make sure all input devices are connected and enabled.';\r\n      break;\r\n\r\n      // Other getUserMedia errors are less likely to happen in this app. Here we will display\r\n      // the system's error message directly to the user.\r\n    case Boolean(error):\r\n      headline = 'Error Acquiring Media:';\r\n      message = `${error!.name} ${error!.message}`;\r\n      break;\r\n\r\n    case !hasAudio && !hasVideo:\r\n      headline = 'No Camera or Microphone Detected:';\r\n      message = 'Other participants in the room will be unable to see and hear you.';\r\n      break;\r\n\r\n    case !hasVideo:\r\n      headline = 'No Camera Detected:';\r\n      message = 'Other participants in the room will be unable to see you.';\r\n      break;\r\n\r\n    case !hasAudio:\r\n      headline = 'No Microphone Detected:';\r\n      message = 'Other participants in the room will be unable to hear you.';\r\n  }\r\n\r\n  return {\r\n    headline,\r\n    message,\r\n  };\r\n}\r\n\r\nexport default function MediaErrorSnackbar({ error, dismissError }: { error?: Error; dismissError?(): void }) {\r\n  const hasAudio = useHasAudioInputDevices();\r\n  const hasVideo = useHasVideoInputDevices();\r\n\r\n  const { isAcquiringLocalTracks } = useVideoContext();\r\n\r\n  const isSnackbarOpen = !isAcquiringLocalTracks && (Boolean(error) || !hasAudio || !hasVideo);\r\n\r\n  const { headline, message } = getSnackbarContent(hasAudio, hasVideo, error);\r\n\r\n  return (\r\n    <Snackbar\r\n      open={isSnackbarOpen}\r\n      handleClose={() => {\r\n        if (dismissError) {\r\n          dismissError();\r\n        }\r\n      }}\r\n      headline={headline}\r\n      message={message}\r\n      variant=\"warning\"\r\n    />\r\n  );\r\n}\r\n","/* eslint-disable */\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { styled, Theme } from '@material-ui/core/styles';\r\n\r\nimport { Room as TwilioRoom } from 'twilio-video';\r\n\r\nimport { Prompt } from 'react-router-dom';\r\nimport Room from '../VideoFrontend/components/Room/Room';\r\nimport MenuBar from '../VideoFrontend/components/MenuBar/MenuBar';\r\nimport MobileTopMenuBar from '../VideoFrontend/components/MobileTopMenuBar/MobileTopMenuBar';\r\nimport ReconnectingNotification from '../VideoFrontend/components/ReconnectingNotification/ReconnectingNotification';\r\nimport useRoomState from '../VideoFrontend/hooks/useRoomState/useRoomState';\r\nimport useLocalAudioToggle from '../VideoFrontend/hooks/useLocalAudioToggle/useLocalAudioToggle';\r\nimport useVideoContext from '../VideoFrontend/hooks/useVideoContext/useVideoContext';\r\nimport useLocalVideoToggle from '../VideoFrontend/hooks/useLocalVideoToggle/useLocalVideoToggle';\r\nimport './VideoGrid.scss';\r\nimport MediaErrorSnackbar from '../VideoFrontend/components/PreJoinScreens/MediaErrorSnackbar/MediaErrorSnackbar';\r\nimport usePresenting from '../VideoFrontend/components/VideoProvider/usePresenting/usePresenting';\r\nimport useMaybeVideo from '../../../hooks/useMaybeVideo';\r\n\r\nconst Container = styled('div')({\r\n  display: 'grid',\r\n  gridTemplateRows: '1fr auto',\r\n});\r\n\r\nconst Main = styled('main')(({ theme: _theme }: { theme: Theme }) => ({\r\n  overflow: 'hidden',\r\n  position: 'relative',\r\n  paddingBottom: `${_theme.footerHeight}px`, // Leave some space for the footer\r\n  [_theme.breakpoints.down('sm')]: {\r\n    paddingBottom: `${_theme.mobileFooterHeight + _theme.mobileTopBarHeight}px`, // Leave some space for the mobile header and footer\r\n  },\r\n}));\r\n\r\ninterface Props {\r\n  highlightedProfiles?: string[];\r\n  hexColour?: string;\r\n  preferredMode: 'sidebar' | 'fullwidth';\r\n  onPresentingChanged?(presenting: boolean): void;\r\n}\r\n\r\nexport default function VideoGrid(props: Props) {\r\n  const { room } = useVideoContext();\r\n  const roomState = useRoomState();\r\n  const coveyController = useMaybeVideo();\r\n\r\n  const { stopAudio } = useLocalAudioToggle();\r\n  const { stopVideo } = useLocalVideoToggle();\r\n  const unmountRef = useRef<() => void>();\r\n  const unloadRef = useRef<EventListener>();\r\n  const existingRoomRef = useRef<TwilioRoom | undefined>();\r\n  const [mediaError, setMediaError] = useState<Error>();\r\n  const presenting = usePresenting();\r\n\r\n  let coveyRoom = coveyController?.coveyTownID;\r\n  if (!coveyRoom) coveyRoom = 'Disconnected';\r\n  useEffect(() => {\r\n    function stop() {\r\n      try {\r\n        stopAudio();\r\n      } catch {}\r\n\r\n      try {\r\n        stopVideo();\r\n      } catch {}\r\n\r\n      try {\r\n        if (roomState === 'connected' || roomState === 'reconnecting') {\r\n          room.disconnect();\r\n        }\r\n      } catch {}\r\n    }\r\n\r\n    unmountRef.current = () => {\r\n      stop();\r\n    };\r\n    unloadRef.current = (ev) => {\r\n      ev.preventDefault();\r\n      stop();\r\n    };\r\n  }, [room, roomState, stopAudio, stopVideo]);\r\n\r\n  useEffect(() => () => {\r\n    if (unmountRef && unmountRef.current) {\r\n      unmountRef.current();\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (unloadRef && unloadRef.current) {\r\n      window.addEventListener('beforeunload', unloadRef.current);\r\n    }\r\n    return () => {\r\n      if (unloadRef && unloadRef.current) window.removeEventListener('beforeunload', unloadRef.current);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      existingRoomRef.current\r\n            && (room.sid !== existingRoomRef.current.sid || coveyRoom !== existingRoomRef.current.sid)\r\n    ) {\r\n      if (existingRoomRef.current.state === 'connected') {\r\n        existingRoomRef.current.disconnect();\r\n      }\r\n    }\r\n    existingRoomRef.current = room;\r\n  }, [room.sid, room, coveyRoom]);\r\n\r\n  useEffect(() => {\r\n    const isPresenting = presenting === 'presenting';\r\n    if (props.onPresentingChanged) {\r\n      props.onPresentingChanged(isPresenting);\r\n    }\r\n  }, [presenting, props]);\r\n\r\n  return (\r\n    <>\r\n      <Prompt when={roomState !== 'disconnected'} message=\"Are you sure you want to leave the video room?\" />\r\n      <Container style={{ height: '100%' }} className=\"video-grid\">\r\n        {roomState === 'disconnected' ? (\r\n        // <PreJoinScreens room={{id: coveyRoom, twilioID: coveyRoom}} setMediaError={setMediaError} />\r\n          <div>Error</div>\r\n        ) : (\r\n          <Main style={{ paddingBottom: '90px' }}>\r\n            <ReconnectingNotification />\r\n            <MobileTopMenuBar />\r\n            <Room />\r\n            <MenuBar setMediaError={setMediaError} />\r\n          </Main>\r\n        )}\r\n        <MediaErrorSnackbar error={mediaError} dismissError={() => setMediaError(undefined)} />\r\n      </Container>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport AudioLevelIndicator from '../AudioLevelIndicator/AudioLevelIndicator';\r\n\r\nexport default function LocalAudioLevelIndicator() {\r\n  const { localAudioTrack: audioTrack } = useVideoContext();\r\n  return <AudioLevelIndicator audioTrack={audioTrack} />;\r\n}\r\n","import React from 'react';\r\nimport { makeStyles, Theme, Typography } from '@material-ui/core';\r\nimport AvatarIcon from '../../../../icons/AvatarIcon';\r\nimport LocalAudioLevelIndicator from '../../../LocalAudioLevelIndicator/LocalAudioLevelIndicator';\r\nimport VideoTrack from '../../../VideoTrack/VideoTrack';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    position: 'relative',\r\n    height: 0,\r\n    overflow: 'hidden',\r\n    paddingTop: `${(9 / 16) * 100}%`,\r\n    background: 'black',\r\n  },\r\n  innerContainer: {\r\n    position: 'absolute',\r\n    top: 0,\r\n    left: 0,\r\n    width: '100%',\r\n    height: '100%',\r\n  },\r\n  identityContainer: {\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    zIndex: 1,\r\n  },\r\n  identity: {\r\n    background: 'rgba(0, 0, 0, 0.5)',\r\n    color: 'white',\r\n    padding: '0.18em 0.3em',\r\n    margin: 0,\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n  },\r\n  avatarContainer: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: 'black',\r\n    position: 'absolute',\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    left: 0,\r\n    zIndex: 1,\r\n    [theme.breakpoints.down('sm')]: {\r\n      '& svg': {\r\n        transform: 'scale(0.7)',\r\n      },\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function LocalVideoPreview({ identity }: { identity: string }) {\r\n  const classes = useStyles();\r\n  const { localVideoTrack: videoTrack } = useVideoContext();\r\n\r\n  return (\r\n    <div className={classes.container}>\r\n      <div className={classes.innerContainer}>\r\n        {videoTrack ? (\r\n          <VideoTrack track={videoTrack} isLocal />\r\n        ) : (\r\n          <div className={classes.avatarContainer}>\r\n            <AvatarIcon />\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className={classes.identityContainer}>\r\n        <span className={classes.identity}>\r\n          <LocalAudioLevelIndicator />\r\n          <Typography variant=\"body1\" color=\"inherit\" component=\"span\">\r\n            {identity}\r\n          </Typography>\r\n        </span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { VideoTrack } from 'twilio-video';\r\n\r\nexport type RenderDimensionValue =\r\n  | 'low'\r\n  | 'cif'\r\n  | 'vga'\r\n  | 'wvga'\r\n  | '540p'\r\n  | '720p'\r\n  | '960p'\r\n  | 'standard1080p'\r\n  | 'wide1080p'\r\n  | 'default';\r\n\r\nexport interface RenderDimension {\r\n  label: string;\r\n  value: RenderDimensionValue;\r\n  resolution?: VideoTrack.Dimensions;\r\n}\r\n\r\nexport const RenderDimensions: RenderDimension[] = [\r\n  {\r\n    label: 'Low (160 x 90)',\r\n    value: 'low',\r\n    resolution: { width: 160, height: 90 },\r\n  },\r\n  {\r\n    label: 'CIF (352 x 288)',\r\n    value: 'cif',\r\n    resolution: { width: 352, height: 288 },\r\n  },\r\n  {\r\n    label: 'VGA (640 x 480)',\r\n    value: 'vga',\r\n    resolution: { width: 640, height: 480 },\r\n  },\r\n  {\r\n    label: 'WVGA (800 x 480)',\r\n    value: 'wvga',\r\n    resolution: { width: 800, height: 480 },\r\n  },\r\n  {\r\n    label: 'HD 540P (960 x 540)',\r\n    value: '540p',\r\n    resolution: { width: 960, height: 540 },\r\n  },\r\n  {\r\n    label: 'HD 720P (1280 x 720)',\r\n    value: '720p',\r\n    resolution: { width: 1280, height: 720 },\r\n  },\r\n  {\r\n    label: 'HD 960P (1280 x 960)',\r\n    value: '960p',\r\n    resolution: { width: 1280, height: 960 },\r\n  },\r\n  {\r\n    label: 'HD Standard 1080P (1440 x 1080)',\r\n    value: 'standard1080p',\r\n    resolution: { width: 1440, height: 1080 },\r\n  },\r\n  {\r\n    label: 'HD Widescreen 1080P (1920 x 1080)',\r\n    value: 'wide1080p',\r\n    resolution: { width: 1920, height: 1080 },\r\n  },\r\n  {\r\n    label: 'Server Default',\r\n    value: 'default',\r\n    resolution: undefined,\r\n  },\r\n];\r\n\r\nexport function getResolution(value?: RenderDimensionValue) {\r\n  if (typeof value === 'undefined') {\r\n    return undefined;\r\n  }\r\n\r\n  return RenderDimensions.find((item) => item.value === value)?.resolution;\r\n}\r\n","import React, { useCallback } from 'react';\r\nimport {\r\n  Button,\r\n  Dialog,\r\n  DialogActions,\r\n  DialogContent,\r\n  DialogTitle,\r\n  Divider,\r\n  FormControl,\r\n  Grid,\r\n  InputLabel,\r\n  MenuItem,\r\n  Select,\r\n  TextField,\r\n  Theme,\r\n  Typography,\r\n} from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { inputLabels, Settings } from '../../state/settings/settingsReducer';\r\nimport { RenderDimensions } from '../../state/settings/renderDimensions';\r\nimport { useAppState } from '../../state';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  container: {\r\n    width: '600px',\r\n    minHeight: '400px',\r\n    [theme.breakpoints.down('xs')]: {\r\n      width: 'calc(100vw - 32px)',\r\n    },\r\n    '& .inputSelect': {\r\n      width: 'calc(100% - 35px)',\r\n    },\r\n  },\r\n  button: {\r\n    float: 'right',\r\n  },\r\n  paper: {\r\n    [theme.breakpoints.down('xs')]: {\r\n      margin: '16px',\r\n    },\r\n  },\r\n  formControl: {\r\n    display: 'block',\r\n    margin: '1.5em 0',\r\n    '&:first-child': {\r\n      margin: '0 0 1.5em 0',\r\n    },\r\n  },\r\n  label: {\r\n    width: '133%', // Labels have scale(0.75) applied to them, so this effectively makes the width 100%\r\n  },\r\n}));\r\n\r\nconst withDefault = (val?: string) => (typeof val === 'undefined' ? 'default' : val);\r\n\r\nconst RenderDimensionItems = RenderDimensions.map(({ label, value }) => (\r\n  <MenuItem value={value} key={value}>\r\n    {label}\r\n  </MenuItem>\r\n));\r\n\r\nexport default function ConnectionOptionsDialog({ open, onClose }: { open: boolean; onClose: () => void }) {\r\n  const classes = useStyles();\r\n  const { settings, dispatchSetting } = useAppState();\r\n  const roomState = useRoomState();\r\n  const isDisabled = roomState !== 'disconnected';\r\n\r\n  const handleChange = useCallback(\r\n    (e: React.ChangeEvent<{ value: unknown; name?: string }>) => {\r\n      dispatchSetting({ name: e.target.name as keyof Settings, value: e.target.value as string });\r\n    },\r\n    [dispatchSetting],\r\n  );\r\n\r\n  const handleNumberChange = useCallback(\r\n    (e: React.ChangeEvent<{ value: unknown; name?: string }>) => {\r\n      if (!/[^\\d]/.test(e.target.value as string)) handleChange(e);\r\n    },\r\n    [handleChange],\r\n  );\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} classes={{ paper: classes.paper }}>\r\n      <DialogTitle>Connection Settings</DialogTitle>\r\n      <Divider />\r\n      <DialogContent className={classes.container}>\r\n        <Grid container spacing={2}>\r\n          <Grid item xs={12}>\r\n            <Typography hidden={!isDisabled} variant=\"body2\">\r\n              These settings cannot be changed when connected to a room.\r\n            </Typography>\r\n          </Grid>\r\n\r\n          <Grid item sm={6} xs={12}>\r\n            <FormControl className={classes.formControl}>\r\n              <InputLabel id={inputLabels.dominantSpeakerPriority}>Dominant Speaker Priority:</InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.dominantSpeakerPriority}\r\n                label={inputLabels.dominantSpeakerPriority}\r\n                value={withDefault(settings.dominantSpeakerPriority)}\r\n                onChange={handleChange}\r\n              >\r\n                <MenuItem value=\"low\">Low</MenuItem>\r\n                <MenuItem value=\"standard\">Standard</MenuItem>\r\n                <MenuItem value=\"high\">High</MenuItem>\r\n                <MenuItem value=\"default\">Server Default</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl className={classes.formControl}>\r\n              <InputLabel id={inputLabels.trackSwitchOffMode}>Track Switch Off Mode:</InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.trackSwitchOffMode}\r\n                label={inputLabels.trackSwitchOffMode}\r\n                value={withDefault(settings.trackSwitchOffMode)}\r\n                onChange={handleChange}\r\n              >\r\n                <MenuItem value=\"predicted\">Predicted</MenuItem>\r\n                <MenuItem value=\"detected\">Detected</MenuItem>\r\n                <MenuItem value=\"disabled\">Disabled</MenuItem>\r\n                <MenuItem value=\"default\">Server Default</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl className={classes.formControl}>\r\n              <InputLabel id={inputLabels.bandwidthProfileMode}>Mode:</InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.bandwidthProfileMode}\r\n                label={inputLabels.bandwidthProfileMode}\r\n                value={withDefault(settings.bandwidthProfileMode)}\r\n                onChange={handleChange}\r\n              >\r\n                <MenuItem value=\"grid\">Grid</MenuItem>\r\n                <MenuItem value=\"collaboration\">Collaboration</MenuItem>\r\n                <MenuItem value=\"presentation\">Presentation</MenuItem>\r\n                <MenuItem value=\"default\">Server Default</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl className={classes.formControl}>\r\n              <TextField\r\n                disabled={isDisabled}\r\n                fullWidth\r\n                id={inputLabels.maxTracks}\r\n                label=\"Max Tracks\"\r\n                placeholder=\"Leave blank for no limit\"\r\n                name={inputLabels.maxTracks}\r\n                value={withDefault(settings.maxTracks)}\r\n                onChange={handleNumberChange}\r\n              />\r\n            </FormControl>\r\n\r\n            <FormControl className={classes.formControl}>\r\n              <TextField\r\n                disabled={isDisabled}\r\n                fullWidth\r\n                id={inputLabels.maxAudioBitrate}\r\n                label=\"Max Audio Bitrate\"\r\n                placeholder=\"Leave blank for no limit\"\r\n                name={inputLabels.maxAudioBitrate}\r\n                value={withDefault(settings.maxAudioBitrate)}\r\n                onChange={handleNumberChange}\r\n              />\r\n            </FormControl>\r\n          </Grid>\r\n          <Grid item sm={6} xs={12}>\r\n            <FormControl fullWidth className={classes.formControl}>\r\n              <InputLabel id={inputLabels.renderDimensionLow} className={classes.label}>\r\n                Render Dimension (Low Priority):\r\n              </InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.renderDimensionLow}\r\n                label={inputLabels.renderDimensionLow}\r\n                value={withDefault(settings.renderDimensionLow)}\r\n                onChange={handleChange}\r\n              >\r\n                {RenderDimensionItems}\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl fullWidth className={classes.formControl}>\r\n              <InputLabel id={inputLabels.renderDimensionStandard} className={classes.label}>\r\n                Render Dimension (Standard Priority):\r\n              </InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.renderDimensionStandard}\r\n                label={inputLabels.renderDimensionStandard}\r\n                value={withDefault(settings.renderDimensionStandard)}\r\n                onChange={handleChange}\r\n              >\r\n                {RenderDimensionItems}\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <FormControl fullWidth className={classes.formControl}>\r\n              <InputLabel id={inputLabels.renderDimensionHigh} className={classes.label}>\r\n                Render Dimension (High Priority):\r\n              </InputLabel>\r\n              <Select\r\n                fullWidth\r\n                disabled={isDisabled}\r\n                name={inputLabels.renderDimensionHigh}\r\n                label={inputLabels.renderDimensionHigh}\r\n                value={withDefault(settings.renderDimensionHigh)}\r\n                onChange={handleChange}\r\n              >\r\n                {RenderDimensionItems}\r\n              </Select>\r\n            </FormControl>\r\n          </Grid>\r\n        </Grid>\r\n      </DialogContent>\r\n      <Divider />\r\n      <DialogActions>\r\n        <Button className={classes.button} color=\"primary\" variant=\"contained\" onClick={onClose}>\r\n          Done\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nexport default function SettingsIcon() {\r\n  return (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n      <g fill=\"none\" fillRule=\"evenodd\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n        <g fill=\"#707578\">\r\n          <path\r\n            d=\"M10 .833c.276 0 .5.224.5.5l-.001 1.775.16.042c.423.113.775.226 1.072.35l.121.054 1.273-1.272c.173-.173.442-.192.637-.057l.07.057 1.886 1.886c.195.196.195.512 0 .708l-1.273 1.27.055.123c.125.297.238.65.351 1.073l.041.158h1.775c.245 0 .45.177.492.41l.008.09v2c0 .276-.224.5-.5.5H14.89l-.03.118c-.115.431-.231.798-.358 1.103l-.058.131 1.273 1.273c.173.174.192.443.057.638l-.057.07-1.886 1.885c-.195.195-.511.195-.707 0l-1.273-1.272-.12.053c-.296.125-.648.238-1.071.352l-.162.041.001 1.775c0 .245-.177.45-.41.492l-.09.008H8c-.276 0-.5-.224-.5-.5l-.001-1.775-.161-.042c-.425-.114-.776-.227-1.072-.351l-.12-.054-1.271 1.272c-.174.174-.443.193-.638.058l-.07-.057-1.885-1.886c-.195-.195-.196-.512 0-.707l1.272-1.273-.053-.12c-.125-.296-.238-.648-.352-1.071l-.042-.161H1.333c-.245 0-.45-.177-.492-.41L.833 10V8c0-.276.224-.5.5-.5h1.774l.042-.16c.114-.424.227-.776.352-1.072l.052-.121-1.271-1.271c-.174-.174-.193-.443-.058-.638l.058-.07 1.886-1.886c.195-.195.512-.195.707 0l1.272 1.272.121-.053c.297-.125.65-.238 1.073-.351l.158-.042.001-1.775c0-.245.177-.45.41-.492L8 .833zm-.501 1h-1L8.5 3.499c0 .202-.121.38-.302.459l-.08.027c-.857.206-1.458.397-1.805.608-.197.12-.45.09-.614-.073L4.521 3.342 3.342 4.521 4.52 5.699c.14.14.182.347.116.527l-.043.087c-.211.347-.402.947-.61 1.805-.054.224-.255.382-.486.382H1.833v1h1.664c.202 0 .381.121.46.301l.026.081c.208.858.399 1.458.61 1.805.12.197.09.45-.073.614l-1.178 1.177 1.178 1.179 1.178-1.178c.14-.14.347-.182.528-.115l.087.042c.277.17.714.325 1.32.487l.485.124c.224.054.382.255.382.486l-.001 1.663h1l.001-1.663c0-.202.121-.381.301-.46l.081-.026c.858-.208 1.458-.399 1.804-.61.197-.12.45-.09.614.073l1.178 1.177 1.179-1.179-1.177-1.177c-.14-.14-.182-.347-.116-.527l.043-.087c.189-.31.37-.852.554-1.577l.056-.23c.055-.223.256-.38.486-.38h1.663v-1h-1.664c-.202 0-.381-.121-.46-.302l-.026-.08c-.206-.854-.398-1.458-.61-1.806-.12-.197-.09-.45.074-.614l1.176-1.177-1.178-1.178L12.3 4.52c-.14.14-.346.182-.526.116l-.088-.043c-.277-.169-.717-.325-1.32-.486l-.483-.122C9.658 3.93 9.5 3.73 9.5 3.499l-.001-1.666zm1.976 4.692c1.367 1.367 1.367 3.583 0 4.95s-3.583 1.367-4.95 0-1.367-3.583 0-4.95 3.583-1.367 4.95 0zm-4.243.707c-.976.977-.976 2.56 0 3.536.977.976 2.56.976 3.536 0 .934-.934.974-2.423.122-3.405l-.122-.13-.13-.123c-.983-.852-2.472-.812-3.406.122z\"\r\n            transform=\"translate(-636 -585) translate(276 301) translate(360 284) translate(3 3)\"\r\n          />\r\n        </g>\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React, { useState, useRef } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport MenuContainer from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport MoreIcon from '@material-ui/icons/MoreVert';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { makeStyles, Theme, useMediaQuery } from '@material-ui/core';\r\n\r\nimport ConnectionOptionsDialog from '../../../ConnectionOptionsDialog/ConnectionOptionsDialog';\r\nimport DeviceSelectionDialog from '../../../DeviceSelectionDialog/DeviceSelectionDialog';\r\nimport SettingsIcon from '../../../../icons/SettingsIcon';\r\nimport { useAppState } from '../../../../state';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  settingsButton: {\r\n    margin: '1.8em 0 0',\r\n    '&:hover': {\r\n      color: 'black',\r\n    },\r\n  },\r\n}));\r\n\r\nexport default function SettingsMenu({ mobileButtonClass }: { mobileButtonClass?: string }) {\r\n  const classes = useStyles();\r\n  const { roomType } = useAppState();\r\n  const isMobile = useMediaQuery((theme: Theme) => theme.breakpoints.down('sm'));\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [deviceSettingsOpen, setDeviceSettingsOpen] = useState(false);\r\n  const [connectionSettingsOpen, setConnectionSettingsOpen] = useState(false);\r\n\r\n  const anchorRef = useRef<HTMLButtonElement>(null);\r\n\r\n  return (\r\n    <>\r\n      {isMobile ? (\r\n        <Button\r\n          ref={anchorRef}\r\n          onClick={() => setMenuOpen(true)}\r\n          startIcon={<MoreIcon />}\r\n          className={mobileButtonClass}\r\n        >\r\n          More\r\n        </Button>\r\n      ) : (\r\n        <Button\r\n          ref={anchorRef}\r\n          onClick={() => setMenuOpen(true)}\r\n          startIcon={<SettingsIcon />}\r\n          className={classes.settingsButton}\r\n        >\r\n          Settings\r\n        </Button>\r\n      )}\r\n      <MenuContainer\r\n        open={menuOpen}\r\n        onClose={() => setMenuOpen((isOpen) => !isOpen)}\r\n        anchorEl={anchorRef.current}\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: isMobile ? 'left' : 'right',\r\n        }}\r\n        transformOrigin={{\r\n          vertical: isMobile ? -55 : -45,\r\n          horizontal: 'center',\r\n        }}\r\n      >\r\n        <MenuItem onClick={() => setDeviceSettingsOpen(true)}>\r\n          <Typography variant=\"body1\">Audio and Video Settings</Typography>\r\n        </MenuItem>\r\n        {roomType !== 'peer-to-peer' && roomType !== 'go' && (\r\n        <MenuItem onClick={() => setConnectionSettingsOpen(true)}>\r\n          <Typography variant=\"body1\">Connection Settings</Typography>\r\n        </MenuItem>\r\n        )}\r\n      </MenuContainer>\r\n      <DeviceSelectionDialog\r\n        open={deviceSettingsOpen}\r\n        onClose={() => {\r\n          setDeviceSettingsOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n      <ConnectionOptionsDialog\r\n        open={connectionSettingsOpen}\r\n        onClose={() => {\r\n          setConnectionSettingsOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","import React, { useCallback } from 'react';\r\nimport { Grid, Hidden, makeStyles, Theme, } from '@material-ui/core';\r\nimport { useForm } from 'react-hook-form';\r\nimport { Button, FormControl, FormErrorMessage, FormLabel, Input, useToast, } from '@chakra-ui/react';\r\nimport assert from 'assert';\r\nimport LocalVideoPreview from './LocalVideoPreview/LocalVideoPreview';\r\nimport SettingsMenu from './SettingsMenu/SettingsMenu';\r\nimport ToggleAudioButton from '../../Buttons/ToggleAudioButton/ToggleAudioButton';\r\nimport ToggleVideoButton from '../../Buttons/ToggleVideoButton/ToggleVideoButton';\r\nimport { useAppState } from '../../../state';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\nimport { VideoRoom } from '../../../../../../CoveyTypes';\r\n\r\nimport Video from '../../../../../../classes/Video/Video';\r\nimport { TownJoinResponse } from '../../../../../../classes/TownsServiceClient';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  gutterBottom: {\r\n    marginBottom: '1em',\r\n  },\r\n  marginTop: {\r\n    marginTop: '1em',\r\n  },\r\n  deviceButton: {\r\n    color: 'black',\r\n    width: '100%',\r\n    border: '2px solid #aaa',\r\n    margin: '1em 0',\r\n    '&:hover': {\r\n      color: 'black',\r\n    },\r\n  },\r\n  localPreviewContainer: {\r\n    paddingRight: '2em',\r\n    [theme.breakpoints.down('sm')]: {\r\n      padding: '0 2.5em',\r\n    },\r\n  },\r\n  joinButtons: {\r\n    display: 'flex',\r\n    justifyContent: 'space-between',\r\n    [theme.breakpoints.down('sm')]: {\r\n      flexDirection: 'column-reverse',\r\n      width: '100%',\r\n      '& button': {\r\n        margin: '0.5em 0',\r\n      },\r\n    },\r\n  },\r\n  mobileButtonBar: {\r\n    [theme.breakpoints.down('sm')]: {\r\n      display: 'flex',\r\n      justifyContent: 'space-between',\r\n      margin: '1.5em 0 1em',\r\n    },\r\n  },\r\n  mobileButton: {\r\n    padding: '0.8em 0',\r\n    margin: 0,\r\n  },\r\n}));\r\n\r\ninterface DeviceSelectionScreenProps {\r\n  setMediaError?(error: Error): void;\r\n}\r\n\r\nexport default function DeviceSelectionScreen({ setMediaError }: DeviceSelectionScreenProps) {\r\n  const classes = useStyles();\r\n  const { getToken, isFetching } = useAppState();\r\n  const {\r\n    connect, isAcquiringLocalTracks, isConnecting, localAudioTrack, localVideoTrack,\r\n  } = useVideoContext();\r\n  const disableButtons = isFetching || isAcquiringLocalTracks || isConnecting;\r\n  const {\r\n    handleSubmit, errors, register, formState,\r\n  } = useForm();\r\n\r\n  return (\r\n    <>\r\n      <Grid container justify=\"center\" aria-label=\"join video room form\">\r\n        <Grid item md={7} sm={12} xs={12}>\r\n          <div className={classes.localPreviewContainer}>\r\n            <LocalVideoPreview identity=\"\" />\r\n          </div>\r\n          <div className={classes.mobileButtonBar}>\r\n            <Hidden mdUp>\r\n              <ToggleAudioButton\r\n                className={classes.mobileButton}\r\n                disabled={disableButtons}\r\n                setMediaError={setMediaError}\r\n              />\r\n              <ToggleVideoButton\r\n                className={classes.mobileButton}\r\n                disabled={disableButtons}\r\n                setMediaError={setMediaError}\r\n              />\r\n            </Hidden>\r\n            <SettingsMenu mobileButtonClass={classes.mobileButton} />\r\n          </div>\r\n        </Grid>\r\n        <Grid item md={5} sm={12} xs={12}>\r\n          <Grid container direction=\"column\" justify=\"space-between\" style={{ height: '100%' }}>\r\n            <div>\r\n              <Hidden smDown>\r\n                <ToggleAudioButton\r\n                  className={classes.deviceButton}\r\n                  disabled={disableButtons}\r\n                  setMediaError={setMediaError}\r\n                />\r\n                <ToggleVideoButton\r\n                  className={classes.deviceButton}\r\n                  disabled={disableButtons}\r\n                  setMediaError={setMediaError}\r\n                />\r\n              </Hidden>\r\n            </div>\r\n          </Grid>\r\n        </Grid>\r\n      </Grid>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { makeStyles, Theme } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles((theme: Theme) => ({\r\n  background: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    height: '100%',\r\n  },\r\n  container: {\r\n    position: 'relative',\r\n    flex: '1',\r\n  },\r\n  innerContainer: {\r\n    display: 'block',\r\n    height: 'auto',\r\n    width: 'calc(100% - 40px)',\r\n    margin: '10px auto',\r\n    maxWidth: '700px',\r\n\r\n    borderRadius: '8px',\r\n    border: '1px solid #ccc',\r\n    overflow: 'hidden',\r\n    position: 'relative',\r\n  },\r\n  content: {\r\n    background: 'white',\r\n    width: '100%',\r\n    padding: '2em',\r\n    flex: 1,\r\n  },\r\n  subContentContainer: {\r\n    marginTop: '1em',\r\n    width: '100%',\r\n  },\r\n}));\r\n\r\ninterface IntroContainerProps {\r\n  children: React.ReactNode;\r\n  subContent?: React.ReactNode;\r\n}\r\n\r\nconst IntroContainer = (props: IntroContainerProps) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <div className={classes.background}>\r\n      <div className={classes.container}>\r\n        <div className={classes.innerContainer}>\r\n          <div className={classes.content}>{props.children}</div>\r\n        </div>\r\n        {props.subContent && <div className={classes.subContentContainer}>{props.subContent}</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default IntroContainer;\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport assert from \"assert\";\r\nimport {\r\n  Box,\r\n  Button,\r\n  Checkbox,\r\n  Flex,\r\n  FormControl,\r\n  FormLabel,\r\n  Heading,\r\n  Input,\r\n  Stack,\r\n  Table,\r\n  TableCaption,\r\n  Tbody,\r\n  Td,\r\n  Th,\r\n  Thead,\r\n  Tr,\r\n  useToast\r\n} from '@chakra-ui/react';\r\nimport useVideoContext from '../VideoCall/VideoFrontend/hooks/useVideoContext/useVideoContext';\r\nimport Video from '../../classes/Video/Video';\r\nimport { CoveyTownInfo, TownJoinResponse, } from '../../classes/TownsServiceClient';\r\nimport useCoveyAppState from '../../hooks/useCoveyAppState';\r\n\r\ninterface TownSelectionProps {\r\n  doLogin: (initData: TownJoinResponse) => Promise<boolean>\r\n}\r\n\r\nexport default function TownSelection({ doLogin }: TownSelectionProps): JSX.Element {\r\n  const [userName, setUserName] = useState<string>(Video.instance()?.userName || '');\r\n  const [newTownName, setNewTownName] = useState<string>('');\r\n  const [newTownIsPublic, setNewTownIsPublic] = useState<boolean>(true);\r\n  const [townIDToJoin, setTownIDToJoin] = useState<string>('');\r\n  const [currentPublicTowns, setCurrentPublicTowns] = useState<CoveyTownInfo[]>();\r\n  const { connect } = useVideoContext();\r\n  const { apiClient } = useCoveyAppState();\r\n  const toast = useToast();\r\n\r\n  const updateTownListings = useCallback(() => {\r\n    // console.log(apiClient);\r\n    apiClient.listTowns()\r\n      .then((towns) => {\r\n        setCurrentPublicTowns(towns.towns\r\n          .sort((a, b) => b.currentOccupancy - a.currentOccupancy)\r\n        );\r\n      })\r\n  }, [setCurrentPublicTowns, apiClient]);\r\n  useEffect(() => {\r\n    updateTownListings();\r\n    const timer = setInterval(updateTownListings, 2000);\r\n    return () => {\r\n      clearInterval(timer)\r\n    };\r\n  }, [updateTownListings]);\r\n\r\n  const handleJoin = useCallback(async (coveyRoomID: string) => {\r\n    try {\r\n      if (!userName || userName.length === 0) {\r\n        toast({\r\n          title: 'Unable to join town',\r\n          description: 'Please select a username',\r\n          status: 'error',\r\n        });\r\n        return;\r\n      }\r\n      if (!coveyRoomID || coveyRoomID.length === 0) {\r\n        toast({\r\n          title: 'Unable to join town',\r\n          description: 'Please enter a town ID',\r\n          status: 'error',\r\n        });\r\n        return;\r\n      }\r\n      const initData = await Video.setup(userName, coveyRoomID);\r\n\r\n      const loggedIn = await doLogin(initData);\r\n      if (loggedIn) {\r\n        assert(initData.providerVideoToken);\r\n        await connect(initData.providerVideoToken);\r\n      }\r\n    } catch (err) {\r\n      toast({\r\n        title: 'Unable to connect to Towns Service',\r\n        description: err.toString(),\r\n        status: 'error'\r\n      })\r\n    }\r\n  }, [doLogin, userName, connect, toast]);\r\n\r\n  const handleCreate = async () => {\r\n    if (!userName || userName.length === 0) {\r\n      toast({\r\n        title: 'Unable to create town',\r\n        description: 'Please select a username before creating a town',\r\n        status: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!newTownName || newTownName.length === 0) {\r\n      toast({\r\n        title: 'Unable to create town',\r\n        description: 'Please enter a town name',\r\n        status: 'error',\r\n      });\r\n      return;\r\n    }\r\n    try {\r\n      const newTownInfo = await apiClient.createTown({\r\n        friendlyName: newTownName,\r\n        isPubliclyListed: newTownIsPublic\r\n      });\r\n      let privateMessage = <></>;\r\n      if (!newTownIsPublic) {\r\n        privateMessage =\r\n          <p>This town will NOT be publicly listed. To re-enter it, you will need to use this\r\n            ID: {newTownInfo.coveyTownID}</p>;\r\n      }\r\n      toast({\r\n        title: `Town ${newTownName} is ready to go!`,\r\n        description: <>{privateMessage}Please record these values in case you need to change the\r\n          room:<br/>Town ID: {newTownInfo.coveyTownID}<br/>Town Editing\r\n          Password: {newTownInfo.coveyTownPassword}</>,\r\n        status: 'success',\r\n        isClosable: true,\r\n        duration: null,\r\n      })\r\n      await handleJoin(newTownInfo.coveyTownID);\r\n    } catch (err) {\r\n      toast({\r\n        title: 'Unable to connect to Towns Service',\r\n        description: err.toString(),\r\n        status: 'error'\r\n      })\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <form>\r\n        <Stack>\r\n          <Box p=\"4\" borderWidth=\"1px\" borderRadius=\"lg\">\r\n            <Heading as=\"h2\" size=\"lg\">Select a username</Heading>\r\n\r\n            <FormControl>\r\n              <FormLabel htmlFor=\"name\">Name</FormLabel>\r\n              <Input autoFocus name=\"name\" placeholder=\"Your name\"\r\n                     value={userName}\r\n                     onChange={event => setUserName(event.target.value)}\r\n              />\r\n            </FormControl>\r\n          </Box>\r\n          <Box borderWidth=\"1px\" borderRadius=\"lg\">\r\n            <Heading p=\"4\" as=\"h2\" size=\"lg\">Create a New Town</Heading>\r\n            <Flex p=\"4\">\r\n              <Box flex=\"1\">\r\n                <FormControl>\r\n                  <FormLabel htmlFor=\"townName\">New Town Name</FormLabel>\r\n                  <Input name=\"townName\" placeholder=\"New Town Name\"\r\n                         value={newTownName}\r\n                         onChange={event => setNewTownName(event.target.value)}\r\n                  />\r\n                </FormControl>\r\n              </Box><Box>\r\n              <FormControl>\r\n                <FormLabel htmlFor=\"isPublic\">Publicly Listed</FormLabel>\r\n                <Checkbox id=\"isPublic\" name=\"isPublic\" isChecked={newTownIsPublic}\r\n                          onChange={(e) => {\r\n                            setNewTownIsPublic(e.target.checked)\r\n                          }}/>\r\n              </FormControl>\r\n            </Box>\r\n              <Box>\r\n                <Button data-testid=\"newTownButton\" onClick={handleCreate}>Create</Button>\r\n              </Box>\r\n            </Flex>\r\n          </Box>\r\n          <Heading p=\"4\" as=\"h2\" size=\"lg\">-or-</Heading>\r\n\r\n          <Box borderWidth=\"1px\" borderRadius=\"lg\">\r\n            <Heading p=\"4\" as=\"h2\" size=\"lg\">Join an Existing Town</Heading>\r\n            <Box borderWidth=\"1px\" borderRadius=\"lg\">\r\n              <Flex p=\"4\"><FormControl>\r\n                <FormLabel htmlFor=\"townIDToJoin\">Town ID</FormLabel>\r\n                <Input name=\"townIDToJoin\" placeholder=\"ID of town to join, or select from list\"\r\n                       value={townIDToJoin}\r\n                       onChange={event => setTownIDToJoin(event.target.value)}/>\r\n              </FormControl>\r\n                <Button data-testid='joinTownByIDButton'\r\n                        onClick={() => handleJoin(townIDToJoin)}>Connect</Button>\r\n              </Flex>\r\n\r\n            </Box>\r\n\r\n            <Heading p=\"4\" as=\"h4\" size=\"md\">Select a public town to join</Heading>\r\n            <Box maxH=\"500px\" overflowY=\"scroll\">\r\n              <Table>\r\n                <TableCaption placement=\"bottom\">Publicly Listed Towns</TableCaption>\r\n                <Thead><Tr><Th>Room Name</Th><Th>Room ID</Th><Th>Activity</Th></Tr></Thead>\r\n                <Tbody>\r\n                  {currentPublicTowns?.map((town) => (\r\n                    <Tr key={town.coveyTownID}><Td role='cell'>{town.friendlyName}</Td><Td\r\n                      role='cell'>{town.coveyTownID}</Td>\r\n                      <Td role='cell'>{town.currentOccupancy}/{town.maximumOccupancy}\r\n                        <Button onClick={() => handleJoin(town.coveyTownID)}\r\n                                disabled={town.currentOccupancy >= town.maximumOccupancy}>Connect</Button></Td></Tr>\r\n                  ))}\r\n                </Tbody>\r\n              </Table>\r\n            </Box>\r\n          </Box>\r\n        </Stack>\r\n      </form>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Heading, Text } from '@chakra-ui/react';\r\nimport DeviceSelectionScreen from './DeviceSelectionScreen/DeviceSelectionScreen';\r\nimport IntroContainer from '../IntroContainer/IntroContainer';\r\nimport { TownJoinResponse } from '../../../../../classes/TownsServiceClient';\r\nimport TownSelection from '../../../../Login/TownSelection';\r\n\r\nexport default function PreJoinScreens(props: { doLogin: (initData: TownJoinResponse) => Promise<boolean>; setMediaError?(error: Error): void }) {\r\n  return (\r\n    <IntroContainer>\r\n      <Heading as=\"h2\" size=\"xl\">Welcome to Covey.Town!</Heading>\r\n      <Text p=\"4\">\r\n        Covey.Town is a social platform that integrates a 2D game-like metaphor with video chat.\r\n        To get started, setup your camera and microphone, choose a username, and then create a new town\r\n        to hang out in, or join an existing one.\r\n      </Text>\r\n      <DeviceSelectionScreen setMediaError={props.setMediaError} />\r\n      <TownSelection doLogin={props.doLogin} />\r\n    </IntroContainer>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport PreJoinScreens from '../VideoCall/VideoFrontend/components/PreJoinScreens/PreJoinScreens';\r\nimport MediaErrorSnackbar\r\n  from '../VideoCall/VideoFrontend/components/PreJoinScreens/MediaErrorSnackbar/MediaErrorSnackbar';\r\nimport { TownJoinResponse } from '../../classes/TownsServiceClient';\r\n\r\ninterface LoginProps {\r\n  doLogin: (initData: TownJoinResponse) => Promise<boolean>\r\n}\r\n\r\nexport default function Login({ doLogin }: LoginProps): JSX.Element {\r\n  const [mediaError, setMediaError] = useState<Error>();\r\n\r\n  return (\r\n    <>\r\n      <MediaErrorSnackbar error={mediaError} dismissError={() => setMediaError(undefined)} />\r\n      <PreJoinScreens\r\n        doLogin={doLogin}\r\n        setMediaError={setMediaError}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","import { ConnectOptions } from 'twilio-video';\r\nimport { isMobile, removeUndefineds } from '..';\r\nimport { getResolution } from '../../state/settings/renderDimensions';\r\nimport { useAppState } from '../../state';\r\n\r\nexport default function useConnectionOptions() {\r\n  const { roomType, settings } = useAppState();\r\n\r\n  // See: https://media.twiliocdn.com/sdk/js/video/releases/2.0.0/docs/global.html#ConnectOptions\r\n  // for available connection options.\r\n  const connectionOptions: ConnectOptions = {\r\n    // Bandwidth Profile, Dominant Speaker, and Network Quality\r\n    // features are only available in Small Group or Group Rooms.\r\n    // Please set \"Room Type\" to \"Group\" or \"Small Group\" in your\r\n    // Twilio Console: https://www.twilio.com/console/video/configure\r\n    bandwidthProfile: {\r\n      video: {\r\n        mode: 'grid', // settings.bandwidthProfileMode,\r\n        dominantSpeakerPriority: settings.dominantSpeakerPriority,\r\n        renderDimensions: {\r\n          low: { width: 176, height: 144 }, // getResolution(settings.renderDimensionLow),\r\n          standard: { width: 320, height: 240 }, // getResolution(settings.renderDimensionStandard),\r\n          high: { width: 1280, height: 720 }, // getResolution(settings.renderDimensionHigh),\r\n        },\r\n        maxTracks: Number(settings.maxTracks),\r\n      },\r\n    },\r\n    dominantSpeaker: true,\r\n    networkQuality: { local: 1, remote: 1 },\r\n\r\n    // Comment this line if you are playing music.\r\n    maxAudioBitrate: Number(settings.maxAudioBitrate),\r\n\r\n    // VP8 simulcast enables the media server in a Small Group or Group Room\r\n    // to adapt your encoded video quality for each RemoteParticipant based on\r\n    // their individual bandwidth constraints. Simulcast should be disabled if\r\n    // you are using Peer-to-Peer or 'Go' Rooms.\r\n    preferredVideoCodecs: [{ codec: 'VP8', simulcast: roomType !== 'peer-to-peer' && roomType !== 'go' }],\r\n  };\r\n\r\n  // For mobile browsers, limit the maximum incoming video bitrate to 2.5 Mbps.\r\n  if (isMobile && connectionOptions?.bandwidthProfile?.video) {\r\n    connectionOptions!.bandwidthProfile!.video!.maxSubscriptionBitrate = 2500000;\r\n  }\r\n\r\n  // Here we remove any 'undefined' values. The twilio-video SDK will only use defaults\r\n  // when no value is passed for an option. It will throw an error when 'undefined' is passed.\r\n  return removeUndefineds(connectionOptions);\r\n}\r\n","import React from 'react';\r\nimport Video from 'twilio-video';\r\nimport {\r\n  Container, Link, Typography, Paper, Grid,\r\n} from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    marginTop: '2.5em',\r\n  },\r\n  paper: {\r\n    padding: '1em',\r\n  },\r\n  heading: {\r\n    marginBottom: '0.4em',\r\n  },\r\n});\r\n\r\nexport default function ({ children }: { children: React.ReactElement }) {\r\n  const classes = useStyles();\r\n\r\n  if (!Video.isSupported) {\r\n    return (\r\n      <Container>\r\n        <Grid container justify=\"center\" className={classes.container}>\r\n          <Grid item xs={12} sm={6}>\r\n            <Paper className={classes.paper}>\r\n              <Typography variant=\"h4\" className={classes.heading}>\r\n                Browser or context not supported\r\n              </Typography>\r\n              <Typography>\r\n                Please open this application in one of the\r\n                {' '}\r\n                <Link\r\n                  href=\"https://www.twilio.com/docs/video/javascript#supported-browsers\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener\"\r\n                >\r\n                  supported browsers\r\n                </Link>\r\n                .\r\n                <br />\r\n                If you are using a supported browser, please ensure that this app is served over a\r\n                {' '}\r\n                <Link\r\n                  href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener\"\r\n                >\r\n                  secure context\r\n                </Link>\r\n                {' '}\r\n                (e.g. https or localhost).\r\n              </Typography>\r\n            </Paper>\r\n          </Grid>\r\n        </Grid>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return children;\r\n}\r\n","import React, { PropsWithChildren } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport { TwilioError } from 'twilio-video';\r\nimport enhanceMessage from './enhanceMessage';\r\n\r\ninterface ErrorDialogProps {\r\n  dismissError: () => void;\r\n  error: TwilioError | null;\r\n}\r\n\r\nfunction ErrorDialog({ dismissError, error }: PropsWithChildren<ErrorDialogProps>) {\r\n  const { message, code } = error || {};\r\n  const enhancedMessage = enhanceMessage(message, code);\r\n\r\n  return (\r\n    <Dialog open={error !== null} onClose={() => dismissError()} fullWidth maxWidth=\"xs\">\r\n      <DialogTitle>ERROR</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>{enhancedMessage}</DialogContentText>\r\n        {Boolean(code) && (\r\n          <pre>\r\n            <code>\r\n              Error Code:\r\n              {code}\r\n            </code>\r\n          </pre>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => dismissError()} color=\"primary\" autoFocus>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default ErrorDialog;\r\n","// This function is used to provide error messages to the user that are\r\n// different than the error messages provided by the SDK.\r\nexport default function enhanceMessage(message = '', code?: number) {\r\n  switch (code) {\r\n    case 20101: // Invalid token error\r\n      return `${message}. Please make sure you are using the correct credentials.`;\r\n    default:\r\n      return message;\r\n  }\r\n}\r\n","import { createMuiTheme } from '@material-ui/core';\r\n\r\ndeclare module '@material-ui/core/styles/createMuiTheme' {\r\n  interface Theme {\r\n    sidebarWidth: number;\r\n    sidebarMobileHeight: number;\r\n    brand: string;\r\n    footerHeight: number;\r\n    mobileTopBarHeight: number;\r\n    mobileFooterHeight: number;\r\n  }\r\n\r\n  // allow configuration using `createMuiTheme`\r\n  interface ThemeOptions {\r\n    sidebarWidth?: number;\r\n    sidebarMobileHeight?: number;\r\n    brand: string;\r\n    footerHeight: number;\r\n    mobileTopBarHeight: number;\r\n    mobileFooterHeight: number;\r\n  }\r\n}\r\n\r\nconst defaultTheme = createMuiTheme();\r\n\r\nexport default (highlightColour: string) => createMuiTheme({\r\n  overrides: {\r\n    MuiButton: {\r\n      root: {\r\n        borderRadius: '4px',\r\n        textTransform: 'none',\r\n        color: 'rgb(40, 42, 43)',\r\n        fontSize: '0.9rem',\r\n        transition: defaultTheme.transitions.create(['background-color', 'box-shadow', 'border', 'color'], {\r\n          duration: defaultTheme.transitions.duration.short,\r\n        }),\r\n      },\r\n      text: {\r\n        padding: '6px 14px',\r\n      },\r\n      contained: {\r\n        boxShadow: 'none',\r\n        '&:hover': {\r\n          boxShadow: 'none',\r\n        },\r\n      },\r\n      outlinedPrimary: {\r\n        border: '2px solid #027AC5',\r\n        '&:hover': {\r\n          border: '2px solid rgb(1, 85, 137)',\r\n        },\r\n      },\r\n      startIcon: {\r\n        marginRight: '6px',\r\n      },\r\n    },\r\n    MuiTypography: {\r\n      body1: {\r\n        color: 'rgb(40, 42, 43)',\r\n        fontSize: '0.9rem',\r\n      },\r\n    },\r\n    MuiInputBase: {\r\n      root: {\r\n        fontSize: '0.9rem',\r\n      },\r\n    },\r\n    MuiSelect: {\r\n      root: {\r\n        padding: '0.85em',\r\n      },\r\n    },\r\n    MuiDialogActions: {\r\n      root: {\r\n        padding: '16px',\r\n      },\r\n    },\r\n    MuiTextField: {\r\n      root: {\r\n        color: 'rgb(40, 42, 43)',\r\n      },\r\n    },\r\n    MuiInputLabel: {\r\n      root: {\r\n        color: 'rgb(40, 42, 43)',\r\n        fontSize: '1.1rem',\r\n        marginBottom: '0.2em',\r\n        fontWeight: 500,\r\n      },\r\n    },\r\n    MuiOutlinedInput: {\r\n      notchedOutline: {\r\n        borderColor: 'rgb(136, 140, 142)',\r\n      },\r\n    },\r\n  },\r\n  breakpoints: {\r\n    values: {\r\n      xs: 0,\r\n      sm: 640,\r\n      md: 768,\r\n      lg: 1024,\r\n      xl: 1280,\r\n    },\r\n  },\r\n  typography: {\r\n    fontFamily: 'Inter, sans-serif',\r\n  },\r\n  palette: {\r\n    primary: {\r\n      main: highlightColour,\r\n    },\r\n  },\r\n  brand: highlightColour,\r\n  footerHeight: 72,\r\n  mobileFooterHeight: 56,\r\n  sidebarWidth: 355,\r\n  sidebarMobileHeight: 90,\r\n  mobileTopBarHeight: 52,\r\n});\r\n","import React, {\r\n  Dispatch, SetStateAction, useCallback, useEffect, useMemo, useReducer, useState,\r\n} from 'react';\r\nimport './App.css';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport { ChakraProvider } from '@chakra-ui/react';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport assert from 'assert';\r\nimport WorldMap from './components/world/WorldMap';\r\nimport VideoOverlay from './components/VideoCall/VideoOverlay/VideoOverlay';\r\nimport { CoveyAppState, NearbyPlayers } from './CoveyTypes';\r\nimport VideoContext from './contexts/VideoContext';\r\nimport Login from './components/Login/Login';\r\nimport CoveyAppContext from './contexts/CoveyAppContext';\r\nimport NearbyPlayersContext from './contexts/NearbyPlayersContext';\r\nimport AppStateProvider, { useAppState } from './components/VideoCall/VideoFrontend/state';\r\nimport useConnectionOptions from './components/VideoCall/VideoFrontend/utils/useConnectionOptions/useConnectionOptions';\r\nimport UnsupportedBrowserWarning\r\n  from './components/VideoCall/VideoFrontend/components/UnsupportedBrowserWarning/UnsupportedBrowserWarning';\r\nimport { VideoProvider } from './components/VideoCall/VideoFrontend/components/VideoProvider';\r\nimport ErrorDialog from './components/VideoCall/VideoFrontend/components/ErrorDialog/ErrorDialog';\r\nimport theme from './components/VideoCall/VideoFrontend/theme';\r\nimport { Callback } from './components/VideoCall/VideoFrontend/types';\r\nimport Player, { ServerPlayer, UserLocation } from './classes/Player';\r\nimport TownsServiceClient, { TownJoinResponse } from './classes/TownsServiceClient';\r\nimport Video from './classes/Video/Video';\r\n\r\ntype CoveyAppUpdate =\r\n  | { action: 'doConnect'; data: { userName: string, townFriendlyName: string, townID: string,townIsPubliclyListed:boolean, sessionToken: string, myPlayerID: string, socket: Socket, players: Player[], emitMovement: (location: UserLocation) => void } }\r\n  | { action: 'addPlayer'; player: Player }\r\n  | { action: 'playerMoved'; player: Player }\r\n  | { action: 'playerDisconnect'; player: Player }\r\n  | { action: 'weMoved'; location: UserLocation }\r\n  | { action: 'disconnect' }\r\n  ;\r\n\r\nfunction defaultAppState(): CoveyAppState {\r\n  return {\r\n    nearbyPlayers: { nearbyPlayers: [] },\r\n    players: [],\r\n    myPlayerID: '',\r\n    currentTownFriendlyName: '',\r\n    currentTownID: '',\r\n    currentTownIsPubliclyListed: false,\r\n    sessionToken: '',\r\n    userName: '',\r\n    socket: null,\r\n    currentLocation: {\r\n      x: 0, y: 0, rotation: 'front', moving: false,\r\n    },\r\n    emitMovement: () => {\r\n    },\r\n    apiClient: new TownsServiceClient(),\r\n  };\r\n}\r\nfunction appStateReducer(state: CoveyAppState, update: CoveyAppUpdate): CoveyAppState {\r\n  const nextState = {\r\n    sessionToken: state.sessionToken,\r\n    currentTownFriendlyName: state.currentTownFriendlyName,\r\n    currentTownID: state.currentTownID,\r\n    currentTownIsPubliclyListed: state.currentTownIsPubliclyListed,\r\n    myPlayerID: state.myPlayerID,\r\n    players: state.players,\r\n    currentLocation: state.currentLocation,\r\n    nearbyPlayers: state.nearbyPlayers,\r\n    userName: state.userName,\r\n    socket: state.socket,\r\n    emitMovement: state.emitMovement,\r\n    apiClient: state.apiClient,\r\n  };\r\n\r\n  function calculateNearbyPlayers(players: Player[], currentLocation: UserLocation) {\r\n    const isWithinCallRadius = (p: Player, location: UserLocation) => {\r\n      if (p.location && location) {\r\n        const dx = p.location.x - location.x;\r\n        const dy = p.location.y - location.y;\r\n        const d = Math.sqrt(dx * dx + dy * dy);\r\n        return d < 80;\r\n      }\r\n      return false;\r\n    };\r\n    return { nearbyPlayers: players.filter((p) => isWithinCallRadius(p, currentLocation)) };\r\n  }\r\n\r\n  function samePlayers(a1: NearbyPlayers, a2: NearbyPlayers) {\r\n    if (a1.nearbyPlayers.length !== a2.nearbyPlayers.length) return false;\r\n    const ids1 = a1.nearbyPlayers.map((p) => p.id).sort();\r\n    const ids2 = a2.nearbyPlayers.map((p) => p.id).sort();\r\n    return !ids1.some((val, idx) => val !== ids2[idx]);\r\n  }\r\n\r\n  let updatePlayer;\r\n  switch (update.action) {\r\n    case 'doConnect':\r\n      nextState.sessionToken = update.data.sessionToken;\r\n      nextState.myPlayerID = update.data.myPlayerID;\r\n      nextState.currentTownFriendlyName = update.data.townFriendlyName;\r\n      nextState.currentTownID = update.data.townID;\r\n      nextState.currentTownIsPubliclyListed = update.data.townIsPubliclyListed;\r\n      nextState.userName = update.data.userName;\r\n      nextState.emitMovement = update.data.emitMovement;\r\n      nextState.socket = update.data.socket;\r\n      nextState.players = update.data.players;\r\n      break;\r\n    case 'addPlayer':\r\n      nextState.players = nextState.players.concat([update.player]);\r\n      break;\r\n    case 'playerMoved':\r\n      updatePlayer = nextState.players.find((p) => p.id === update.player.id);\r\n      if (updatePlayer) {\r\n        updatePlayer.location = update.player.location;\r\n      } else {\r\n        nextState.players = nextState.players.concat([update.player]);\r\n      }\r\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\r\n        nextState.currentLocation);\r\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\r\n        nextState.nearbyPlayers = state.nearbyPlayers;\r\n      }\r\n      break;\r\n    case 'weMoved':\r\n      nextState.currentLocation = update.location;\r\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\r\n        nextState.currentLocation);\r\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\r\n        nextState.nearbyPlayers = state.nearbyPlayers;\r\n      }\r\n\r\n      break;\r\n    case 'playerDisconnect':\r\n      nextState.players = nextState.players.filter((player) => player.id !== update.player.id);\r\n\r\n      nextState.nearbyPlayers = calculateNearbyPlayers(nextState.players,\r\n        nextState.currentLocation);\r\n      if (samePlayers(nextState.nearbyPlayers, state.nearbyPlayers)) {\r\n        nextState.nearbyPlayers = state.nearbyPlayers;\r\n      }\r\n      break;\r\n    case 'disconnect':\r\n      state.socket?.disconnect();\r\n      return defaultAppState();\r\n    default:\r\n      throw new Error('Unexpected state request');\r\n  }\r\n\r\n  return nextState;\r\n}\r\n\r\nasync function GameController(initData: TownJoinResponse,\r\n  dispatchAppUpdate: (update: CoveyAppUpdate) => void) {\r\n  // Now, set up the game sockets\r\n  const gamePlayerID = initData.coveyUserID;\r\n  const sessionToken = initData.coveySessionToken;\r\n  const url = process.env.REACT_APP_TOWNS_SERVICE_URL;\r\n  assert(url);\r\n  const video = Video.instance();\r\n  assert(video);\r\n  const roomName = video.townFriendlyName;\r\n  assert(roomName);\r\n\r\n  const socket = io(url, { auth: { token: sessionToken, coveyTownID: video.coveyTownID } });\r\n  socket.on('newPlayer', (player: ServerPlayer) => {\r\n    dispatchAppUpdate({\r\n      action: 'addPlayer',\r\n      player: Player.fromServerPlayer(player),\r\n    });\r\n  });\r\n  socket.on('playerMoved', (player: ServerPlayer) => {\r\n    if (player._id !== gamePlayerID) {\r\n      dispatchAppUpdate({ action: 'playerMoved', player: Player.fromServerPlayer(player) });\r\n    }\r\n  });\r\n  socket.on('playerDisconnect', (player: ServerPlayer) => {\r\n    dispatchAppUpdate({ action: 'playerDisconnect', player: Player.fromServerPlayer(player) });\r\n  });\r\n  socket.on('disconnect', () => {\r\n    dispatchAppUpdate({ action: 'disconnect' });\r\n  });\r\n  const emitMovement = (location: UserLocation) => {\r\n    socket.emit('playerMovement', location);\r\n    dispatchAppUpdate({ action: 'weMoved', location });\r\n  };\r\n\r\n  dispatchAppUpdate({\r\n    action: 'doConnect',\r\n    data: {\r\n      sessionToken,\r\n      userName: video.userName,\r\n      townFriendlyName: roomName,\r\n      townID: video.coveyTownID,\r\n      myPlayerID: gamePlayerID,\r\n      townIsPubliclyListed: video.isPubliclyListed,\r\n      emitMovement,\r\n      socket,\r\n      players: initData.currentPlayers.map((sp) => Player.fromServerPlayer(sp)),\r\n    },\r\n  });\r\n  return true;\r\n}\r\n\r\nfunction App(props: { setOnDisconnect: Dispatch<SetStateAction<Callback | undefined>> }) {\r\n  const [appState, dispatchAppUpdate] = useReducer(appStateReducer, defaultAppState());\r\n\r\n  const setupGameController = useCallback(async (initData: TownJoinResponse) => {\r\n    await GameController(initData, dispatchAppUpdate);\r\n    return true;\r\n  }, [dispatchAppUpdate]);\r\n  const videoInstance = Video.instance();\r\n\r\n  const { setOnDisconnect } = props;\r\n  useEffect(() => {\r\n    setOnDisconnect(() => async () => { // Here's a great gotcha: https://medium.com/swlh/how-to-store-a-function-with-the-usestate-hook-in-react-8a88dd4eede1\r\n      dispatchAppUpdate({ action: 'disconnect' });\r\n      return Video.teardown();\r\n    });\r\n  }, [dispatchAppUpdate, setOnDisconnect]);\r\n\r\n  const page = useMemo(() => {\r\n    if (!appState.sessionToken) {\r\n      return <Login doLogin={setupGameController} />;\r\n    } if (!videoInstance) {\r\n      return <div>Loading...</div>;\r\n    }\r\n    return (\r\n      <div>\r\n        <WorldMap />\r\n        <VideoOverlay preferredMode=\"fullwidth\" />\r\n      </div>\r\n    );\r\n  }, [setupGameController, appState.sessionToken, videoInstance]);\r\n  return (\r\n\r\n    <CoveyAppContext.Provider value={appState}>\r\n      <VideoContext.Provider value={Video.instance()}>\r\n        <NearbyPlayersContext.Provider value={appState.nearbyPlayers}>\r\n          {page}\r\n        </NearbyPlayersContext.Provider>\r\n      </VideoContext.Provider>\r\n    </CoveyAppContext.Provider>\r\n\r\n  );\r\n}\r\n\r\nfunction EmbeddedTwilioAppWrapper() {\r\n  const { error, setError } = useAppState();\r\n  const [onDisconnect, setOnDisconnect] = useState<Callback | undefined>();\r\n  const connectionOptions = useConnectionOptions();\r\n  return (\r\n    <UnsupportedBrowserWarning>\r\n      <VideoProvider options={connectionOptions} onError={setError} onDisconnect={onDisconnect}>\r\n        <ErrorDialog dismissError={() => setError(null)} error={error} />\r\n        <App setOnDisconnect={setOnDisconnect} />\r\n      </VideoProvider>\r\n    </UnsupportedBrowserWarning>\r\n  );\r\n}\r\n\r\nexport default function AppStateWrapper(): JSX.Element {\r\n  return (\r\n    <BrowserRouter>\r\n      <ChakraProvider>\r\n        <MuiThemeProvider theme={theme('rgb(185, 37, 0)')}>\r\n          <AppStateProvider preferredMode=\"fullwidth\" highlightedProfiles={[]}>\r\n            <EmbeddedTwilioAppWrapper />\r\n          </AppStateProvider>\r\n        </MuiThemeProvider>\r\n      </ChakraProvider>\r\n    </BrowserRouter>\r\n  );\r\n}\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({\r\n      getCLS, getFID, getFCP, getLCP, getTTFB,\r\n    }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root'),\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}